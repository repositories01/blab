{"version":3,"file":"credentials.js","sourceRoot":"","sources":["../../../../src/platforms/android/utils/credentials.ts"],"names":[],"mappings":";;;;;;AAAA,gDAAwB;AAExB,wDAA0B;AAC1B,+BAAoC;AAIpC,KAAK,UAAU,kBAAkB,CAAC,UAAkB,EAAE,GAAe;IACnE,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;QAChB,MAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC,CAAC,4CAA4C;KACvG;IACD,MAAM,YAAY,GAAG,YAAY,SAAM,EAAE,MAAM,CAAA;IAC/C,MAAM,kBAAE,CAAC,SAAS,CAAC,cAAI,CAAC,IAAI,CAAC,UAAU,EAAE,YAAY,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC;IAChH,MAAM,eAAe,GAAG;QACtB,OAAO,EAAE;YACP,QAAQ,EAAE;gBACR,YAAY;gBACZ,gBAAgB,EAAE,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,gBAAgB;gBACvD,QAAQ,EAAE,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ;gBACvC,WAAW,EAAE,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,WAAW;aAC9C;SACF;KACF,CAAA;IACD,MAAM,kBAAE,CAAC,SAAS,CAAC,cAAI,CAAC,IAAI,CAAC,UAAU,EAAE,kBAAkB,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC,CAAC;AACjG,CAAC;AAEQ,gDAAkB","sourcesContent":["import path from 'path';\n\nimport fs from 'fs-extra';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { AndroidJob } from '../job';\n\nasync function restoreCredentials(projectDir: string, job: AndroidJob): Promise<void> {\n  if (!job.secrets) {\n    throw new Error('secrets are missing in the job object'); // TODO: sentry (should be detected earlier)\n  }\n  const keystorePath = `keystore-${uuidv4()}.jks`\n  await fs.writeFile(path.join(projectDir, keystorePath), Buffer.from(job.secrets.keystore.dataBase64, 'base64'));\n  const credentialsJson = {\n    android: {\n      keystore: {\n        keystorePath,\n        keystorePassword: job.secrets.keystore.keystorePassword,\n        keyAlias: job.secrets.keystore.keyAlias,\n        keyPassword: job.secrets.keystore.keyPassword,\n      }\n    }\n  }\n  await fs.writeFile(path.join(projectDir, 'credentials.json'), JSON.stringify(credentialsJson));\n}\n\nexport { restoreCredentials }\n"]}