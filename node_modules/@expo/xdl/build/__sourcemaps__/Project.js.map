{"version":3,"sources":["Project.ts"],"names":["EXPO_CDN","MINIMUM_BUNDLE_SIZE","TUNNEL_TIMEOUT","treekillAsync","treekill","ngrokConnectAsync","ngrok","connect","ngrokKillAsync","kill","_cachedSignedManifest","manifestString","signedManifest","currentStatus","projectDir","packagerPort","expoServerPort","ProjectSettings","readPackagerInfoAsync","getManifestUrlWithFallbackAsync","projectRoot","url","UrlUtils","constructManifestUrlAsync","isUrlFallback","_assertValidProjectRoot","XDLError","_getFreePortAsync","rangeStart","port","hostnames","_resolveGoogleServicesFile","manifest","android","googleServicesFile","contents","fs","readFile","path","resolve","ios","_resolveManifestAssets","resolver","strict","assetSchemas","ExpSchema","getAssetSchemasAsync","sdkVersion","filter","assetSchema","fieldPath","urls","Promise","all","map","pathOrURL","match","existsSync","err","Error","localAssetPath","manifestField","forEach","index","e","logMethod","ProjectUtils","logWarning","logError","message","_requireFromProject","modulePath","exp","fullPath","require","getSlugAsync","skipSDKVersionRequirement","slug","getLatestReleaseAsync","options","user","UserManager","ensureLoggedInAsync","api","ApiV2","clientForUser","result","postAsync","owner","releaseChannel","count","platform","queryResult","length","mergeAppDistributions","sourceDirs","outputDir","assetPathToWrite","ensureDir","bundlesPathToWrite","androidIndexes","iosIndexes","sourceDir","promises","sourceAssetDir","outputAssetDir","assetPromise","copy","push","sourceBundleDir","outputBundleDir","bundlePromise","putJsonInMemory","indexPath","accumulator","JsonFile","readAsync","Array","isArray","androidIndexPath","iosIndexPath","getSortedIndex","indexes","sort","index1","index2","semver","eq","logger","global","error","gte","sortedAndroidIndexes","sortedIosIndexes","join","JSON","stringify","prepareHooks","hooks","hookType","validHooks","hook","file","fn","_fn","undefined","runHook","hookOptions","config","then","info","quiet","exportForAppHosting","publicUrl","assetUrl","defaultTarget","target","publishOptions","bundles","buildPublishBundlesAsync","dev","isDev","iosBundle","code","androidBundle","iosBundleHash","crypto","createHash","update","digest","iosBundleUrl","iosJsPath","androidBundleHash","androidBundleUrl","androidJsPath","pkg","_getPublishExpConfigAsync","assets","exportAssetsAsync","dumpAssetmap","assetmap","asset","hash","validPostExportHooks","assetUrlOverride","publishedTime","Date","toISOString","commitTime","releaseId","uuid","v4","hashIds","HashIds","v1","revisionId","encode","now","developer","tool","username","getCurrentUsernameAsync","ANONYMOUS_USERNAME","id","androidManifest","bundleUrl","dependencies","Object","keys","iosManifest","iosSourceMap","androidSourceMap","dumpSourcemap","iosMapName","iosMapPath","androidMapName","androidMapPath","truncateLastNLines","appendFile","debugHtml","log","msg","warn","stack","EmbeddedAssets","configureAsync","iosManifestUrl","androidManifestUrl","filePath","n","lines","readLastLines","read","to_vanquish","size","stat","truncate","_saveAssetsAsync","paths","files","fileHashes","keyChunks","key","logDebug","assetPath","p","findReusableBuildAsync","getCurrentUserAsync","buildReuseStatus","publishAsync","Analytics","logEvent","developerTool","Config","validationStatus","Doctor","validateWithNetworkAsync","ERROR","FATAL","validPostPublishHooks","publishAssetsAsync","hasHooks","shouldPublishAndroidMaps","publishSourceMapPath","shouldPublishIosMaps","response","_uploadArtifactsAsync","serverError","Sentry","captureException","publishManifestPath","shouldEmbedAssetsForExpoUpdates","ExponentTools","getManifestAsync","Accept","fullManifestUrl","replace","isKernel","_handleKernelPublishedAsync","formData","FormData","append","uploadFormDataAsync","locales","getResolvedLocalesAsync","bundleOptions","getenv","boolish","startReactNativeServerAsync","nonPersistent","maxWorkers","reset","resetCache","fetchPublishBundlesAsync","stopReactNativeServerAsync","platforms","getLogger","entryPoint","Exp","determineEntryPoint","opts","publishUrl","constructPublishUrlAsync","sourceMapUrl","constructSourceMapUrlAsync","assetsUrl","constructAssetsUrlAsync","_getForPlatformAsync","errorCode","minLength","iosAssetsJson","androidAssetsJson","parse","fullUrl","axios","request","responseType","transformResponse","data","proxy","validateStatus","status","headers","body","_collectAssets","hostedAssetPrefix","manifestAssets","absolutePath","_configureExpForAssets","assetBundlePatterns","fullPatterns","bundledAssets","Set","shouldBundle","__packager_asset","some","add","type","assetCdnPath","uploadAssetsAsync","hostedUrl","kernelBundleUrl","scheme","host","kernel","androidManifestPath","writeFile","iosManifestPath","metas","metadata","missing","exists","relativePath","createReadStream","getConfigAsync","configName","configPrefix","ThirdParty","getManifest","_validateManifest","bundleIdentifier","package","_validateOptions","schema","joi","object","current","boolean","mode","string","any","valid","expIds","array","regex","validate","toString","_getExpAsync","version","name","toLowerCase","getBuildStatusAsync","startBuildAsync","putAsync","_waitForRunningAsync","retries","test","METRO_VERBOSE_WARNING","NODE_12_WINDOWS_METRO_ERROR","NODE_12_WINDOWS_METRO_SUGGESTION","_logPackagerOutput","level","output","_isIgnorableDuplicateModuleWarning","_isIgnorableMetroConsoleOutput","_isIgnorableRnpmWarning","includes","logInfo","startsWith","reactNativeNodeModulesPath","reactNativeNodeModulesPattern","reactNativeNodeModulesCollisionRegex","RegExp","_isIgnorableBugReportingExtraData","_isAppRegistryStartupMessage","_handleDeviceLogs","deviceId","deviceName","logs","i","args","obj","logLevel","tag","groupDepth","shouldHide","includesStack","verbose","Watchman","addToPathAsync","unblockAndGetVersionAsync","customLogReporterPath","__dirname","sourceExtsConfig","isTS","isReact","isModern","sourceExts","packagerOpts","Versions","lteSdkVersion","gteSdkVersion","assetPlugins","userPackagerOpts","userSourceExts","cliOpts","val","entries","process","env","EXPO_DEBUG","defaultCliPath","cliPath","rnCliPath","nodePath","_nodePathForProjectRoot","nodePathEnv","NODE_PATH","packagerProcess","child_process","fork","cwd","REACT_NATIVE_APP_ROOT","ELECTRON_RUN_AS_NODE","silent","setPackagerInfoAsync","packagerPid","pid","on","stdout","stderr","setEncoding","pipe","exitPromise","reject","once","packagerUrl","constructBundleUrlAsync","urlType","hostType","race","directory","parentDirectory","dirname","delimiter","packagerInfo","blacklistedEnvironmentVariables","shouldExposeEnvironmentVariableInManifest","has","toUpperCase","stripPort","URL","hostname","getManifestHandler","req","res","bundleUrlPackagerOpts","xde","mainModuleName","guessMainModulePath","queryParams","constructBundleQueryParamsAsync","encodeURI","encodeURIComponent","debuggerHost","constructDebuggerHostAsync","logUrl","constructLogUrlAsync","hostUri","constructHostUriAsync","hostUUID","UserSettings","anonymousIdentifier","currentSession","getSessionAsync","offline","getUnsignedManifestString","getSignedManifestStringAsync","hostInfo","server","serverVersion","serverDriver","serverOS","os","serverOSVersion","release","setHeader","end","statusCode","remoteUsername","remotePackageName","unsignedManifest","signature","startExpoServerAsync","stopExpoServerAsync","app","use","express","json","limit","urlencoded","extended","ConnectionStatus","isOffline","validateWithoutNetworkAsync","manifestHandler","get","post","send","close","expRc","manifestPort","listen","address","saveRecentExpRootAsync","method","startDevServerAsync","startOptions","EXPO_TARGET","middleware","_connectToNgrokAsync","hostnameAsync","ngrokPid","attempts","configPath","dotExpoHomeDirectory","error_code","resetProjectRandomnessAsync","startTunnelsAsync","stopTunnelsAsync","Android","startAdbReverseAsync","packageShortName","base","startedTunnelsSuccessfully","expoServerNgrokUrl","authtoken","authToken","proto","randomness","manifestTunnelRandomness","getProjectRandomnessAsync","domainify","domain","packagerNgrokUrl","logWithLevel","_expoEventType","addListener","ngrokProcess","ngrokProcessPid","removeAllListeners","stopAdbReverseAsync","setOptionsAsync","Number","isInteger","getUrlAsync","startAsync","webOnly","Webpack","restartAsync","DevSession","startSession","_stopInternalAsync","stopSession","stopAsync","maybeStopAdbDaemonAsync","stopWebOnlyAsync","setTimeout","webpackServerPort"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAcA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAOA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;AAEA,MAAMA,QAAQ,GAAG,uCAAjB;AACA,MAAMC,mBAAmB,GAAG,GAA5B;AACA,MAAMC,cAAc,GAAG,KAAK,IAA5B;AAEA,MAAMC,aAAa,GAAG,uBAA0BC,mBAA1B,CAAtB;AACA,MAAMC,iBAAiB,GAAG,uBAAUC,iBAAMC,OAAhB,CAA1B;AACA,MAAMC,cAAc,GAAG,uBAAUF,iBAAMG,IAAhB,CAAvB;AAYA,MAAMC,qBAA2C,GAAG;AAClDC,EAAAA,cAAc,EAAE,IADkC;AAElDC,EAAAA,cAAc,EAAE;AAFkC,CAApD;;AA8DO,eAAeC,aAAf,CAA6BC,UAA7B,EAAyE;AAC9E,QAAM;AAAEC,IAAAA,YAAF;AAAgBC,IAAAA;AAAhB,MAAmC,MAAMC,eAAe,GAACC,qBAAhB,CAAsCJ,UAAtC,CAA/C;;AACA,MAAIC,YAAY,IAAIC,cAApB,EAAoC;AAClC,WAAO,SAAP;AACD,GAFD,MAEO,IAAID,YAAY,IAAIC,cAApB,EAAoC;AACzC,WAAO,KAAP;AACD,GAFM,MAEA;AACL,WAAO,QAAP;AACD;AACF,C,CAED;;;AACO,eAAeG,+BAAf,CACLC,WADK,EAE2C;AAChD,SAAO;AACLC,IAAAA,GAAG,EAAE,MAAMC,QAAQ,GAACC,yBAAT,CAAmCH,WAAnC,CADN;AAELI,IAAAA,aAAa,EAAE;AAFV,GAAP;AAID;;AAED,eAAeC,uBAAf,CAAuCL,WAAvC,EAA4D;AAC1D,MAAI,CAACA,WAAL,EAAkB;AAChB,UAAM,KAAIM,mBAAJ,EAAa,iBAAb,EAAgC,2BAAhC,CAAN;AACD;AACF;;AAED,eAAeC,iBAAf,CAAiCC,UAAjC,EAAqD;AACnD,QAAMC,IAAI,GAAG,MAAM,8BAAcD,UAAd,EAA0B;AAAEE,IAAAA,SAAS,EAAE,CAAC,IAAD,EAAO,WAAP;AAAb,GAA1B,CAAnB;;AACA,MAAI,CAACD,IAAL,EAAW;AACT,UAAM,KAAIH,mBAAJ,EAAa,eAAb,EAA8B,yBAA9B,CAAN;AACD;;AAED,SAAOG,IAAP;AACD;;AAED,eAAeE,0BAAf,CAA0CX,WAA1C,EAA+DY,QAA/D,EAAqF;AACnF,MAAIA,QAAQ,CAACC,OAAT,IAAoBD,QAAQ,CAACC,OAAT,CAAiBC,kBAAzC,EAA6D;AAC3D,UAAMC,QAAQ,GAAG,MAAMC,mBAAGC,QAAH,CACrBC,gBAAKC,OAAL,CAAanB,WAAb,EAA0BY,QAAQ,CAACC,OAAT,CAAiBC,kBAA3C,CADqB,EAErB,MAFqB,CAAvB;AAIAF,IAAAA,QAAQ,CAACC,OAAT,CAAiBC,kBAAjB,GAAsCC,QAAtC;AACD;;AACD,MAAIH,QAAQ,CAACQ,GAAT,IAAgBR,QAAQ,CAACQ,GAAT,CAAaN,kBAAjC,EAAqD;AACnD,UAAMC,QAAQ,GAAG,MAAMC,mBAAGC,QAAH,CACrBC,gBAAKC,OAAL,CAAanB,WAAb,EAA0BY,QAAQ,CAACQ,GAAT,CAAaN,kBAAvC,CADqB,EAErB,QAFqB,CAAvB;AAIAF,IAAAA,QAAQ,CAACQ,GAAT,CAAaN,kBAAb,GAAkCC,QAAlC;AACD;AACF;;AAED,eAAeM,sBAAf,CACErB,WADF,EAEEY,QAFF,EAGEU,QAHF,EAIEC,MAAM,GAAG,KAJX,EAKE;AACA,MAAI;AACF;AACA,UAAMC,YAAY,GAAG,CACnB,MAAMC,SAAS,GAACC,oBAAV,CAA+Bd,QAAQ,CAACe,UAAxC,CADa,EAEnBC,MAFmB,CAEXC,WAAD,IAAwC,oBAAIjB,QAAJ,EAAciB,WAAW,CAACC,SAA1B,CAF5B,CAArB,CAFE,CAMF;;AACA,UAAMC,IAAI,GAAG,MAAMC,OAAO,CAACC,GAAR,CACjBT,YAAY,CAACU,GAAb,CAAiB,MAAOL,WAAP,IAA8C;AAC7D,YAAMM,SAAS,GAAG,oBAAIvB,QAAJ,EAAciB,WAAW,CAACC,SAA1B,CAAlB;;AACA,UAAIK,SAAS,CAACC,KAAV,CAAgB,mBAAhB,CAAJ,EAA0C;AACxC;AACA,eAAOD,SAAP;AACD,OAHD,MAGO,IAAInB,mBAAGqB,UAAH,CAAcnB,gBAAKC,OAAL,CAAanB,WAAb,EAA0BmC,SAA1B,CAAd,CAAJ,EAAyD;AAC9D,eAAO,MAAMb,QAAQ,CAACa,SAAD,CAArB;AACD,OAFM,MAEA;AACL,cAAMG,GAA4B,GAAG,IAAIC,KAAJ,CAAU,gCAAV,CAArC;AACAD,QAAAA,GAAG,CAACE,cAAJ,GAAqBL,SAArB;AACAG,QAAAA,GAAG,CAACG,aAAJ,GAAoBZ,WAAW,CAACC,SAAhC;AACA,cAAMQ,GAAN;AACD;AACF,KAbD,CADiB,CAAnB,CAPE,CAwBF;;AACAd,IAAAA,YAAY,CAACkB,OAAb,CAAqB,CAACb,WAAD,EAAqCc,KAArC,KACnB,oBAAI/B,QAAJ,EAAciB,WAAW,CAACC,SAAZ,GAAwB,KAAtC,EAA6CC,IAAI,CAACY,KAAD,CAAjD,CADF;AAGD,GA5BD,CA4BE,OAAOC,CAAP,EAAU;AACV,QAAIC,SAAS,GAAGC,YAAY,GAACC,UAA7B;;AACA,QAAIxB,MAAJ,EAAY;AACVsB,MAAAA,SAAS,GAAGC,YAAY,GAACE,QAAzB;AACD;;AACD,QAAIJ,CAAC,CAACJ,cAAN,EAAsB;AACpBK,MAAAA,SAAS,CACP7C,WADO,EAEP,MAFO,EAGN,4BAA2B4C,CAAC,CAACJ,cAAe,WAAUI,CAAC,CAACH,aAAc,qCAHhE,CAAT;AAKD,KAND,MAMO;AACLI,MAAAA,SAAS,CACP7C,WADO,EAEP,MAFO,EAGN,qEAAoE4C,CAAC,CAACK,OAAQ,GAHxE,CAAT;AAKD;;AAED,QAAI1B,MAAJ,EAAY;AACV,YAAM,IAAIgB,KAAJ,CAAU,0BAAV,CAAN;AACD;AACF;AACF;;AAED,SAASW,mBAAT,CAA6BC,UAA7B,EAAiDnD,WAAjD,EAAsEoD,GAAtE,EAAuF;AACrF,MAAI;AACF,UAAMC,QAAQ,GAAG,6BAAcF,UAAd,EAA0BnD,WAA1B,EAAuCoD,GAAvC,CAAjB,CADE,CAEF;AACA;;AACA,4BAAQC,QAAR,EAJE,CAKF;;AACA,WAAOC,OAAO,CAACD,QAAD,CAAd;AACD,GAPD,CAOE,OAAOT,CAAP,EAAU;AACV,WAAO,IAAP;AACD;AACF,C,CAED;;;AACO,eAAeW,YAAf,CAA4BvD,WAA5B,EAAkE;AACvE,QAAM;AAAEoD,IAAAA;AAAF,MAAU,yBAAUpD,WAAV,EAAuB;AAAEwD,IAAAA,yBAAyB,EAAE;AAA7B,GAAvB,CAAhB;;AACA,MAAIJ,GAAG,CAACK,IAAR,EAAc;AACZ,WAAOL,GAAG,CAACK,IAAX;AACD;;AACD,QAAM,KAAInD,mBAAJ,EACJ,kBADI,EAEH,0BAAyBN,WAAY,oFAFlC,CAAN;AAID;;AAEM,eAAe0D,qBAAf,CACL1D,WADK,EAEL2D,OAFK,EAOoB;AACzB,QAAMC,IAAI,GAAG,MAAMC,gBAAYC,mBAAZ,EAAnB;;AACA,QAAMC,GAAG,GAAGC,gBAAMC,aAAN,CAAoBL,IAApB,CAAZ;;AACA,QAAMM,MAAM,GAAG,MAAMH,GAAG,CAACI,SAAJ,CAAc,iBAAd,EAAiC;AACpDC,IAAAA,KAAK,EAAET,OAAO,CAACS,KADqC;AAEpDX,IAAAA,IAAI,EAAE,MAAMF,YAAY,CAACvD,WAAD,CAF4B;AAGpDqE,IAAAA,cAAc,EAAEV,OAAO,CAACU,cAH4B;AAIpDC,IAAAA,KAAK,EAAE,CAJ6C;AAKpDC,IAAAA,QAAQ,EAAEZ,OAAO,CAACY;AALkC,GAAjC,CAArB;AAOA,QAAM;AAAEC,IAAAA;AAAF,MAAkBN,MAAxB;;AACA,MAAIM,WAAW,IAAIA,WAAW,CAACC,MAAZ,GAAqB,CAAxC,EAA2C;AACzC,WAAOD,WAAW,CAAC,CAAD,CAAlB;AACD,GAFD,MAEO;AACL,WAAO,IAAP;AACD;AACF,C,CAED;;;AACO,eAAeE,qBAAf,CACL1E,WADK,EAEL2E,UAFK,EAGLC,SAHK,EAIU;AACf,QAAMC,gBAAgB,GAAG3D,gBAAKC,OAAL,CAAanB,WAAb,EAA0B4E,SAA1B,EAAqC,QAArC,CAAzB;;AACA,QAAM5D,mBAAG8D,SAAH,CAAaD,gBAAb,CAAN;;AACA,QAAME,kBAAkB,GAAG7D,gBAAKC,OAAL,CAAanB,WAAb,EAA0B4E,SAA1B,EAAqC,SAArC,CAA3B;;AACA,QAAM5D,mBAAG8D,SAAH,CAAaC,kBAAb,CAAN,CAJe,CAMf;;AACA,QAAMC,cAAiC,GAAG,EAA1C;AACA,QAAMC,UAA6B,GAAG,EAAtC;;AAEA,OAAK,MAAMC,SAAX,IAAwBP,UAAxB,EAAoC;AAClC,UAAMQ,QAAQ,GAAG,EAAjB,CADkC,CAGlC;;AACA,QAAID,SAAS,KAAKN,SAAlB,EAA6B;AAC3B;AACA,YAAMQ,cAAc,GAAGlE,gBAAKC,OAAL,CAAanB,WAAb,EAA0BkF,SAA1B,EAAqC,QAArC,CAAvB;;AACA,YAAMG,cAAc,GAAGnE,gBAAKC,OAAL,CAAanB,WAAb,EAA0B4E,SAA1B,EAAqC,QAArC,CAAvB;;AACA,YAAMU,YAAY,GAAGtE,mBAAGuE,IAAH,CAAQH,cAAR,EAAwBC,cAAxB,CAArB;;AACAF,MAAAA,QAAQ,CAACK,IAAT,CAAcF,YAAd,EAL2B,CAO3B;;AACA,YAAMG,eAAe,GAAGvE,gBAAKC,OAAL,CAAanB,WAAb,EAA0BkF,SAA1B,EAAqC,SAArC,CAAxB;;AACA,YAAMQ,eAAe,GAAGxE,gBAAKC,OAAL,CAAanB,WAAb,EAA0B4E,SAA1B,EAAqC,SAArC,CAAxB;;AACA,YAAMe,aAAa,GAAG3E,mBAAGuE,IAAH,CAAQE,eAAR,EAAyBC,eAAzB,CAAtB;;AACAP,MAAAA,QAAQ,CAACK,IAAT,CAAcG,aAAd;AAEA,YAAM3D,OAAO,CAACC,GAAR,CAAYkD,QAAZ,CAAN;AACD,KAlBiC,CAoBlC;;;AACA,UAAMS,eAAe,GAAG,OAAOC,SAAP,EAA0BC,WAA1B,KAA6D;AACnF,YAAMnD,KAAK,GAAI,MAAMoD,oBAASC,SAAT,CAAmBH,SAAnB,CAArB;;AACA,UAAI,CAAClD,KAAK,CAAChB,UAAX,EAAuB;AACrB,cAAM,KAAIrB,mBAAJ,EACJ,kBADI,EAEH,qDAAoDuF,SAAU,EAF3D,CAAN;AAID;;AACD,UAAII,KAAK,CAACC,OAAN,CAAcvD,KAAd,CAAJ,EAA0B;AACxB;AACAmD,QAAAA,WAAW,CAACN,IAAZ,CAAiB,GAAG7C,KAApB;AACD,OAHD,MAGO;AACLmD,QAAAA,WAAW,CAACN,IAAZ,CAAiB7C,KAAjB;AACD;AACF,KAdD;;AAgBA,UAAMwD,gBAAgB,GAAGjF,gBAAKC,OAAL,CAAanB,WAAb,EAA0BkF,SAA1B,EAAqC,oBAArC,CAAzB;;AACA,UAAMU,eAAe,CAACO,gBAAD,EAAmBnB,cAAnB,CAArB;;AAEA,UAAMoB,YAAY,GAAGlF,gBAAKC,OAAL,CAAanB,WAAb,EAA0BkF,SAA1B,EAAqC,gBAArC,CAArB;;AACA,UAAMU,eAAe,CAACQ,YAAD,EAAenB,UAAf,CAArB;AACD,GApDc,CAsDf;;;AACA,QAAMoB,cAAc,GAAIC,OAAD,IAAgC;AACrD,WAAOA,OAAO,CAACC,IAAR,CAAa,CAACC,MAAD,EAA0BC,MAA1B,KAAsD;AACxE,UAAIC,kBAAOC,EAAP,CAAUH,MAAM,CAAC7E,UAAjB,EAA6B8E,MAAM,CAAC9E,UAApC,CAAJ,EAAqD;AACnDiF,0BAAOC,MAAP,CAAcC,KAAd,CACG,6DAA4DN,MAAM,CAAC7E,UAAW,4CADjF;AAGD;;AACD,aAAO+E,kBAAOK,GAAP,CAAWP,MAAM,CAAC7E,UAAlB,EAA8B8E,MAAM,CAAC9E,UAArC,IAAmD,CAAC,CAApD,GAAwD,CAA/D;AACD,KAPM,CAAP;AAQD,GATD;;AAWA,QAAMqF,oBAAoB,GAAGX,cAAc,CAACrB,cAAD,CAA3C;AACA,QAAMiC,gBAAgB,GAAGZ,cAAc,CAACpB,UAAD,CAAvC,CAnEe,CAqEf;;AACA,QAAM,+CACJjF,WADI,EAEJ,IAFI,EAGJkB,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,oBAArB,CAHI,EAIJuC,IAAI,CAACC,SAAL,CAAeJ,oBAAf,CAJI,CAAN;AAOA,QAAM,+CACJhH,WADI,EAEJ,IAFI,EAGJkB,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,gBAArB,CAHI,EAIJuC,IAAI,CAACC,SAAL,CAAeH,gBAAf,CAJI,CAAN;AAMD;;AAED,SAASI,YAAT,CACEC,KADF,EAEEC,QAFF,EAGEvH,WAHF,EAIEoD,GAJF,EAKE;AACA,QAAMoE,UAAwB,GAAG,EAAjC;;AAEA,MAAIF,KAAJ,EAAW;AAAA;;AACT,QAAIA,KAAK,CAACC,QAAD,CAAT,EAAqB;AACnBD,MAAAA,KAAK,CAACC,QAAD,CAAL,CAAiB7E,OAAjB,CAA0B+E,IAAD,IAAe;AACtC,cAAM;AAAEC,UAAAA;AAAF,YAAWD,IAAjB;;AACA,cAAME,EAAE,GAAGzE,mBAAmB,CAACwE,IAAD,EAAO1H,WAAP,EAAoBoD,GAApB,CAA9B;;AACA,YAAI,OAAOuE,EAAP,KAAc,UAAlB,EAA8B;AAC5Bf,4BAAOC,MAAP,CAAcC,KAAd,CACG,kBAAiBS,QAAS,WAAUG,IAAK,2CAD5C;AAGD,SAJD,MAIO;AACLD,UAAAA,IAAI,CAACG,GAAL,GAAWD,EAAX;AACAH,UAAAA,UAAU,CAAChC,IAAX,CAAgBiC,IAAhB;AACD;AACF,OAXD;AAYD;;AAED,QAAIH,KAAK,CAACC,QAAD,CAAL,KAAoBM,SAApB,IAAiCL,UAAU,CAAC/C,MAAX,yBAAsB6C,KAAK,CAACC,QAAD,CAA3B,oDAAsB,gBAAiB9C,MAAvC,CAArC,EAAoF;AAClF,YAAM,KAAInE,mBAAJ,EACJ,2BADI,EAEH,mBAAkBiH,QAAS,qBAFxB,CAAN;AAID;AACF;;AAED,SAAOC,UAAP;AACD;;AAEM,eAAeM,OAAf,CAAuBL,IAAvB,EAAyCM,WAAzC,EAAqF;AAC1F,MAAI7D,MAAM,GAAGuD,IAAI,CAACG,GAAL,CAAS;AACpBI,IAAAA,MAAM,EAAEP,IAAI,CAACO,MADO;AAEpB,OAAGD;AAFiB,GAAT,CAAb,CAD0F,CAM1F;;;AACA,MAAI7D,MAAM,IAAIA,MAAM,CAAC+D,IAArB,EAA2B;AACzB/D,IAAAA,MAAM,GAAG,MAAMA,MAAf;AACD;;AAED,MAAIA,MAAJ,EAAY;AACV0C,sBAAOC,MAAP,CAAcqB,IAAd,CAAmB;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAAnB,EAAoCjE,MAApC;AACD;AACF;AAED;;;;;;;;;;;;;AAWO,eAAekE,mBAAf,CACLpI,WADK,EAELqI,SAFK,EAGLC,QAHK,EAIL1D,SAJK,EAKLjB,OAKC,GAAG,EAVC,EAWU;AAAA;;AACf,QAAM4E,aAAa,GAAG,gCAAiBvI,WAAjB,CAAtB;AACA,QAAMwI,MAAM,sDAAG7E,OAAO,CAAC8E,cAAX,2DAAG,uBAAwBD,MAA3B,yEAAqCD,aAAjD,CAFe,CAIf;AACA;;AACA,QAAM1D,gBAAgB,GAAG3D,gBAAKC,OAAL,CAAanB,WAAb,EAA0BkB,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,QAArB,CAA1B,CAAzB;;AACA,QAAM5D,mBAAG8D,SAAH,CAAaD,gBAAb,CAAN;;AACA,QAAME,kBAAkB,GAAG7D,gBAAKC,OAAL,CAAanB,WAAb,EAA0BkB,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,SAArB,CAA1B,CAA3B;;AACA,QAAM5D,mBAAG8D,SAAH,CAAaC,kBAAb,CAAN;AAEA,QAAM2D,OAAO,GAAG,MAAMC,wBAAwB,CAAC3I,WAAD,EAAc2D,OAAO,CAAC8E,cAAtB,EAAsC;AAClFG,IAAAA,GAAG,EAAEjF,OAAO,CAACkF;AADqE,GAAtC,CAA9C;AAGA,QAAMC,SAAS,GAAGJ,OAAO,CAACtH,GAAR,CAAY2H,IAA9B;AACA,QAAMC,aAAa,GAAGN,OAAO,CAAC7H,OAAR,CAAgBkI,IAAtC;;AAEA,QAAME,aAAa,GAAGC,kBAAOC,UAAP,CAAkB,KAAlB,EAAyBC,MAAzB,CAAgCN,SAAhC,EAA2CO,MAA3C,CAAkD,KAAlD,CAAtB;;AACA,QAAMC,YAAY,GAAI,OAAML,aAAc,KAA1C;;AACA,QAAMM,SAAS,GAAGrI,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,SAArB,EAAgC0E,YAAhC,CAAlB;;AAEA,QAAME,iBAAiB,GAAGN,kBAAOC,UAAP,CAAkB,KAAlB,EAAyBC,MAAzB,CAAgCJ,aAAhC,EAA+CK,MAA/C,CAAsD,KAAtD,CAA1B;;AACA,QAAMI,gBAAgB,GAAI,WAAUD,iBAAkB,KAAtD;;AACA,QAAME,aAAa,GAAGxI,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,SAArB,EAAgC6E,gBAAhC,CAAtB;;AAEA,QAAM,+CAAyBzJ,WAAzB,EAAsC,IAAtC,EAA4CuJ,SAA5C,EAAuDT,SAAvD,CAAN;AACA,QAAM,+CAAyB9I,WAAzB,EAAsC,IAAtC,EAA4C0J,aAA5C,EAA2DV,aAA3D,CAAN;;AAEApC,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,6BAAnB,EA5Be,CA8Bf;AACA;;;AACA,QAAMO,cAAc,GAAG9E,OAAO,CAAC8E,cAAR,IAA0B,EAAjD;AACA,QAAM;AAAErF,IAAAA,GAAF;AAAOuG,IAAAA;AAAP,MAAe,MAAMC,yBAAyB,CAAC5J,WAAD,EAAcyI,cAAd,CAApD;AACA,QAAM;AAAEoB,IAAAA;AAAF,MAAa,MAAMC,iBAAiB,CAAC9J,WAAD,EAAcoD,GAAd,EAAmBiF,SAAnB,EAA8BzD,SAA9B,EAAyC8D,OAAzC,CAA1C;;AAEA,MAAI/E,OAAO,CAACoG,YAAZ,EAA0B;AACxBnD,sBAAOC,MAAP,CAAcqB,IAAd,CAAmB,oBAAnB;;AAEA,UAAM8B,QAAmC,GAAG,EAA5C;AAEAH,IAAAA,MAAM,CAACnH,OAAP,CAAgBuH,KAAD,IAAkB;AAC/BD,MAAAA,QAAQ,CAACC,KAAK,CAACC,IAAP,CAAR,GAAuBD,KAAvB;AACD,KAFD;AAIA,UAAM,+CACJjK,WADI,EAEJ,IAFI,EAGJkB,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,eAArB,CAHI,EAIJuC,IAAI,CAACC,SAAL,CAAe4C,QAAf,CAJI,CAAN;AAMD,GAnDc,CAqDf;;;AACA,QAAM;AAAE1C,IAAAA;AAAF,MAAYlE,GAAlB;AACA,SAAOA,GAAG,CAACkE,KAAX;AACA,QAAM6C,oBAAkC,GAAG9C,YAAY,CAACC,KAAD,EAAQ,YAAR,EAAsBtH,WAAtB,EAAmCoD,GAAnC,CAAvD,CAxDe,CA0Df;;AACAA,EAAAA,GAAG,CAACgH,gBAAJ,GAAuB9B,QAAvB;AAEAlF,EAAAA,GAAG,CAACiH,aAAJ,GAAoB,IAAIC,IAAJ,GAAWC,WAAX,EAApB;AACAnH,EAAAA,GAAG,CAACoH,UAAJ,GAAiB,IAAIF,IAAJ,GAAWC,WAAX,EAAjB;AACAnH,EAAAA,GAAG,CAACqH,SAAJ,GAAgBC,gBAAKC,EAAL,EAAhB,CA/De,CAiEf;;AACA,QAAMC,OAAO,GAAG,KAAIC,kBAAJ,EAAYH,gBAAKI,EAAL,EAAZ,EAAuB,EAAvB,CAAhB;AACA1H,EAAAA,GAAG,CAAC2H,UAAJ,GAAiBH,OAAO,CAACI,MAAR,CAAeV,IAAI,CAACW,GAAL,EAAf,CAAjB;;AAEA,MAAItH,OAAO,CAACkF,KAAZ,EAAmB;AACjBzF,IAAAA,GAAG,CAAC8H,SAAJ,GAAgB;AACdC,MAAAA,IAAI,EAAE;AADQ,KAAhB;AAGD;;AAED,MAAI,CAAC/H,GAAG,CAACK,IAAT,EAAe;AACb,UAAM,KAAInD,mBAAJ,EAAa,kBAAb,EAAiC,qDAAjC,CAAN;AACD;;AAED,MAAI8K,QAAQ,GAAG,MAAMvH,gBAAYwH,uBAAZ,EAArB;;AAEA,MAAI,CAACD,QAAL,EAAe;AACbA,IAAAA,QAAQ,GAAGE,0BAAX;AACD;;AAEDlI,EAAAA,GAAG,CAACmI,EAAJ,GAAU,IAAGH,QAAS,IAAGhI,GAAG,CAACK,IAAK,EAAlC,CArFe,CAuFf;;AACA,QAAM+H,eAAe,GAAG,EACtB,GAAGpI,GADmB;AAEtBqI,IAAAA,SAAS,EAAE,wBAAQpD,SAAR,EAAmB,SAAnB,EAA8BoB,gBAA9B,CAFW;AAGtBlF,IAAAA,QAAQ,EAAE,SAHY;AAItBmH,IAAAA,YAAY,EAAEC,MAAM,CAACC,IAAP,CAAYjC,GAAG,CAAC+B,YAAhB;AAJQ,GAAxB;AAOA,QAAM,+CACJ1L,WADI,EAEJ,IAFI,EAGJkB,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,oBAArB,CAHI,EAIJuC,IAAI,CAACC,SAAL,CAAeoE,eAAf,CAJI,CAAN,CA/Fe,CAsGf;;AACA,QAAMK,WAAW,GAAG,EAClB,GAAGzI,GADe;AAElBqI,IAAAA,SAAS,EAAE,wBAAQpD,SAAR,EAAmB,SAAnB,EAA8BiB,YAA9B,CAFO;AAGlB/E,IAAAA,QAAQ,EAAE,KAHQ;AAIlBmH,IAAAA,YAAY,EAAEC,MAAM,CAACC,IAAP,CAAYjC,GAAG,CAAC+B,YAAhB;AAJI,GAApB;AAOA,QAAM,+CACJ1L,WADI,EAEJ,IAFI,EAGJkB,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,gBAArB,CAHI,EAIJuC,IAAI,CAACC,SAAL,CAAeyE,WAAf,CAJI,CAAN;AAOA,QAAMC,YAAY,GAAGpD,OAAO,CAACtH,GAAR,CAAYc,GAAjC;AACA,QAAM6J,gBAAgB,GAAGrD,OAAO,CAAC7H,OAAR,CAAgBqB,GAAzC,CAtHe,CAwHf;;AACA,MAAIyB,OAAO,CAACqI,aAAZ,EAA2B;AACzB;AACA,UAAMC,UAAU,GAAI,OAAMhD,aAAc,MAAxC;;AACA,UAAMiD,UAAU,GAAGhL,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,SAArB,EAAgCqH,UAAhC,CAAnB;;AACA,UAAM,+CAAyBjM,WAAzB,EAAsC,IAAtC,EAA4CkM,UAA5C,EAAwDJ,YAAxD,CAAN;AAEA,UAAMK,cAAc,GAAI,WAAU3C,iBAAkB,MAApD;;AACA,UAAM4C,cAAc,GAAGlL,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,SAArB,EAAgCuH,cAAhC,CAAvB;;AACA,UAAM,+CAAyBnM,WAAzB,EAAsC,IAAtC,EAA4CoM,cAA5C,EAA4DL,gBAA5D,CAAN,CARyB,CAUzB;;AACAnF,sBAAOC,MAAP,CAAcqB,IAAd,CAAmB,wBAAnB;;AACA,UAAMmE,kBAAkB,CAAC9C,SAAD,EAAY,CAAZ,CAAxB;AACA,UAAM8C,kBAAkB,CAAC3C,aAAD,EAAgB,CAAhB,CAAxB,CAbyB,CAezB;;AACA,UAAM1I,mBAAGsL,UAAH,CAAc/C,SAAd,EAA0B,0BAAyB0C,UAAW,EAA9D,CAAN;AACA,UAAMjL,mBAAGsL,UAAH,CAAc5C,aAAd,EAA8B,0BAAyByC,cAAe,EAAtE,CAAN,CAjByB,CAmBzB;;AACAvF,sBAAOC,MAAP,CAAcqB,IAAd,CAAmB,sCAAnB;;AACA,UAAMqE,SAAS,GAAI;mBACJ,wBAAQ,SAAR,EAAmBjD,YAAnB,CAAiC;mBACjC,wBAAQ,SAAR,EAAmBG,gBAAnB,CAAqC;;;KAFpD;AAOA,UAAM,+CACJzJ,WADI,EAEJ,IAFI,EAGJkB,gBAAKgG,IAAL,CAAUtC,SAAV,EAAqB,YAArB,CAHI,EAIJ2H,SAJI,CAAN;AAMD;;AAED,QAAMxE,WAAW,GAAG;AAClB9H,IAAAA,GAAG,EAAE,IADa;AAElBmD,IAAAA,GAFkB;AAGlB0F,IAAAA,SAHkB;AAIlBgD,IAAAA,YAJkB;AAKlBD,IAAAA,WALkB;AAMlB7C,IAAAA,aANkB;AAOlB+C,IAAAA,gBAPkB;AAQlBP,IAAAA,eARkB;AASlBxL,IAAAA,WATkB;AAUlBwM,IAAAA,GAAG,EAAGC,GAAD,IAAc;AACjB7F,wBAAOC,MAAP,CAAcqB,IAAd,CAAmB;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAAnB,EAAoCsE,GAApC;AACD;AAZiB,GAApB;;AAeA,OAAK,MAAMhF,IAAX,IAAmB0C,oBAAnB,EAAyC;AACvCvD,sBAAOC,MAAP,CAAcqB,IAAd,CAAoB,4BAA2BT,IAAI,CAACC,IAAK,EAAzD;;AAEA,QAAI;AACFI,MAAAA,OAAO,CAACL,IAAD,EAAOM,WAAP,CAAP;AACD,KAFD,CAEE,OAAOnF,CAAP,EAAU;AACVgE,wBAAOC,MAAP,CAAc6F,IAAd,CAAoB,6BAA4BjF,IAAI,CAACC,IAAK,aAAY9E,CAAC,CAAC+J,KAAM,EAA9E;AACD;AACF,GApLc,CAsLf;;;AACA,QAAMC,cAAc,GAACC,cAAf,CAA8B;AAClC7M,IAAAA,WADkC;AAElC2J,IAAAA,GAFkC;AAGlCvG,IAAAA,GAHkC;AAIlC0J,IAAAA,cAAc,EAAE,wBAAQzE,SAAR,EAAmB,gBAAnB,CAJkB;AAKlCwD,IAAAA,WALkC;AAMlC/C,IAAAA,SANkC;AAOlCgD,IAAAA,YAPkC;AAQlCiB,IAAAA,kBAAkB,EAAE,wBAAQ1E,SAAR,EAAmB,oBAAnB,CARc;AASlCmD,IAAAA,eATkC;AAUlCxC,IAAAA,aAVkC;AAWlC+C,IAAAA,gBAXkC;AAYlCvD,IAAAA;AAZkC,GAA9B,CAAN;AAcD,C,CAED;;;AACA,eAAe6D,kBAAf,CAAkCW,QAAlC,EAAoDC,CAApD,EAA+D;AAC7D,QAAMC,KAAK,GAAG,MAAMC,yBAAcC,IAAd,CAAmBJ,QAAnB,EAA6BC,CAA7B,CAApB;AACA,QAAMI,WAAW,GAAGH,KAAK,CAACzI,MAA1B;AACA,QAAM;AAAE6I,IAAAA;AAAF,MAAW,MAAMtM,mBAAGuM,IAAH,CAAQP,QAAR,CAAvB;AACA,QAAMhM,mBAAGwM,QAAH,CAAYR,QAAZ,EAAsBM,IAAI,GAAGD,WAA7B,CAAN;AACD;;AAED,eAAeI,gBAAf,CAAgCzN,WAAhC,EAAqD6J,MAArD,EAAsEjF,SAAtE,EAAyF;AACvF;AACA,QAAM8I,KAAqC,GAAG,EAA9C;AACA7D,EAAAA,MAAM,CAACnH,OAAP,CAAeuH,KAAK,IAAI;AACtBA,IAAAA,KAAK,CAAC0D,KAAN,CAAYjL,OAAZ,CAAoB,CAACxB,IAAD,EAAeyB,KAAf,KAAiC;AACnD+K,MAAAA,KAAK,CAACzD,KAAK,CAAC2D,UAAN,CAAiBjL,KAAjB,CAAD,CAAL,GAAiCzB,IAAjC;AACD,KAFD;AAGD,GAJD,EAHuF,CASvF;;AACA,QAAM2M,SAAS,GAAG,sBAAMlC,MAAM,CAACC,IAAP,CAAY8B,KAAZ,CAAN,EAA0B,CAA1B,CAAlB;;AACA,OAAK,MAAM9B,IAAX,IAAmBiC,SAAnB,EAA8B;AAC5B,UAAM1I,QAAQ,GAAG,EAAjB;;AACA,SAAK,MAAM2I,GAAX,IAAkBlC,IAAlB,EAAwB;AACtB9I,MAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA4C,aAAY0N,KAAK,CAACI,GAAD,CAAM,EAAnE;;AAEAlH,wBAAOC,MAAP,CAAcqB,IAAd,CAAmB;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAAnB,EAAqC,UAASuF,KAAK,CAACI,GAAD,CAAM,EAAzD;;AAEA,YAAME,SAAS,GAAG9M,gBAAKC,OAAL,CAAayD,SAAb,EAAwB,QAAxB,EAAkCkJ,GAAlC,CAAlB,CALsB,CAOtB;;;AACA,YAAMG,CAAC,GAAGjN,mBAAGuE,IAAH,CAAQmI,KAAK,CAACI,GAAD,CAAb,EAAoBE,SAApB,CAAV;;AACA7I,MAAAA,QAAQ,CAACK,IAAT,CAAcyI,CAAd;AACD;;AACD,UAAMjM,OAAO,CAACC,GAAR,CAAYkD,QAAZ,CAAN;AACD;;AACDyB,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,2BAAnB;AACD;;AAEM,eAAegG,sBAAf,CACL7J,cADK,EAELE,QAFK,EAGL5C,UAHK,EAIL8B,IAJK,EAKiD;AACtD,QAAMG,IAAI,GAAG,MAAMC,gBAAYsK,mBAAZ,EAAnB;AAEA,QAAMC,gBAAgB,GAAG,MAAMpK,gBAAMC,aAAN,CAAoBL,IAApB,EAA0BO,SAA1B,CAAoC,wBAApC,EAA8D;AAC3FE,IAAAA,cAD2F;AAE3FE,IAAAA,QAF2F;AAG3F5C,IAAAA,UAH2F;AAI3F8B,IAAAA;AAJ2F,GAA9D,CAA/B;AAOA,SAAO2K,gBAAP;AACD;;AAEM,eAAeC,YAAf,CACLrO,WADK,EAEL2D,OAAuB,GAAG,EAFrB,EAGkD;AAAA;;AACvDA,EAAAA,OAAO,CAAC6E,MAAR,sBAAiB7E,OAAO,CAAC6E,MAAzB,6DAAmC,gCAAiBxI,WAAjB,CAAnC;AACA,QAAMwI,MAAM,GAAG7E,OAAO,CAAC6E,MAAvB;AACA,QAAM5E,IAAI,GAAG,MAAMC,gBAAYC,mBAAZ,EAAnB;AAEAwK,EAAAA,SAAS,GAACC,QAAV,CAAmB,SAAnB,EAA8B;AAC5BvO,IAAAA,WAD4B;AAE5BwO,IAAAA,aAAa,EAAEC,kBAAOD;AAFM,GAA9B;AAKA,QAAME,gBAAgB,GAAG,MAAMC,MAAM,GAACC,wBAAP,CAAgC5O,WAAhC,CAA/B;;AACA,MAAI0O,gBAAgB,KAAKC,MAAM,GAACE,KAA5B,IAAqCH,gBAAgB,KAAKC,MAAM,GAACG,KAArE,EAA4E;AAC1E,UAAM,KAAIxO,mBAAJ,EACJ,0BADI,EAEJ,oGAFI,CAAN;AAID,GAhBsD,CAkBvD;;;AACA,QAAM;AAAE8C,IAAAA,GAAF;AAAOuG,IAAAA;AAAP,MAAe,MAAMC,yBAAyB,CAAC5J,WAAD,EAAc2D,OAAd,CAApD,CAnBuD,CAqBvD;;AACA,QAAM;AAAE2D,IAAAA;AAAF,MAAYlE,GAAlB;AACA,SAAOA,GAAG,CAACkE,KAAX;AACA,QAAMyH,qBAAmC,GAAG1H,YAAY,CAACC,KAAD,EAAQ,aAAR,EAAuBtH,WAAvB,EAAoCoD,GAApC,CAAxD;AAEA,QAAMsF,OAAO,GAAG,MAAMC,wBAAwB,CAAC3I,WAAD,EAAc2D,OAAd,CAA9C;AACA,QAAMqF,aAAa,GAAGN,OAAO,CAAC7H,OAAR,CAAgBkI,IAAtC;AACA,QAAMD,SAAS,GAAGJ,OAAO,CAACtH,GAAR,CAAY2H,IAA9B;AAEA,QAAMiG,kBAAkB,CAAChP,WAAD,EAAcoD,GAAd,EAAmBsF,OAAnB,CAAxB;AAEA,QAAMuG,QAAQ,GAAGF,qBAAqB,CAACtK,MAAtB,GAA+B,CAAhD;AAEA,QAAMyK,wBAAwB,GAAG,CAAC,CAAC9L,GAAG,CAACvC,OAAN,IAAiB,CAAC,CAACuC,GAAG,CAACvC,OAAJ,CAAYsO,oBAAhE;AACA,QAAMC,oBAAoB,GAAG,CAAC,CAAChM,GAAG,CAAChC,GAAN,IAAa,CAAC,CAACgC,GAAG,CAAChC,GAAJ,CAAQ+N,oBAApD;AACA,QAAMpD,gBAAgB,GAAGkD,QAAQ,IAAIC,wBAAZ,GAAuCxG,OAAO,CAAC7H,OAAR,CAAgBqB,GAAvD,GAA6D,IAAtF;AACA,QAAM4J,YAAY,GAAGmD,QAAQ,IAAIG,oBAAZ,GAAmC1G,OAAO,CAACtH,GAAR,CAAYc,GAA/C,GAAqD,IAA1E;AAEA,MAAImN,QAAJ;;AACA,MAAI;AACFA,IAAAA,QAAQ,GAAG,MAAMC,qBAAqB,CAAC;AACrC3F,MAAAA,GADqC;AAErCvG,MAAAA,GAFqC;AAGrC0F,MAAAA,SAHqC;AAIrCE,MAAAA,aAJqC;AAKrCrF,MAAAA;AALqC,KAAD,CAAtC;AAOD,GARD,CAQE,OAAOf,CAAP,EAAU;AACV,QAAIA,CAAC,CAAC2M,WAAF,KAAkB,yBAAtB,EAAiD;AAC/C,YAAM,IAAIhN,KAAJ,CACH,iIADG,CAAN;AAGD;;AACDiN,IAAAA,MAAM,GAACC,gBAAP,CAAwB7M,CAAxB;AACA,UAAMA,CAAN;AACD;;AAED,MAAI4I,eAAe,GAAG,EAAtB;AACA,MAAIK,WAAW,GAAG,EAAlB;;AAEA,MACEkD,qBAAqB,CAACtK,MAAtB,IACCrB,GAAG,CAAChC,GAAJ,IAAWgC,GAAG,CAAChC,GAAJ,CAAQsO,mBADpB,IAECtM,GAAG,CAACvC,OAAJ,IAAeuC,GAAG,CAACvC,OAAJ,CAAY6O,mBAF5B,IAGA9C,cAAc,GAAC+C,+BAAf,CAA+C3P,WAA/C,EAA4DoD,GAA5D,EAAiEuG,GAAjE,EAAsEnB,MAAtE,CAJF,EAKE;AACA,KAACgD,eAAD,EAAkBK,WAAlB,IAAiC,MAAM7J,OAAO,CAACC,GAAR,CAAY,CACjD2N,aAAa,GAACC,gBAAd,CAA+BR,QAAQ,CAACpP,GAAxC,EAA6C;AAC3C,8BAAwBmD,GAAG,CAACzB,UADe;AAE3C,2BAAqB,SAFsB;AAG3C,8BAAwBgC,OAAO,CAACU,cAHW;AAI3CyL,MAAAA,MAAM,EAAE;AAJmC,KAA7C,CADiD,EAOjDF,aAAa,GAACC,gBAAd,CAA+BR,QAAQ,CAACpP,GAAxC,EAA6C;AAC3C,8BAAwBmD,GAAG,CAACzB,UADe;AAE3C,2BAAqB,KAFsB;AAG3C,8BAAwBgC,OAAO,CAACU,cAHW;AAI3CyL,MAAAA,MAAM,EAAE;AAJmC,KAA7C,CAPiD,CAAZ,CAAvC;AAeA,UAAM/H,WAAW,GAAG;AAClB9H,MAAAA,GAAG,EAAEoP,QAAQ,CAACpP,GADI;AAElBmD,MAAAA,GAFkB;AAGlB0F,MAAAA,SAHkB;AAIlBgD,MAAAA,YAJkB;AAKlBD,MAAAA,WALkB;AAMlB7C,MAAAA,aANkB;AAOlB+C,MAAAA,gBAPkB;AAQlBP,MAAAA,eARkB;AASlBxL,MAAAA,WATkB;AAUlBwM,MAAAA,GAAG,EAAGC,GAAD,IAAc;AACjB7F,0BAAOC,MAAP,CAAcqB,IAAd,CAAmB;AAAEC,UAAAA,KAAK,EAAE;AAAT,SAAnB,EAAoCsE,GAApC;AACD;AAZiB,KAApB;;AAeA,SAAK,MAAMhF,IAAX,IAAmBsH,qBAAnB,EAA0C;AACxCnI,wBAAOC,MAAP,CAAcqB,IAAd,CAAoB,6BAA4BT,IAAI,CAACC,IAAK,EAA1D;;AACA,UAAI;AACFI,QAAAA,OAAO,CAACL,IAAD,EAAOM,WAAP,CAAP;AACD,OAFD,CAEE,OAAOnF,CAAP,EAAU;AACVgE,0BAAOC,MAAP,CAAc6F,IAAd,CAAoB,8BAA6BjF,IAAI,CAACC,IAAK,aAAY9E,CAAC,CAAC+J,KAAM,EAA/E;AACD;AACF;AACF;;AAED,QAAMoD,eAAe,GAAGV,QAAQ,CAACpP,GAAT,CAAa+P,OAAb,CAAqB,QAArB,EAA+B,UAA/B,CAAxB;AACA,QAAMpD,cAAc,GAACC,cAAf,CAA8B;AAClC7M,IAAAA,WADkC;AAElC2J,IAAAA,GAFkC;AAGlCvG,IAAAA,GAHkC;AAIlCiB,IAAAA,cAAc,2BAAEV,OAAO,CAACU,cAAV,yEAA4B,SAJR;AAKlCyI,IAAAA,cAAc,EAAEiD,eALkB;AAMlClE,IAAAA,WANkC;AAOlC/C,IAAAA,SAPkC;AAQlCgD,IAAAA,YARkC;AASlCiB,IAAAA,kBAAkB,EAAEgD,eATc;AAUlCvE,IAAAA,eAVkC;AAWlCxC,IAAAA,aAXkC;AAYlC+C,IAAAA,gBAZkC;AAalCvD,IAAAA;AAbkC,GAA9B,CAAN,CA5GuD,CA4HvD;;AACA,MAAIpF,GAAG,CAAC6M,QAAR,EAAkB;AAChB,UAAMC,2BAA2B,CAAC;AAChCtM,MAAAA,IADgC;AAEhCR,MAAAA,GAFgC;AAGhCpD,MAAAA,WAHgC;AAIhCC,MAAAA,GAAG,EAAEoP,QAAQ,CAACpP;AAJkB,KAAD,CAAjC;AAMD;;AAED,SAAO,EACL,GAAGoP,QADE;AAELpP,IAAAA,GAAG,EACD0D,OAAO,CAACU,cAAR,IAA0BV,OAAO,CAACU,cAAR,KAA2B,SAArD,GACK,GAAEgL,QAAQ,CAACpP,GAAI,oBAAmB0D,OAAO,CAACU,cAAe,EAD9D,GAEIgL,QAAQ,CAACpP;AALV,GAAP;AAOD;;AAED,eAAeqP,qBAAf,CAAqC;AACnClM,EAAAA,GADmC;AAEnC0F,EAAAA,SAFmC;AAGnCE,EAAAA,aAHmC;AAInCrF,EAAAA,OAJmC;AAKnCgG,EAAAA;AALmC,CAArC,EAYG;AACD/C,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,8BAAnB;;AACA,QAAMiI,QAAQ,GAAG,KAAIC,mBAAJ,GAAjB;AAEAD,EAAAA,QAAQ,CAACE,MAAT,CAAgB,SAAhB,EAA2BlJ,IAAI,CAACC,SAAL,CAAehE,GAAf,CAA3B;AACA+M,EAAAA,QAAQ,CAACE,MAAT,CAAgB,aAAhB,EAA+BlJ,IAAI,CAACC,SAAL,CAAeuC,GAAf,CAA/B;AACAwG,EAAAA,QAAQ,CAACE,MAAT,CAAgB,WAAhB,EAA6BvH,SAA7B,EAAwC,WAAxC;AACAqH,EAAAA,QAAQ,CAACE,MAAT,CAAgB,eAAhB,EAAiCrH,aAAjC,EAAgD,eAAhD;AACAmH,EAAAA,QAAQ,CAACE,MAAT,CAAgB,SAAhB,EAA2BlJ,IAAI,CAACC,SAAL,CAAezD,OAAf,CAA3B;AAEA,QAAMC,IAAI,GAAG,MAAMC,gBAAYC,mBAAZ,EAAnB;;AACA,QAAMC,GAAG,GAAGC,gBAAMC,aAAN,CAAoBL,IAApB,CAAZ;;AACA,SAAO,MAAMG,GAAG,CAACuM,mBAAJ,CAAwB,aAAxB,EAAuCH,QAAvC,CAAb;AACD;;AAED,eAAevG,yBAAf,CACE5J,WADF,EAEE2D,OAFF,EAMG;AACD,MAAIA,OAAO,CAACU,cAAR,IAA0B,IAA1B,IAAkC,OAAOV,OAAO,CAACU,cAAf,KAAkC,QAAxE,EAAkF;AAChF,UAAM,KAAI/D,mBAAJ,EAAa,iBAAb,EAAgC,iCAAhC,CAAN;AACD;;AACDqD,EAAAA,OAAO,CAACU,cAAR,GAAyBV,OAAO,CAACU,cAAR,IAA0B,SAAnD,CAJC,CAMD;;AACA,QAAM;AAAEjB,IAAAA,GAAF;AAAOuG,IAAAA;AAAP,MAAe,yBAAU3J,WAAV,CAArB;;AAEA,MAAIoD,GAAG,CAACvC,OAAJ,IAAeuC,GAAG,CAACvC,OAAJ,CAAYmH,MAA/B,EAAuC;AACrC,WAAO5E,GAAG,CAACvC,OAAJ,CAAYmH,MAAnB;AACD;;AAED,MAAI5E,GAAG,CAAChC,GAAJ,IAAWgC,GAAG,CAAChC,GAAJ,CAAQ4G,MAAvB,EAA+B;AAC7B,WAAO5E,GAAG,CAAChC,GAAJ,CAAQ4G,MAAf;AACD;;AAED,QAAM;AAAErG,IAAAA;AAAF,MAAiByB,GAAvB,CAjBC,CAmBD;;AACA,MAAIzB,UAAU,KAAK,aAAf,IAAgC,CAAC,uCAArC,EAAkE;AAChE,UAAM,KAAIrB,mBAAJ,EAAa,iBAAb,EAAgC,6CAAhC,CAAN;AACD;;AACD8C,EAAAA,GAAG,CAACmN,OAAJ,GAAc,MAAMX,aAAa,GAACY,uBAAd,CAAsCpN,GAAtC,CAApB;AACA,SAAO;AAAEA,IAAAA,GAAG,EAAE,EAAE,GAAGA,GAAL;AAAUzB,MAAAA,UAAU,EAAEA;AAAtB,KAAP;AAA4CgI,IAAAA;AAA5C,GAAP;AACD;;AAED,eAAehB,wBAAf,CACE3I,WADF,EAEEyI,cAA8B,GAAG,EAFnC,EAGEgI,aAAgC,GAAG,EAHrC,EAIE;AACA,MAAI,CAACC,kBAAOC,OAAP,CAAe,qBAAf,EAAsC,KAAtC,CAAL,EAAmD;AACjD,QAAI;AACF,YAAMC,2BAA2B,CAC/B5Q,WAD+B,EAE/B;AACE6Q,QAAAA,aAAa,EAAE,IADjB;AAEEC,QAAAA,UAAU,EAAErI,cAAc,CAACqI,UAF7B;AAGEtI,QAAAA,MAAM,EAAEC,cAAc,CAACD,MAHzB;AAIEuI,QAAAA,KAAK,EAAEtI,cAAc,CAACuI;AAJxB,OAF+B,EAQ/B,CAACvI,cAAc,CAACN,KARe,CAAjC;AAUA,aAAO,MAAM8I,wBAAwB,CAACjR,WAAD,CAArC;AACD,KAZD,SAYU;AACR,YAAMkR,0BAA0B,CAAClR,WAAD,CAAhC;AACD;AACF;;AACD,QAAMmR,SAAqB,GAAG,CAAC,SAAD,EAAY,KAAZ,CAA9B;AACA,QAAM,CAACtQ,OAAD,EAAUO,GAAV,IAAiB,MAAM,8BAC3BpB,WAD2B,EAE3B;AACEwI,IAAAA,MAAM,EAAEC,cAAc,CAACD,MADzB;AAEEwI,IAAAA,UAAU,EAAEvI,cAAc,CAACuI,UAF7B;AAGEpK,IAAAA,MAAM,EAAE9D,YAAY,GAACsO,SAAb,CAAuBpR,WAAvB,CAHV;AAIEmI,IAAAA,KAAK,EAAEM,cAAc,CAACN;AAJxB,GAF2B,EAQ3BgJ,SAAS,CAACjP,GAAV,CAAeqC,QAAD,KAAyB;AACrCA,IAAAA,QADqC;AAErC8M,IAAAA,UAAU,EAAEC,GAAG,GAACC,mBAAJ,CAAwBvR,WAAxB,EAAqCuE,QAArC,CAFyB;AAGrCqE,IAAAA,GAAG,EAAE6H,aAAa,CAAC7H;AAHkB,GAAzB,CAAd,CAR2B,CAA7B;AAeA,SAAO;AACL/H,IAAAA,OADK;AAELO,IAAAA;AAFK,GAAP;AAID,C,CAED;;;AACA,eAAe6P,wBAAf,CAAwCjR,WAAxC,EAA6DwR,IAA7D,EAAqF;AACnF,QAAMH,UAAU,GAAGC,GAAG,GAACC,mBAAJ,CAAwBvR,WAAxB,CAAnB;AACA,QAAMyR,UAAU,GAAG,MAAMvR,QAAQ,GAACwR,wBAAT,CACvB1R,WADuB,EAEvBqR,UAFuB,EAGvBxJ,SAHuB,EAIvB2J,IAJuB,CAAzB;AAMA,QAAMG,YAAY,GAAG,MAAMzR,QAAQ,GAAC0R,0BAAT,CAAoC5R,WAApC,EAAiDqR,UAAjD,CAA3B;AACA,QAAMQ,SAAS,GAAG,MAAM3R,QAAQ,GAAC4R,uBAAT,CAAiC9R,WAAjC,EAA8CqR,UAA9C,CAAxB;;AAEAzK,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,qBAAnB;;AACA,QAAMY,SAAS,GAAG,MAAMiJ,oBAAoB,CAAC/R,WAAD,EAAcyR,UAAd,EAA0B,KAA1B,EAAiC;AAC3EO,IAAAA,SAAS,EAAE,gBADgE;AAE3EC,IAAAA,SAAS,EAAEpT;AAFgE,GAAjC,CAA5C;;AAKA+H,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,yBAAnB;;AACA,QAAMc,aAAa,GAAG,MAAM+I,oBAAoB,CAAC/R,WAAD,EAAcyR,UAAd,EAA0B,SAA1B,EAAqC;AACnFO,IAAAA,SAAS,EAAE,gBADwE;AAEnFC,IAAAA,SAAS,EAAEpT;AAFwE,GAArC,CAAhD;;AAKA+H,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,sBAAnB;;AACA,QAAM4D,YAAY,GAAG,MAAMiG,oBAAoB,CAAC/R,WAAD,EAAc2R,YAAd,EAA4B,KAA5B,EAAmC;AAChFK,IAAAA,SAAS,EAAE,gBADqE;AAEhFC,IAAAA,SAAS,EAAEpT;AAFqE,GAAnC,CAA/C;AAIA,QAAMkN,gBAAgB,GAAG,MAAMgG,oBAAoB,CAAC/R,WAAD,EAAc2R,YAAd,EAA4B,SAA5B,EAAuC;AACxFK,IAAAA,SAAS,EAAE,gBAD6E;AAExFC,IAAAA,SAAS,EAAEpT;AAF6E,GAAvC,CAAnD;;AAKA+H,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,qBAAnB;;AACA,QAAMgK,aAAa,GAAG,MAAMH,oBAAoB,CAAC/R,WAAD,EAAc6R,SAAd,EAAyB,KAAzB,EAAgC;AAC9EG,IAAAA,SAAS,EAAE;AADmE,GAAhC,CAAhD;AAGA,QAAMG,iBAAiB,GAAG,MAAMJ,oBAAoB,CAAC/R,WAAD,EAAc6R,SAAd,EAAyB,SAAzB,EAAoC;AACtFG,IAAAA,SAAS,EAAE;AAD2E,GAApC,CAApD;AAIA,SAAO;AACLnR,IAAAA,OAAO,EAAE;AAAEkI,MAAAA,IAAI,EAAEC,aAAR;AAAuB9G,MAAAA,GAAG,EAAE6J,gBAA5B;AAA8ClC,MAAAA,MAAM,EAAE1C,IAAI,CAACiL,KAAL,CAAWD,iBAAX;AAAtD,KADJ;AAEL/Q,IAAAA,GAAG,EAAE;AAAE2H,MAAAA,IAAI,EAAED,SAAR;AAAmB5G,MAAAA,GAAG,EAAE4J,YAAxB;AAAsCjC,MAAAA,MAAM,EAAE1C,IAAI,CAACiL,KAAL,CAAWF,aAAX;AAA9C;AAFA,GAAP;AAID;;AAED,eAAeH,oBAAf,CACE/R,WADF,EAEEC,GAFF,EAGEsE,QAHF,EAIE;AAAEyN,EAAAA,SAAF;AAAaC,EAAAA;AAAb,CAJF,EAKmB;AACjB,QAAMI,OAAO,GAAI,GAAEpS,GAAI,aAAYsE,QAAS,EAA5C;AACA,MAAI8K,QAAJ;;AAEA,MAAI;AACFA,IAAAA,QAAQ,GAAG,MAAMiD,iBAAMC,OAAN,CAAc;AAC7BtS,MAAAA,GAAG,EAAEoS,OADwB;AAE7BG,MAAAA,YAAY,EAAE,MAFe;AAG7B;AACA;AACAC,MAAAA,iBAAiB,EAAE,CAACC,IAAI,IAAIA,IAAT,CALU;AAM7BC,MAAAA,KAAK,EAAE,KANsB;AAO7BC,MAAAA,cAAc,EAAEC,MAAM,IAAIA,MAAM,KAAK,GAPR;AAQ7BC,MAAAA,OAAO,EAAE;AACP,6BAAqBvO;AADd;AARoB,KAAd,CAAjB;AAYD,GAbD,CAaE,OAAOuC,KAAP,EAAc;AACd,QAAIA,KAAK,CAACuI,QAAV,EAAoB;AAClB,UAAIvI,KAAK,CAACuI,QAAN,CAAeqD,IAAnB,EAAyB;AACvB,YAAIK,IAAJ;;AACA,YAAI;AACFA,UAAAA,IAAI,GAAG5L,IAAI,CAACiL,KAAL,CAAWtL,KAAK,CAACuI,QAAN,CAAeqD,IAA1B,CAAP;AACD,SAFD,CAEE,OAAO9P,CAAP,EAAU;AACVE,UAAAA,YAAY,GAACE,QAAb,CAAsBhD,WAAtB,EAAmC,MAAnC,EAA2C8G,KAAK,CAACuI,QAAN,CAAeqD,IAA1D;AACD;;AAED,YAAIK,IAAJ,EAAU;AACR,cAAIA,IAAI,CAAC9P,OAAT,EAAkB;AAChBH,YAAAA,YAAY,GAACE,QAAb,CAAsBhD,WAAtB,EAAmC,MAAnC,EAA2C+S,IAAI,CAAC9P,OAAhD;AACD,WAFD,MAEO;AACLH,YAAAA,YAAY,GAACE,QAAb,CAAsBhD,WAAtB,EAAmC,MAAnC,EAA2C8G,KAAK,CAACuI,QAAN,CAAeqD,IAA1D;AACD;AACF;AACF;;AACD,YAAM,KAAIpS,mBAAJ,EACJ0R,SADI,EAEH,gBAAeK,OAAQ,6BAA4BvL,KAAK,CAACuI,QAAN,CAAewD,MAAO,IAA1E,GACE,4EADF,GAEE,0FAJE,CAAN;AAMD,KAvBD,MAuBO;AACL,YAAM/L,KAAN;AACD;AACF;;AAED,MAAI,CAACuI,QAAQ,CAACqD,IAAV,IAAmBT,SAAS,IAAI5C,QAAQ,CAACqD,IAAT,CAAcjO,MAAd,GAAuBwN,SAA3D,EAAuE;AACrE,UAAM,KAAI3R,mBAAJ,EAAa0R,SAAb,EAAyB,YAAW3C,QAAQ,CAACqD,IAAK,EAAlD,CAAN;AACD;;AAED,SAAOrD,QAAQ,CAACqD,IAAhB;AACD;AAED;;;;;;;;;;;AASA,eAAeM,cAAf,CACEhT,WADF,EAEEoD,GAFF,EAGE6P,iBAHF,EAIEvK,OAJF,EAKoB;AAClB;AACA;AACA,QAAMwK,cAAuB,GAAG,EAAhC;AACA,QAAM7R,sBAAsB,CAC1BrB,WAD0B,EAE1BoD,GAF0B,EAG1B,MAAO4K,SAAP,IAA6B;AAC3B,UAAMmF,YAAY,GAAGjS,gBAAKC,OAAL,CAAanB,WAAb,EAA0BgO,SAA1B,CAArB;;AACA,UAAMjN,QAAQ,GAAG,MAAMC,mBAAGC,QAAH,CAAYkS,YAAZ,CAAvB;AACA,UAAMjJ,IAAI,GAAG,uBAAOnJ,QAAP,CAAb;AACAmS,IAAAA,cAAc,CAAC1N,IAAf,CAAoB;AAAEmI,MAAAA,KAAK,EAAE,CAACwF,YAAD,CAAT;AAAyBvF,MAAAA,UAAU,EAAE,CAAC1D,IAAD,CAArC;AAA6CA,MAAAA;AAA7C,KAApB;AACA,WAAO,wBAAQ+I,iBAAR,EAA2B/I,IAA3B,CAAP;AACD,GATyB,EAU1B,IAV0B,CAA5B;AAaA,SAAO,CAAC,GAAGxB,OAAO,CAACtH,GAAR,CAAYyI,MAAhB,EAAwB,GAAGnB,OAAO,CAAC7H,OAAR,CAAgBgJ,MAA3C,EAAmD,GAAGqJ,cAAtD,CAAP;AACD;AAED;;;;;;;;AAMA,eAAeE,sBAAf,CAAsCpT,WAAtC,EAA2DoD,GAA3D,EAA4EyG,MAA5E,EAA6F;AAC3F;AACA,QAAMlJ,0BAA0B,CAACX,WAAD,EAAcoD,GAAd,CAAhC,CAF2F,CAI3F;AACA;AACA;AACA;;AACA,MAAIA,GAAG,CAACiQ,mBAAR,EAA6B;AAC3B,UAAMC,YAAsB,GAAGlQ,GAAG,CAACiQ,mBAAJ,CAAwBnR,GAAxB,CAA6B+L,CAAD,IACzD/M,gBAAKgG,IAAL,CAAUlH,WAAV,EAAuBiO,CAAvB,CAD6B,CAA/B;;AAGArH,sBAAOC,MAAP,CAAcqB,IAAd,CAAmB,mCAAnB;;AACAoL,IAAAA,YAAY,CAAC5Q,OAAb,CAAqBuL,CAAC,IAAIrH,kBAAOC,MAAP,CAAcqB,IAAd,CAAmB,OAAO+F,CAA1B,CAA1B,EAL2B,CAM3B;AACA;;AACA,UAAMsF,aAAa,GAAG,IAAIC,GAAJ,EAAtB;;AACA,SAAK,MAAMvJ,KAAX,IAAoBJ,MAApB,EAA4B;AAC1B,YAAMnC,IAAI,GAAGuC,KAAK,CAAC0D,KAAN,IAAe1D,KAAK,CAAC0D,KAAN,CAAY,CAAZ,CAA5B;AACA,YAAM8F,YAAY,GAChB,sBAAsBxJ,KAAtB,IACAA,KAAK,CAACyJ,gBADN,IAEAhM,IAFA,IAGA4L,YAAY,CAACK,IAAb,CAAmB1F,CAAD,IAAe,0BAAUvG,IAAV,EAAgBuG,CAAhB,CAAjC,CAJF;AAKAnL,MAAAA,YAAY,GAACiL,QAAb,CACE/N,WADF,EAEE,MAFF,EAGG,GAAEyT,YAAY,GAAG,SAAH,GAAe,SAAU,UAAS/L,IAAK,EAHxD;;AAKA,UAAI+L,YAAJ,EAAkB;AAChBxJ,QAAAA,KAAK,CAAC2D,UAAN,CAAiBlL,OAAjB,CAAyBwH,IAAI,IAC3BqJ,aAAa,CAACK,GAAd,CACE,WAAW1J,IAAX,IAAmB,UAAUD,KAAV,IAAmBA,KAAK,CAAC4J,IAAzB,GAAgC,MAAM5J,KAAK,CAAC4J,IAA5C,GAAmD,EAAtE,CADF,CADF;AAKD;AACF;;AACDzQ,IAAAA,GAAG,CAACmQ,aAAJ,GAAoB,CAAC,GAAGA,aAAJ,CAApB;AACA,WAAOnQ,GAAG,CAACiQ,mBAAX;AACD;;AAED,SAAOjQ,GAAP;AACD;;AAED,eAAe4L,kBAAf,CACEhP,WADF,EAEEoD,GAFF,EAGEsF,OAHF,EAIE;AACA9B,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,kBAAnB;;AAEA,QAAM4L,YAAY,GAAG,wBAAQlV,QAAR,EAAkB,SAAlB,CAArB;AACA,QAAMiL,MAAM,GAAG,MAAMmJ,cAAc,CAAChT,WAAD,EAAcoD,GAAd,EAAmB0Q,YAAnB,EAAiCpL,OAAjC,CAAnC;;AAEA9B,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,kBAAnB;;AAEA,MAAI2B,MAAM,CAACpF,MAAP,GAAgB,CAAhB,IAAqBoF,MAAM,CAAC,CAAD,CAAN,CAAU+D,UAAnC,EAA+C;AAC7C,UAAMmG,iBAAiB,CAAC/T,WAAD,EAAc6J,MAAd,CAAvB;AACD,GAFD,MAEO;AACLjD,sBAAOC,MAAP,CAAcqB,IAAd,CAAmB;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAAnB,EAAoC,+BAApC;AACD,GAZD,CAcA;;;AACA,QAAMiL,sBAAsB,CAACpT,WAAD,EAAcoD,GAAd,EAAmByG,MAAnB,CAA5B;AAEA,SAAOzG,GAAP;AACD;;AAED,eAAe0G,iBAAf,CACE9J,WADF,EAEEoD,GAFF,EAGE4Q,SAHF,EAIEpP,SAJF,EAKE8D,OALF,EAME;AACA9B,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,kBAAnB;;AAEA,QAAM4L,YAAY,GAAG,wBAAQE,SAAR,EAAmB,QAAnB,CAArB;AACA,QAAMnK,MAAM,GAAG,MAAMmJ,cAAc,CAAChT,WAAD,EAAcoD,GAAd,EAAmB0Q,YAAnB,EAAiCpL,OAAjC,CAAnC;;AAEA9B,oBAAOC,MAAP,CAAcqB,IAAd,CAAmB,eAAnB;;AAEA,MAAI2B,MAAM,CAACpF,MAAP,GAAgB,CAAhB,IAAqBoF,MAAM,CAAC,CAAD,CAAN,CAAU+D,UAAnC,EAA+C;AAC7C,UAAMH,gBAAgB,CAACzN,WAAD,EAAc6J,MAAd,EAAsBjF,SAAtB,CAAtB;AACD,GAFD,MAEO;AACLgC,sBAAOC,MAAP,CAAcqB,IAAd,CAAmB;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAAnB,EAAoC,+BAApC;AACD,GAZD,CAcA;;;AACA,QAAMiL,sBAAsB,CAACpT,WAAD,EAAcoD,GAAd,EAAmByG,MAAnB,CAA5B;AAEA,SAAO;AAAEzG,IAAAA,GAAF;AAAOyG,IAAAA;AAAP,GAAP;AACD;;AAED,eAAeqG,2BAAf,CAA2C;AACzClQ,EAAAA,WADyC;AAEzC4D,EAAAA,IAFyC;AAGzCR,EAAAA,GAHyC;AAIzCnD,EAAAA;AAJyC,CAA3C,EAUG;AACD,MAAIgU,eAAe,GAAI,GAAExF,kBAAO1K,GAAP,CAAWmQ,MAAO,MAAKzF,kBAAO1K,GAAP,CAAWoQ,IAAK,EAAhE;;AACA,MAAI1F,kBAAO1K,GAAP,CAAWtD,IAAf,EAAqB;AACnBwT,IAAAA,eAAe,GAAI,GAAEA,eAAgB,IAAGxF,kBAAO1K,GAAP,CAAWtD,IAAK,EAAxD;AACD;;AACDwT,EAAAA,eAAe,GAAI,GAAEA,eAAgB,KAAIrQ,IAAI,CAACwH,QAAS,IAAGhI,GAAG,CAACK,IAAK,SAAnE;;AAEA,MAAIL,GAAG,CAACgR,MAAJ,CAAWC,mBAAf,EAAoC;AAClC,UAAMzT,QAAQ,GAAG,MAAMgP,aAAa,GAACC,gBAAd,CAA+B5P,GAA/B,EAAoC;AACzD,8BAAwBmD,GAAG,CAACzB,UAD6B;AAEzD,2BAAqB,SAFoC;AAGzDmO,MAAAA,MAAM,EAAE;AAHiD,KAApC,CAAvB;AAKAlP,IAAAA,QAAQ,CAAC6K,SAAT,GAAqBwI,eAArB;AACArT,IAAAA,QAAQ,CAACe,UAAT,GAAsB,aAAtB;AACA,UAAMX,mBAAGsT,SAAH,CACJpT,gBAAKC,OAAL,CAAanB,WAAb,EAA0BoD,GAAG,CAACgR,MAAJ,CAAWC,mBAArC,CADI,EAEJlN,IAAI,CAACC,SAAL,CAAexG,QAAf,CAFI,CAAN;AAID;;AAED,MAAIwC,GAAG,CAACgR,MAAJ,CAAWG,eAAf,EAAgC;AAC9B,UAAM3T,QAAQ,GAAG,MAAMgP,aAAa,GAACC,gBAAd,CAA+B5P,GAA/B,EAAoC;AACzD,8BAAwBmD,GAAG,CAACzB,UAD6B;AAEzD,2BAAqB,KAFoC;AAGzDmO,MAAAA,MAAM,EAAE;AAHiD,KAApC,CAAvB;AAKAlP,IAAAA,QAAQ,CAAC6K,SAAT,GAAqBwI,eAArB;AACArT,IAAAA,QAAQ,CAACe,UAAT,GAAsB,aAAtB;AACA,UAAMX,mBAAGsT,SAAH,CACJpT,gBAAKC,OAAL,CAAanB,WAAb,EAA0BoD,GAAG,CAACgR,MAAJ,CAAWG,eAArC,CADI,EAEJpN,IAAI,CAACC,SAAL,CAAexG,QAAf,CAFI,CAAN;AAID;AACF,C,CAED;;;AACA,eAAemT,iBAAf,CAAiC/T,WAAjC,EAAsD6J,MAAtD,EAAuE;AACrE;AACA,QAAM6D,KAAqC,GAAG,EAA9C;AACA7D,EAAAA,MAAM,CAACnH,OAAP,CAAeuH,KAAK,IAAI;AACtBA,IAAAA,KAAK,CAAC0D,KAAN,CAAYjL,OAAZ,CAAoB,CAACxB,IAAD,EAAeyB,KAAf,KAAiC;AACnD+K,MAAAA,KAAK,CAACzD,KAAK,CAAC2D,UAAN,CAAiBjL,KAAjB,CAAD,CAAL,GAAiCzB,IAAjC;AACD,KAFD;AAGD,GAJD,EAHqE,CASrE;;AACA,QAAM0C,IAAI,GAAG,MAAMC,gBAAYC,mBAAZ,EAAnB;;AACA,QAAMC,GAAG,GAAGC,gBAAMC,aAAN,CAAoBL,IAApB,CAAZ;;AACA,QAAMM,MAAM,GAAG,MAAMH,GAAG,CAACI,SAAJ,CAAc,iBAAd,EAAiC;AAAEyH,IAAAA,IAAI,EAAED,MAAM,CAACC,IAAP,CAAY8B,KAAZ;AAAR,GAAjC,CAArB;AAEA,QAAM8G,KAAK,GAAGtQ,MAAM,CAACuQ,QAArB;AACA,QAAMC,OAAO,GAAG/I,MAAM,CAACC,IAAP,CAAY8B,KAAZ,EAAmB9L,MAAnB,CAA0BkM,GAAG,IAAI,CAAC0G,KAAK,CAAC1G,GAAD,CAAL,CAAW6G,MAA7C,CAAhB;;AAEA,MAAID,OAAO,CAACjQ,MAAR,KAAmB,CAAvB,EAA0B;AACxBmC,sBAAOC,MAAP,CAAcqB,IAAd,CAAmB;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAAnB,EAAqC,6BAArC;AACD,GAnBoE,CAqBrE;;;AACA,QAAMnG,OAAO,CAACC,GAAR,CACJ,sBAAMyS,OAAN,EAAe,CAAf,EAAkBxS,GAAlB,CAAsB,MAAM0J,IAAN,IAAc;AAClC,UAAMuE,QAAQ,GAAG,KAAIC,mBAAJ,GAAjB;;AACA,SAAK,MAAMtC,GAAX,IAAkBlC,IAAlB,EAAwB;AACtB9I,MAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA4C,aAAY0N,KAAK,CAACI,GAAD,CAAM,EAAnE;AAEA,YAAM8G,YAAY,GAAGlH,KAAK,CAACI,GAAD,CAAL,CAAWkC,OAAX,CAAmBhQ,WAAnB,EAAgC,EAAhC,CAArB;;AACA4G,wBAAOC,MAAP,CAAcqB,IAAd,CAAmB;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAAnB,EAAqC,aAAYyM,YAAa,EAA9D;;AAEAzE,MAAAA,QAAQ,CAACE,MAAT,CAAgBvC,GAAhB,EAAqB9M,mBAAG6T,gBAAH,CAAoBnH,KAAK,CAACI,GAAD,CAAzB,CAArB,EAAsDJ,KAAK,CAACI,GAAD,CAA3D;AACD;;AAED,UAAMlK,IAAI,GAAG,MAAMC,gBAAYC,mBAAZ,EAAnB;;AACA,UAAMC,GAAG,GAAGC,gBAAMC,aAAN,CAAoBL,IAApB,CAAZ;;AACA,UAAMG,GAAG,CAACuM,mBAAJ,CAAwB,eAAxB,EAAyCH,QAAzC,CAAN;AACD,GAdD,CADI,CAAN;AAiBD;;AAcD,eAAe2E,cAAf,CACE9U,WADF,EAEE2D,OAA4D,GAAG,EAFjE,EAGE;AACA,MAAI,CAACA,OAAO,CAAC0E,SAAb,EAAwB;AACtB;AACA,UAAM;AAAEjF,MAAAA,GAAF;AAAOuG,MAAAA;AAAP,QAAe,yBAAU3J,WAAV,CAArB;AACA,UAAM+U,UAAU,GAAG,8BAAe/U,WAAf,CAAnB;AACA,WAAO;AACLoD,MAAAA,GADK;AAELuG,MAAAA,GAFK;AAGLoL,MAAAA,UAAU,EAAE,8BAAe/U,WAAf,CAHP;AAILgV,MAAAA,YAAY,EAAED,UAAU,KAAK,UAAf,GAA4B,OAA5B,GAAsC;AAJ/C,KAAP;AAMD,GAVD,MAUO;AACL;AACA,WAAO;AACL3R,MAAAA,GAAG,EAAE,MAAM6R,UAAU,GAACC,WAAX,CAAuBvR,OAAO,CAAC0E,SAA/B,EAA0C1E,OAA1C,CADN;AAELoR,MAAAA,UAAU,EAAEpR,OAAO,CAAC0E,SAFf;AAGL2M,MAAAA,YAAY,EAAE,EAHT;AAILrL,MAAAA,GAAG,EAAE;AAJA,KAAP;AAMD;AACF;;AA2DD,SAASwL,iBAAT,CAA2BxR,OAA3B,EAAyCP,GAAzC,EAAmD2R,UAAnD,EAAuEC,YAAvE,EAA6F;AAC3F,MAAIrR,OAAO,CAACY,QAAR,KAAqB,KAArB,IAA8BZ,OAAO,CAACY,QAAR,KAAqB,KAAvD,EAA8D;AAC5D,QAAI,CAACnB,GAAG,CAAChC,GAAL,IAAY,CAACgC,GAAG,CAAChC,GAAJ,CAAQgU,gBAAzB,EAA2C;AACzC,YAAM,KAAI9U,mBAAJ,EACJ,kBADI,EAEH,8EAAD,GACG,yBAAwByU,UAAW,QAAOC,YAAa,uBAHtD,CAAN;AAKD;AACF;;AAED,MAAIrR,OAAO,CAACY,QAAR,KAAqB,SAArB,IAAkCZ,OAAO,CAACY,QAAR,KAAqB,KAA3D,EAAkE;AAChE,QAAI,CAACnB,GAAG,CAACvC,OAAL,IAAgB,CAACuC,GAAG,CAACvC,OAAJ,CAAYwU,OAAjC,EAA0C;AACxC,YAAM,KAAI/U,mBAAJ,EACJ,kBADI,EAEH,6EAAD,GACG,yBAAwByU,UAAW,QAAOC,YAAa,kBAHtD,CAAN;AAKD;AACF;AACF;;AACD,SAASM,gBAAT,CAA0B3R,OAA1B,EAAwC;AACtC,QAAM4R,MAAM,GAAGC,eAAIC,MAAJ,GAAa7J,IAAb,CAAkB;AAC/B8J,IAAAA,OAAO,EAAEF,eAAIG,OAAJ,EADsB;AAE/BC,IAAAA,IAAI,EAAEJ,eAAIK,MAAJ,EAFyB;AAG/BtR,IAAAA,QAAQ,EAAEiR,eAAIM,GAAJ,GAAUC,KAAV,CAAgB,KAAhB,EAAuB,SAAvB,EAAkC,KAAlC,CAHqB;AAI/BC,IAAAA,MAAM,EAAER,eAAIS,KAAJ,EAJuB;AAK/BpC,IAAAA,IAAI,EAAE2B,eAAIM,GAAJ,GAAUC,KAAV,CAAgB,SAAhB,EAA2B,WAA3B,EAAwC,QAAxC,EAAkD,YAAlD,EAAgE,KAAhE,CALyB;AAM/B1R,IAAAA,cAAc,EAAEmR,eAAIK,MAAJ,GAAaK,KAAb,CAAmB,oBAAnB,CANe;AAO/Bd,IAAAA,gBAAgB,EAAEI,eAAIK,MAAJ,GAAaK,KAAb,CAAmB,2BAAnB,CAPa;AAQ/B7N,IAAAA,SAAS,EAAEmN,eAAIK,MAAJ,EARoB;AAS/BlU,IAAAA,UAAU,EAAE6T,eAAIK,MAAJ,GAAatU,MAAb;AATmB,GAAlB,CAAf;;AAYA,QAAM;AAAEuF,IAAAA;AAAF,MAAYyO,MAAM,CAACY,QAAP,CAAgBxS,OAAhB,CAAlB;;AACA,MAAImD,KAAJ,EAAW;AACT,UAAM,KAAIxG,mBAAJ,EAAa,iBAAb,EAAgCwG,KAAK,CAACsP,QAAN,EAAhC,CAAN;AACD;AACF;;AAED,eAAeC,YAAf,CACErW,WADF,EAEE2D,OAFF,EAGE;AACA,QAAM;AAAEP,IAAAA,GAAF;AAAOuG,IAAAA,GAAP;AAAYoL,IAAAA,UAAZ;AAAwBC,IAAAA;AAAxB,MAAyC,MAAMF,cAAc,CAAC9U,WAAD,EAAc2D,OAAd,CAAnE;;AAEA,MAAI,CAACP,GAAD,IAAQ,CAACuG,GAAb,EAAkB;AAChB,UAAM,KAAIrJ,mBAAJ,EACJ,iBADI,EAEH,iBAAgByU,UAAW,uBAAsB/U,WAAY,EAF1D,CAAN;AAID,GARD,CAUA;AACA;;;AACA,MAAI,CAACoD,GAAG,CAACkT,OAAL,IAAgB,aAAa3M,GAA7B,IAAoCA,GAAG,CAAC2M,OAA5C,EAAqD;AACnDlT,IAAAA,GAAG,CAACkT,OAAJ,GAAc3M,GAAG,CAAC2M,OAAlB;AACD;;AACD,MAAI,CAAClT,GAAG,CAACmT,IAAL,IAAa,UAAU5M,GAAvB,IAA8B,OAAOA,GAAG,CAAC4M,IAAX,KAAoB,QAAtD,EAAgE;AAC9DnT,IAAAA,GAAG,CAACmT,IAAJ,GAAW5M,GAAG,CAAC4M,IAAf;AACD;;AACD,MAAI,CAACnT,GAAG,CAACK,IAAL,IAAa,OAAOL,GAAG,CAACmT,IAAX,KAAoB,QAArC,EAA+C;AAC7CnT,IAAAA,GAAG,CAACK,IAAJ,GAAW,wBAAKL,GAAG,CAACmT,IAAJ,CAASC,WAAT,EAAL,CAAX;AACD;;AACD,SAAO;AAAEpT,IAAAA,GAAF;AAAO2R,IAAAA,UAAP;AAAmBC,IAAAA;AAAnB,GAAP;AACD;;AAEM,eAAeyB,mBAAf,CACLzW,WADK,EAEL2D,OAA4B,GAAG,EAF1B,EAGuB;AAC5B,QAAMC,IAAI,GAAG,MAAMC,gBAAYC,mBAAZ,EAAnB;;AAEAzD,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AACAsV,EAAAA,gBAAgB,CAAC3R,OAAD,CAAhB;;AACA,QAAM;AAAEP,IAAAA;AAAF,MAAU,MAAMiT,YAAY,CAACrW,WAAD,EAAc2D,OAAd,CAAlC;;AAEA,QAAMI,GAAG,GAAGC,gBAAMC,aAAN,CAAoBL,IAApB,CAAZ;;AACA,SAAO,MAAMG,GAAG,CAACI,SAAJ,CAAc,cAAd,EAA8B;AAAEvD,IAAAA,QAAQ,EAAEwC,GAAZ;AAAiBO,IAAAA;AAAjB,GAA9B,CAAb;AACD;;AAEM,eAAe+S,eAAf,CACL1W,WADK,EAEL2D,OAA4B,GAAG,EAF1B,EAGwB;AAC7B,QAAMC,IAAI,GAAG,MAAMC,gBAAYC,mBAAZ,EAAnB;;AAEAzD,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AACAsV,EAAAA,gBAAgB,CAAC3R,OAAD,CAAhB;;AACA,QAAM;AAAEP,IAAAA,GAAF;AAAO2R,IAAAA,UAAP;AAAmBC,IAAAA;AAAnB,MAAoC,MAAMqB,YAAY,CAACrW,WAAD,EAAc2D,OAAd,CAA5D;;AACAwR,EAAAA,iBAAiB,CAACxR,OAAD,EAAUP,GAAV,EAAe2R,UAAf,EAA2BC,YAA3B,CAAjB;;AAEA1G,EAAAA,SAAS,GAACC,QAAV,CAAmB,iBAAnB,EAAsC;AACpCvO,IAAAA,WADoC;AAEpCwO,IAAAA,aAAa,EAAEC,kBAAOD,aAFc;AAGpCjK,IAAAA,QAAQ,EAAEZ,OAAO,CAACY;AAHkB,GAAtC;;AAMA,QAAMR,GAAG,GAAGC,gBAAMC,aAAN,CAAoBL,IAApB,CAAZ;;AACA,SAAO,MAAMG,GAAG,CAAC4S,QAAJ,CAAa,aAAb,EAA4B;AAAE/V,IAAAA,QAAQ,EAAEwC,GAAZ;AAAiBO,IAAAA;AAAjB,GAA5B,CAAb;AACD;;AAED,eAAeiT,oBAAf,CACE5W,WADF,EAEEC,GAFF,EAGE4W,OAAe,GAAG,GAHpB,EAIiB;AACf,MAAI;AACF,UAAMxH,QAAQ,GAAG,MAAMiD,iBAAMC,OAAN,CAAc;AACnCtS,MAAAA,GADmC;AAEnCuS,MAAAA,YAAY,EAAE,MAFqB;AAGnCG,MAAAA,KAAK,EAAE;AAH4B,KAAd,CAAvB;;AAKA,QAAI,0BAA0BmE,IAA1B,CAA+BzH,QAAQ,CAACqD,IAAxC,CAAJ,EAAmD;AACjD,aAAO,IAAP;AACD,KAFD,MAEO,IAAImE,OAAO,KAAK,CAAhB,EAAmB;AACxB/T,MAAAA,YAAY,GAACE,QAAb,CACEhD,WADF,EAEE,MAFF,EAGG,6DAA4DqP,QAAQ,CAACqD,IAAK,EAH7E;AAKD;AACF,GAfD,CAeE,OAAO9P,CAAP,EAAU;AACV,QAAIiU,OAAO,KAAK,CAAhB,EAAmB;AACjB/T,MAAAA,YAAY,GAACE,QAAb,CACEhD,WADF,EAEE,MAFF,EAGG,4CAA2C4C,CAAC,CAACK,OAAQ,EAHxD;AAKD;AACF;;AAED,MAAI4T,OAAO,IAAI,CAAf,EAAkB;AAChB,UAAM,IAAItU,KAAJ,CAAU,qCAAV,CAAN;AACD,GAFD,MAEO;AACL,UAAM,2BAAW,GAAX,CAAN;AACA,WAAOqU,oBAAoB,CAAC5W,WAAD,EAAcC,GAAd,EAAmB4W,OAAO,GAAG,CAA7B,CAA3B;AACD;AACF,C,CAED;;;AACA,MAAME,qBAAqB,GAAG,+CAA9B,C,CAEA;AACA;;AACA,MAAMC,2BAA2B,GAAI,4LAArC;AACA,MAAMC,gCAAgC,GAAI;;sEAA1C;;AAIA,SAASC,kBAAT,CAA4BlX,WAA5B,EAAiDmX,KAAjD,EAAgEzE,IAAhE,EAA8E;AAC5E,MAAI0E,MAAM,GAAG1E,IAAI,CAAC0D,QAAL,EAAb;;AACA,MAAI,CAACgB,MAAL,EAAa;AACX;AACD,GAJ2E,CAK5E;AACA;;;AACA,MAAIC,kCAAkC,CAACrX,WAAD,EAAcmX,KAAd,EAAqBC,MAArB,CAAtC,EAAoE;AAClEtU,IAAAA,YAAY,GAACiL,QAAb,CACE/N,WADF,EAEE,MAFF,EAGG,wCAAuCoX,MAAO,EAHjD,EAIE,yCAJF;AAMA;AACD;;AACD,MAAIE,8BAA8B,CAACF,MAAD,CAA9B,IAA0CG,uBAAuB,CAACH,MAAD,CAArE,EAA+E;AAC7EtU,IAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA2CoX,MAA3C;AACA;AACD;;AAED,MAAIA,MAAM,CAACI,QAAP,CAAgBR,2BAAhB,CAAJ,EAAkD;AAChDlU,IAAAA,YAAY,GAACE,QAAb,CAAsBhD,WAAtB,EAAmC,MAAnC,EAA2CiX,gCAA3C;AACA;AACD;;AAED,MAAIG,MAAM,CAACI,QAAP,CAAgBT,qBAAhB,CAAJ,EAA4C;AAC1CK,IAAAA,MAAM,GAAGA,MAAM,CAACpH,OAAP,CAAe+G,qBAAf,EAAsC,EAAtC,CAAT;AACD;;AAED,MAAI,qCAAqCD,IAArC,CAA0CM,MAA1C,CAAJ,EAAuD;AACrDtU,IAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,OAAnC,EAA4CoX,MAA5C;AACA;AACD;;AACD,MAAID,KAAK,KAAK,MAAd,EAAsB;AACpBrU,IAAAA,YAAY,GAAC2U,OAAb,CAAqBzX,WAArB,EAAkC,OAAlC,EAA2CoX,MAA3C;AACD,GAFD,MAEO;AACLtU,IAAAA,YAAY,GAACE,QAAb,CAAsBhD,WAAtB,EAAmC,OAAnC,EAA4CoX,MAA5C;AACD;AACF;;AAED,SAASE,8BAAT,CAAwCF,MAAxC,EAAwD;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAO,mCAAmCN,IAAnC,CAAwCM,MAAxC,CAAP;AACD;;AAED,SAASG,uBAAT,CAAiCH,MAAjC,EAAiD;AAC/C,SAAOA,MAAM,CAACM,UAAP,CACL,mGADK,CAAP;AAGD;;AAED,SAASL,kCAAT,CACErX,WADF,EAEEmX,KAFF,EAGEC,MAHF,EAIW;AACT,MACED,KAAK,KAAK,OAAV,IACA,CAACC,MAAM,CAACM,UAAP,CAAkB,mDAAlB,CAFH,EAGE;AACA,WAAO,KAAP;AACD;;AAED,QAAMC,0BAA0B,GAAGzW,gBAAKgG,IAAL,CACjClH,WADiC,EAEjC,cAFiC,EAGjC,cAHiC,EAIjC,cAJiC,CAAnC;;AAMA,QAAM4X,6BAA6B,GAAG,6BAAaD,0BAAb,CAAtC;AACA,QAAME,oCAAoC,GAAG,IAAIC,MAAJ,CAC1C,UAASF,6BAA8B,oBAAmBA,6BAA8B,IAD9C,CAA7C;AAGA,SAAOC,oCAAoC,CAACf,IAArC,CAA0CM,MAA1C,CAAP;AACD;;AAED,SAASW,iCAAT,CAA2ChF,IAA3C,EAAwD;AACtD,SAAOA,IAAI,CAACtO,MAAL,KAAgB,CAAhB,IAAqBsO,IAAI,CAAC,CAAD,CAAJ,KAAY,yBAAxC;AACD;;AAED,SAASiF,4BAAT,CAAsCjF,IAAtC,EAAmD;AACjD,SACEA,IAAI,CAACtO,MAAL,KAAgB,CAAhB,KACC,8CAA8CqS,IAA9C,CAAmD/D,IAAI,CAAC,CAAD,CAAvD,KACC,0BAA0B+D,IAA1B,CAA+B/D,IAAI,CAAC,CAAD,CAAnC,CAFF,CADF;AAKD;;AAID,SAASkF,iBAAT,CAA2BjY,WAA3B,EAAgDkY,QAAhD,EAAkEC,UAAlE,EAAsFC,IAAtF,EAAiG;AAC/F,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,IAAI,CAAC3T,MAAzB,EAAiC4T,CAAC,EAAlC,EAAsC;AACpC,UAAM7L,GAAG,GAAG4L,IAAI,CAACC,CAAD,CAAhB;AACA,QAAItF,IAAI,GAAG,OAAOvG,GAAG,CAACuG,IAAX,KAAoB,QAApB,GAA+B,CAACvG,GAAG,CAACuG,IAAL,CAA/B,GAA4CvG,GAAG,CAACuG,IAA3D;AACA,QAAI;AAAEoE,MAAAA;AAAF,QAAY3K,GAAhB;;AAEA,QAAIuL,iCAAiC,CAAChF,IAAD,CAArC,EAA6C;AAC3CoE,MAAAA,KAAK,GAAG,OAAR;AACD;;AACD,QAAIa,4BAA4B,CAACjF,IAAD,CAAhC,EAAwC;AACtCA,MAAAA,IAAI,GAAG,CAAE,0BAAyBoF,UAAW,GAAtC,CAAP;AACD;;AAED,UAAMG,IAAI,GAAGvF,IAAI,CAAC7Q,GAAL,CAAUqW,GAAD,IAAc;AAClC,UAAI,OAAOA,GAAP,KAAe,WAAnB,EAAgC;AAC9B,eAAO,WAAP;AACD;;AACD,UAAIA,GAAG,KAAK,MAAZ,EAAoB;AAClB,eAAO,MAAP;AACD;;AACD,UAAI,OAAOA,GAAP,KAAe,QAAf,IAA2B,OAAOA,GAAP,KAAe,QAA1C,IAAsD,OAAOA,GAAP,KAAe,SAAzE,EAAoF;AAClF,eAAOA,GAAP;AACD;;AACD,UAAI;AACF,eAAOpR,IAAI,CAACC,SAAL,CAAemR,GAAf,CAAP;AACD,OAFD,CAEE,OAAO3V,CAAP,EAAU;AACV,eAAO2V,GAAG,CAACnC,QAAJ,EAAP;AACD;AACF,KAfY,CAAb;AAgBA,UAAMoC,QAAQ,GACZrB,KAAK,KAAK,MAAV,IAAoBA,KAAK,KAAK,MAA9B,IAAwCA,KAAK,KAAK,OAAlD,IAA6DA,KAAK,KAAK,OAAvE,GACKA,KADL,GAEI,MAHN;AAIArU,IAAAA,YAAY,GAACsO,SAAb,CAAuBpR,WAAvB,EAAoCwY,QAApC,EACE;AACEC,MAAAA,GAAG,EAAE,QADP;AAEEP,MAAAA,QAFF;AAGEC,MAAAA,UAHF;AAIEO,MAAAA,UAAU,EAAElM,GAAG,CAACkM,UAJlB;AAKEC,MAAAA,UAAU,EAAEnM,GAAG,CAACmM,UALlB;AAMEC,MAAAA,aAAa,EAAEpM,GAAG,CAACoM;AANrB,KADF,EASE,GAAGN,IATL;AAWD;AACF;;AACM,eAAe1H,2BAAf,CACL5Q,WADK,EAEL2D,OAAqB,GAAG,EAFnB,EAGLkV,OAAgB,GAAG,IAHd,EAIU;AACfxY,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AACA,QAAMkR,0BAA0B,CAAClR,WAAD,CAAhC;AACA,QAAM8Y,QAAQ,GAACC,cAAT,EAAN,CAHe,CAGkB;;AACjC,QAAMD,QAAQ,GAACE,yBAAT,CAAmChZ,WAAnC,CAAN;AAEA,QAAM;AAAEoD,IAAAA;AAAF,MAAU,yBAAUpD,WAAV,CAAhB;AAEA,MAAIL,YAAY,GAAG,MAAMY,iBAAiB,CAAC,KAAD,CAA1C,CARe,CAQoC;;AAEnD,QAAM0Y,qBAA6B,GAAG3V,OAAO,CAACnC,OAAR,CAAgBD,gBAAKgG,IAAL,CAAUgS,SAAV,EAAqB,mBAArB,CAAhB,CAAtC,CAVe,CAYf;;;AACA,QAAMC,gBAAgB,GAAG;AAAEC,IAAAA,IAAI,EAAE,IAAR;AAAcC,IAAAA,OAAO,EAAE,IAAvB;AAA6BC,IAAAA,QAAQ,EAAE;AAAvC,GAAzB;AACA,QAAMC,UAAU,GACd5V,OAAO,CAAC6E,MAAR,KAAmB,MAAnB,GACI,gCAAkB,EAAlB,EAAsB2Q,gBAAtB,CADJ,GAEI,mCAAqB,EAArB,EAAyBA,gBAAzB,CAHN;AAKA,MAAIK,YAAoC,GAAG;AACzC/Y,IAAAA,IAAI,EAAEd,YADmC;AAEzCsZ,IAAAA,qBAFyC;AAGzCM,IAAAA;AAHyC,GAA3C;;AAMA,MAAI5V,OAAO,CAACkN,aAAR,IAAyB4I,QAAQ,GAACC,aAAT,CAAuBtW,GAAvB,EAA4B,QAA5B,CAA7B,EAAoE;AAClEoW,IAAAA,YAAY,CAAC3I,aAAb,GAA6B,IAA7B;AACD;;AAED,MAAI4I,QAAQ,GAACE,aAAT,CAAuBvW,GAAvB,EAA4B,QAA5B,CAAJ,EAA2C;AACzC;AACA;AACA,QAAI;AACFoW,MAAAA,YAAY,CAACI,YAAb,GAA4B,6BAC1B,iCAD0B,EAE1B5Z,WAF0B,EAG1BoD,GAH0B,CAA5B;AAKD,KAND,CAME,OAAOR,CAAP,EAAU;AACV4W,MAAAA,YAAY,CAACI,YAAb,GAA4B,6BAAc,2BAAd,EAA2C5Z,WAA3C,EAAwDoD,GAAxD,CAA5B;AACD;AACF;;AAED,MAAIO,OAAO,CAACmN,UAAZ,EAAwB;AACtB0I,IAAAA,YAAY,CAAC,aAAD,CAAZ,GAA8B7V,OAAO,CAACmN,UAAtC;AACD;;AAED,MAAI,CAAC2I,QAAQ,GAACE,aAAT,CAAuBvW,GAAvB,EAA4B,QAA5B,CAAL,EAA4C;AAC1C,WAAOoW,YAAY,CAACP,qBAApB;AACD;;AACD,QAAMY,gBAAgB,GAAGzW,GAAG,CAACoW,YAA7B;;AAEA,MAAIK,gBAAJ,EAAsB;AAAA;;AACpB;AACA;AACA;AACA,QAAIA,gBAAgB,CAAC7R,MAArB,EAA6B;AAC3B6R,MAAAA,gBAAgB,CAAC7R,MAAjB,GAA0B9G,gBAAKC,OAAL,CAAanB,WAAb,EAA0B6Z,gBAAgB,CAAC7R,MAA3C,CAA1B;AACD,KANmB,CAQpB;;;AACA,UAAM8R,cAAc,4BAAGD,gBAAgB,CAACN,UAApB,yEAAkC,EAAtD;AAEAC,IAAAA,YAAY,GAAG,EACb,GAAGA,YADU;AAEb,SAAGK,gBAFU;AAGb;AACA;AACAN,MAAAA,UAAU,EAAE,CAAC,GAAG,IAAI/F,GAAJ,CAAQ,CAAC,GAAGgG,YAAY,CAACD,UAAjB,EAA6B,GAAGO,cAAhC,CAAR,CAAJ;AALC,KAAf;;AAQA,QAAID,gBAAgB,CAACpZ,IAAjB,KAA0BoH,SAA1B,IAAuCgS,gBAAgB,CAACpZ,IAAjB,KAA0B,IAArE,EAA2E;AACzEd,MAAAA,YAAY,GAAGka,gBAAgB,CAACpZ,IAAhC;AACD;AACF;;AACD,QAAMsZ,OAAO,GAAG,CAAC,OAAD,CAAhB;;AACA,OAAK,MAAM,CAACjM,GAAD,EAAMkM,GAAN,CAAX,IAAyBrO,MAAM,CAACsO,OAAP,CAAeT,YAAf,CAAzB,EAAuD;AACrD;AACA;AACA,QAAIQ,GAAG,IAAI,OAAOA,GAAP,KAAe,SAA1B,EAAqC;AACnCD,MAAAA,OAAO,CAACvU,IAAR,CAAc,KAAIsI,GAAI,EAAtB;AACD,KAFD,MAEO,IAAIkM,GAAJ,EAAS;AACdD,MAAAA,OAAO,CAACvU,IAAR,CAAc,KAAIsI,GAAI,EAAtB,EAAyBkM,GAAzB;AACD;AACF;;AAED,MAAIE,OAAO,CAACC,GAAR,CAAYC,UAAhB,EAA4B;AAC1BL,IAAAA,OAAO,CAACvU,IAAR,CAAa,WAAb;AACD;;AAED,MAAI7B,OAAO,CAACoN,KAAZ,EAAmB;AACjBgJ,IAAAA,OAAO,CAACvU,IAAR,CAAa,eAAb;AACD,GA5Fc,CA4Fb;;;AACF,QAAM6U,cAAc,GAAG,6BAAc,+BAAd,EAA+Cra,WAA/C,EAA4DoD,GAA5D,CAAvB;AACA,QAAMkX,OAAO,GAAGlX,GAAG,CAACmX,SAAJ,IAAiBF,cAAjC;AACA,MAAIG,QAAJ,CA/Fe,CAgGf;AACA;;AACA,MAAIpX,GAAG,CAACmX,SAAR,EAAmB;AACjBC,IAAAA,QAAQ,GAAGC,uBAAuB,CAACza,WAAD,CAAlC;AACD,GAFD,MAEO;AACLwa,IAAAA,QAAQ,GAAG,IAAX;AACD,GAtGc,CAuGf;AACA;AACA;AACA;;;AACA,QAAME,WAAW,GAAGF,QAAQ,GAAG;AAAEG,IAAAA,SAAS,EAAEH;AAAb,GAAH,GAA6B,EAAzD;;AACA,QAAMI,eAAe,GAAGC,yBAAcC,IAAd,CAAmBR,OAAnB,EAA4BP,OAA5B,EAAqC;AAC3DgB,IAAAA,GAAG,EAAE/a,WADsD;AAE3Dma,IAAAA,GAAG,EAAE,EACH,GAAGD,OAAO,CAACC,GADR;AAEHa,MAAAA,qBAAqB,EAAEhb,WAFpB;AAGHib,MAAAA,oBAAoB,EAAE,GAHnB;AAIH,SAAGP;AAJA,KAFsD;AAQ3DQ,IAAAA,MAAM,EAAE;AARmD,GAArC,CAAxB;;AAUA,QAAMrb,eAAe,GAACsb,oBAAhB,CAAqCnb,WAArC,EAAkD;AACtDL,IAAAA,YADsD;AAEtDyb,IAAAA,WAAW,EAAER,eAAe,CAACS;AAFyB,GAAlD,CAAN,CAtHe,CAyHX;;AACJnB,EAAAA,OAAO,CAACoB,EAAR,CAAW,MAAX,EAAmB,MAAM;AACvB,6BAASV,eAAe,CAACS,GAAzB;AACD,GAFD;;AAGA,MAAI,CAACT,eAAe,CAACW,MAArB,EAA6B;AAC3B,UAAM,IAAIhZ,KAAJ,CAAU,uEAAV,CAAN;AACD;;AACD,MAAI,CAACqY,eAAe,CAACY,MAArB,EAA6B;AAC3B,UAAM,IAAIjZ,KAAJ,CAAU,uEAAV,CAAN;AACD;;AACDqY,EAAAA,eAAe,CAACW,MAAhB,CAAuBE,WAAvB,CAAmC,MAAnC;AACAb,EAAAA,eAAe,CAACY,MAAhB,CAAuBC,WAAvB,CAAmC,MAAnC;AACAb,EAAAA,eAAe,CAACW,MAAhB,CAAuBG,IAAvB,CAA4B,uBAA5B,EAAqCJ,EAArC,CAAwC,MAAxC,EAAgD5I,IAAI,IAAI;AACtD,QAAImG,OAAJ,EAAa;AACX3B,MAAAA,kBAAkB,CAAClX,WAAD,EAAc,MAAd,EAAsB0S,IAAtB,CAAlB;AACD;AACF,GAJD;AAKAkI,EAAAA,eAAe,CAACY,MAAhB,CAAuBF,EAAvB,CAA0B,MAA1B,EAAkC5I,IAAI,IAAI;AACxC,QAAImG,OAAJ,EAAa;AACX3B,MAAAA,kBAAkB,CAAClX,WAAD,EAAc,OAAd,EAAuB0S,IAAvB,CAAlB;AACD;AACF,GAJD;AAKA,QAAMiJ,WAAW,GAAG,IAAI3Z,OAAJ,CAAY,CAACb,OAAD,EAAUya,MAAV,KAAqB;AACnDhB,IAAAA,eAAe,CAACiB,IAAhB,CAAqB,MAArB,EAA6B,MAAM9S,IAAN,IAAc;AACzCjG,MAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA4C,0CAAyC+I,IAAK,EAA1F;;AACA,UAAIA,IAAJ,EAAU;AACR6S,QAAAA,MAAM,CAAC,IAAIrZ,KAAJ,CAAW,0CAAyCwG,IAAK,EAAzD,CAAD,CAAN;AACD,OAFD,MAEO;AACL5H,QAAAA,OAAO;AACR;;AACD,UAAI;AACF,cAAMtB,eAAe,GAACsb,oBAAhB,CAAqCnb,WAArC,EAAkD;AACtDL,UAAAA,YAAY,EAAE,IADwC;AAEtDyb,UAAAA,WAAW,EAAE;AAFyC,SAAlD,CAAN;AAID,OALD,CAKE,OAAOxY,CAAP,EAAU,CAAE;AACf,KAbD;AAcD,GAfmB,CAApB;AAgBA,QAAMkZ,WAAW,GAAG,MAAM5b,QAAQ,GAAC6b,uBAAT,CAAiC/b,WAAjC,EAA8C;AACtEgc,IAAAA,OAAO,EAAE,MAD6D;AAEtEC,IAAAA,QAAQ,EAAE;AAF4D,GAA9C,CAA1B;AAIA,QAAMja,OAAO,CAACka,IAAR,CAAa,CAACtF,oBAAoB,CAAC5W,WAAD,EAAe,GAAE8b,WAAY,SAA7B,CAArB,EAA6DH,WAA7D,CAAb,CAAN;AACD,C,CAED;AACA;AACA;;;AACA,SAASlB,uBAAT,CAAiCza,WAAjC,EAA8D;AAC5D,QAAM0N,KAAK,GAAG,EAAd;;AACA,MAAIyO,SAAS,GAAGjb,gBAAKC,OAAL,CAAanB,WAAb,CAAhB;;AACA,SAAO,IAAP,EAAa;AACX0N,IAAAA,KAAK,CAAClI,IAAN,CAAWtE,gBAAKgG,IAAL,CAAUiV,SAAV,EAAqB,cAArB,CAAX;;AACA,UAAMC,eAAe,GAAGlb,gBAAKmb,OAAL,CAAaF,SAAb,CAAxB;;AACA,QAAIA,SAAS,KAAKC,eAAlB,EAAmC;AACjC;AACD;;AACDD,IAAAA,SAAS,GAAGC,eAAZ;AACD;;AACD,SAAO1O,KAAK,CAACxG,IAAN,CAAWhG,gBAAKob,SAAhB,CAAP;AACD;;AACM,eAAepL,0BAAf,CAA0ClR,WAA1C,EAA8E;AACnFK,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AACA,QAAMuc,YAAY,GAAG,MAAM1c,eAAe,GAACC,qBAAhB,CAAsCE,WAAtC,CAA3B;;AACA,MAAI,CAACuc,YAAY,CAAC5c,YAAd,IAA8B,CAAC4c,YAAY,CAACnB,WAAhD,EAA6D;AAC3DtY,IAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA4C,oCAAmCA,WAAY,GAA3F;AACA;AACD;;AACD8C,EAAAA,YAAY,GAACiL,QAAb,CACE/N,WADF,EAEE,MAFF,EAGG,kCAAiCuc,YAAY,CAACnB,WAAY,EAH7D;;AAKA,MAAI;AACF,UAAMrc,aAAa,CAACwd,YAAY,CAACnB,WAAd,EAA2B,SAA3B,CAAnB;AACD,GAFD,CAEE,OAAOxY,CAAP,EAAU;AACVE,IAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA4C,oCAAmC4C,CAAC,CAACwT,QAAF,EAAa,EAA5F;AACD;;AACD,QAAMvW,eAAe,GAACsb,oBAAhB,CAAqCnb,WAArC,EAAkD;AACtDL,IAAAA,YAAY,EAAE,IADwC;AAEtDyb,IAAAA,WAAW,EAAE;AAFyC,GAAlD,CAAN;AAID;;AAED,MAAMoB,+BAA+B,GAAG,IAAIhJ,GAAJ,CAAQ,CAC9C,qBAD8C,EAE9C,2BAF8C,EAG9C,gCAH8C,EAI9C,4BAJ8C,EAK9C,4BAL8C,EAM9C,mBAN8C,CAAR,CAAxC;;AASA,SAASiJ,yCAAT,CAAmD3O,GAAnD,EAAgE;AAC9D,MAAI0O,+BAA+B,CAACE,GAAhC,CAAoC5O,GAAG,CAAC6O,WAAJ,EAApC,CAAJ,EAA4D;AAC1D,WAAO,KAAP;AACD;;AACD,SAAO7O,GAAG,CAAC4J,UAAJ,CAAe,eAAf,KAAmC5J,GAAG,CAAC4J,UAAJ,CAAe,OAAf,CAA1C;AACD;;AAED,SAASkF,SAAT,CAAmBzI,IAAnB,EAAiE;AAC/D,MAAI,CAACA,IAAL,EAAW;AACT,WAAOA,IAAP;AACD;;AACD,SAAO,KAAI0I,UAAJ,EAAQ,GAAR,EAAc,UAAS1I,IAAK,EAA5B,EAA+B2I,QAAtC;AACD;;AAED,SAASC,kBAAT,CAA4B/c,WAA5B,EAAiD;AAC/C,SAAO,OACLgd,GADK,EAELC,GAFK,KAGF;AACH,QAAI;AAAA;;AACF;AACA;AACA;AACAtO,MAAAA,MAAM,GAACC,wBAAP,CAAgC5O,WAAhC,EAJE,CAKF;;AACA,YAAMwZ,YAAY,GAAG,MAAM3Z,eAAe,GAACmG,SAAhB,CAA0BhG,WAA1B,CAA3B;AACA,YAAM;AAAEoD,QAAAA,GAAG,EAAExC;AAAP,UAAoB,yBAAUZ,WAAV,CAA1B;AACA,YAAMkd,qBAAqB,GAAG/V,IAAI,CAACiL,KAAL,CAAWjL,IAAI,CAACC,SAAL,CAAeoS,YAAf,CAAX,CAA9B;AACA0D,MAAAA,qBAAqB,CAAClB,OAAtB,GAAgC,MAAhC;;AACA,UAAIkB,qBAAqB,CAACjB,QAAtB,KAAmC,UAAvC,EAAmD;AACjDiB,QAAAA,qBAAqB,CAACjB,QAAtB,GAAiC,QAAjC;AACD;;AACDrb,MAAAA,QAAQ,CAACuc,GAAT,GAAe,IAAf,CAbE,CAamB;;AACrBvc,MAAAA,QAAQ,CAACsK,SAAT,GAAqB;AACnBC,QAAAA,IAAI,EAAEsD,kBAAOD,aADM;AAEnBxO,QAAAA;AAFmB,OAArB;AAIAY,MAAAA,QAAQ,CAAC4Y,YAAT,GAAwBA,YAAxB;AACA5Y,MAAAA,QAAQ,CAACuZ,GAAT,GAAe,EAAf;;AACA,WAAK,MAAMrM,GAAX,IAAkBnC,MAAM,CAACC,IAAP,CAAYsO,OAAO,CAACC,GAApB,CAAlB,EAA4C;AAC1C,YAAIsC,yCAAyC,CAAC3O,GAAD,CAA7C,EAAoD;AAClDlN,UAAAA,QAAQ,CAACuZ,GAAT,CAAarM,GAAb,IAAoBoM,OAAO,CAACC,GAAR,CAAYrM,GAAZ,CAApB;AACD;AACF;;AACD,YAAMvJ,QAAQ,GAAG,CAACyY,GAAG,CAAClK,OAAJ,CAAY,mBAAZ,KAAoC,KAArC,EAA4CsD,QAA5C,EAAjB;AACA,YAAM/E,UAAU,GAAGC,GAAG,GAACC,mBAAJ,CAAwBvR,WAAxB,EAAqCuE,QAArC,CAAnB;AACA,YAAM6Y,cAAc,GAAGld,QAAQ,GAACmd,mBAAT,CAA6BhM,UAA7B,CAAvB;AACA,YAAMiM,WAAW,GAAG,MAAMpd,QAAQ,GAACqd,+BAAT,CAAyCvd,WAAzC,EAAsDwZ,YAAtD,CAA1B;AACA,YAAMtY,IAAI,GAAI,IAAGsc,SAAS,CAACJ,cAAD,CAAiB,oBAAmBK,kBAAkB,CAC9ElZ,QAD8E,CAE9E,IAAG+Y,WAAY,EAFjB;AAGA,YAAMR,QAAQ,GAAGF,SAAS,CAACI,GAAG,CAAClK,OAAJ,CAAYqB,IAAb,CAA1B;AACAvT,MAAAA,QAAQ,CAAC6K,SAAT,GACE,CAAC,MAAMvL,QAAQ,GAAC6b,uBAAT,CAAiC/b,WAAjC,EAA8Ckd,qBAA9C,EAAqEJ,QAArE,CAAP,IACA5b,IAFF;AAGAN,MAAAA,QAAQ,CAAC8c,YAAT,GAAwB,MAAMxd,QAAQ,GAACyd,0BAAT,CAAoC3d,WAApC,EAAiD8c,QAAjD,CAA9B;AACAlc,MAAAA,QAAQ,CAACwc,cAAT,GAA0BA,cAA1B;AACAxc,MAAAA,QAAQ,CAACgd,MAAT,GAAkB,MAAM1d,QAAQ,GAAC2d,oBAAT,CAA8B7d,WAA9B,EAA2C8c,QAA3C,CAAxB;AACAlc,MAAAA,QAAQ,CAACkd,OAAT,GAAmB,MAAM5d,QAAQ,GAAC6d,qBAAT,CAA+B/d,WAA/B,EAA4C8c,QAA5C,CAAzB;AACA,YAAMzb,sBAAsB,CAC1BrB,WAD0B,EAE1BY,QAF0B,EAG1B,MAAMM,IAAN,IAAcN,QAAQ,CAAC6K,SAAT,CAAmBrJ,KAAnB,CAAyB,mBAAzB,EAA8C,CAA9C,IAAmD,SAAnD,GAA+DlB,IAHnD,CAA5B,CAxCE,CA4CC;;AACH,YAAMP,0BAA0B,CAACX,WAAD,EAAcY,QAAd,CAAhC;AACA,YAAMod,QAAQ,GAAG,MAAMC,wBAAaC,mBAAb,EAAvB;AACA,YAAMC,cAAc,GAAG,MAAMta,gBAAYua,eAAZ,EAA7B;;AACA,UAAI,CAACD,cAAD,IAAmB1P,kBAAO4P,OAA9B,EAAuC;AACrCzd,QAAAA,QAAQ,CAAC2K,EAAT,GAAe,IAAGD,0BAAmB,IAAG1K,QAAQ,CAAC6C,IAAK,IAAGua,QAAS,EAAlE;AACD;;AACD,UAAIze,cAAJ;;AACA,UAAIyd,GAAG,CAAClK,OAAJ,CAAY,2BAAZ,CAAJ,EAA8C;AAC5CvT,QAAAA,cAAc,GACZ,CAAC4e,cAAD,IAAmB1P,kBAAO4P,OAA1B,GACIC,yBAAyB,CAAC1d,QAAD,CAD7B,GAEI,MAAM2d,4BAA4B,CAAC3d,QAAD,EAAWud,cAAX,CAHxC;AAID,OALD,MAKO;AACL5e,QAAAA,cAAc,GAAG4H,IAAI,CAACC,SAAL,CAAexG,QAAf,CAAjB;AACD;;AACD,YAAM4d,QAAQ,GAAG;AACfrK,QAAAA,IAAI,EAAE6J,QADS;AAEfS,QAAAA,MAAM,EAAE,KAFO;AAGfC,QAAAA,aAAa,EAAEpb,OAAO,CAAC,wBAAD,CAAP,CAAkCgT,OAHlC;AAIfqI,QAAAA,YAAY,EAAElQ,kBAAOD,aAJN;AAKfoQ,QAAAA,QAAQ,EAAEC,cAAGta,QAAH,EALK;AAMfua,QAAAA,eAAe,EAAED,cAAGE,OAAH;AANF,OAAjB;AAQA9B,MAAAA,GAAG,CAAC+B,SAAJ,CAAc,iBAAd,EAAiC7X,IAAI,CAACC,SAAL,CAAeoX,QAAf,CAAjC;AACAvB,MAAAA,GAAG,CAACgC,GAAJ,CAAQ1f,cAAR;AACA+O,MAAAA,SAAS,GAACC,QAAV,CAAmB,gBAAnB,EAAqC;AACnCvO,QAAAA,WADmC;AAEnCwO,QAAAA,aAAa,EAAEC,kBAAOD,aAFa;AAGnC7M,QAAAA,UAAU,0BAAEf,QAAQ,CAACe,UAAX,uEAAyB;AAHA,OAArC;AAKD,KA3ED,CA2EE,OAAOiB,CAAP,EAAU;AACVE,MAAAA,YAAY,GAACE,QAAb,CAAsBhD,WAAtB,EAAmC,MAAnC,EAA2C4C,CAAC,CAAC+J,KAA7C,EADU,CAEV;;AACAsQ,MAAAA,GAAG,CAACiC,UAAJ,GAAiB,GAAjB;AACAjC,MAAAA,GAAG,CAACgC,GAAJ,CACE9X,IAAI,CAACC,SAAL,CAAe;AACbN,QAAAA,KAAK,EAAElE,CAAC,CAACwT,QAAF;AADM,OAAf,CADF;AAKD;AACF,GAzFD;AA0FD;;AAEM,eAAemI,4BAAf,CACL3d,QADK,EAEL;AACAud,cAHK,EAIL;AAAA;;AACA,QAAM5e,cAAc,GAAG4H,IAAI,CAACC,SAAL,CAAexG,QAAf,CAAvB;;AACA,MAAItB,qBAAqB,CAACC,cAAtB,KAAyCA,cAA7C,EAA6D;AAC3D,WAAOD,qBAAqB,CAACE,cAA7B;AACD,GAJD,CAKA;AACA;;;AACA,QAAMoE,IAAI,GAAG,MAAMC,gBAAYC,mBAAZ,EAAnB;AACA,QAAM;AAAEuL,IAAAA;AAAF,MAAe,MAAMrL,gBAAMC,aAAN,CAAoBL,IAApB,EAA0BO,SAA1B,CAAoC,eAApC,EAAqD;AAC9EmU,IAAAA,IAAI,EAAE;AACJ6G,MAAAA,cAAc,qBAAEve,QAAQ,CAACwD,KAAX,6DAAqB,MAAMP,gBAAYwH,uBAAZ,EADrC;AAEJ+T,MAAAA,iBAAiB,EAAExe,QAAQ,CAAC6C;AAFxB,KADwE;AAK9E7C,IAAAA;AAL8E,GAArD,CAA3B;AAOAtB,EAAAA,qBAAqB,CAACC,cAAtB,GAAuCA,cAAvC;AACAD,EAAAA,qBAAqB,CAACE,cAAtB,GAAuC6P,QAAvC;AACA,SAAOA,QAAP;AACD;;AAEM,SAASiP,yBAAT,CAAmC1d,QAAnC,EAAyD;AAC9D,QAAMye,gBAAgB,GAAG;AACvB9f,IAAAA,cAAc,EAAE4H,IAAI,CAACC,SAAL,CAAexG,QAAf,CADO;AAEvB0e,IAAAA,SAAS,EAAE;AAFY,GAAzB;AAIA,SAAOnY,IAAI,CAACC,SAAL,CAAeiY,gBAAf,CAAP;AACD;;AAEM,eAAeE,oBAAf,CAAoCvf,WAApC,EAAwE;AAC7EK,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AACA,QAAMwf,mBAAmB,CAACxf,WAAD,CAAzB;AACA,QAAMyf,GAAG,GAAG,yBAAZ;AACAA,EAAAA,GAAG,CAACC,GAAJ,CACEC,mBAAQC,IAAR,CAAa;AACXC,IAAAA,KAAK,EAAE;AADI,GAAb,CADF;AAKAJ,EAAAA,GAAG,CAACC,GAAJ,CACEC,mBAAQG,UAAR,CAAmB;AACjBD,IAAAA,KAAK,EAAE,MADU;AAEjBE,IAAAA,QAAQ,EAAE;AAFO,GAAnB,CADF;;AAMA,MACE,CAACC,gBAAgB,GAACC,SAAjB,KACG,MAAMtR,MAAM,GAACuR,2BAAP,CAAmClgB,WAAnC,CADT,GAEG,MAAM2O,MAAM,GAACC,wBAAP,CAAgC5O,WAAhC,CAFV,MAE4D2O,MAAM,GAACG,KAHrE,EAIE;AACA,UAAM,IAAIvM,KAAJ,CAAW,wEAAX,CAAN;AACD,GArB4E,CAsB7E;;;AACA,QAAM4d,eAAe,GAAGpD,kBAAkB,CAAC/c,WAAD,CAA1C;AACAyf,EAAAA,GAAG,CAACW,GAAJ,CAAQ,GAAR,EAAaD,eAAb;AACAV,EAAAA,GAAG,CAACW,GAAJ,CAAQ,WAAR,EAAqBD,eAArB;AACAV,EAAAA,GAAG,CAACW,GAAJ,CAAQ,YAAR,EAAsBD,eAAtB;AACAV,EAAAA,GAAG,CAACY,IAAJ,CAAS,OAAT,EAAkB,OAAOrD,GAAP,EAAYC,GAAZ,KAAoB;AACpC,QAAI;AACF,YAAM/E,QAAQ,GAAG8E,GAAG,CAACoD,GAAJ,CAAQ,WAAR,CAAjB;AACA,YAAMjI,UAAU,GAAG6E,GAAG,CAACoD,GAAJ,CAAQ,aAAR,CAAnB;;AACA,UAAIlI,QAAQ,IAAIC,UAAZ,IAA0B6E,GAAG,CAACjK,IAAlC,EAAwC;AACtCkF,QAAAA,iBAAiB,CAACjY,WAAD,EAAckY,QAAd,EAAwBC,UAAxB,EAAoC6E,GAAG,CAACjK,IAAxC,CAAjB;AACD;AACF,KAND,CAME,OAAOnQ,CAAP,EAAU;AACVE,MAAAA,YAAY,GAACE,QAAb,CAAsBhD,WAAtB,EAAmC,MAAnC,EAA4C,8BAA6B4C,CAAE,IAAGA,CAAC,CAAC+J,KAAM,EAAtF;AACD;;AACDsQ,IAAAA,GAAG,CAACqD,IAAJ,CAAS,SAAT;AACD,GAXD;AAYAb,EAAAA,GAAG,CAACY,IAAJ,CAAS,WAAT,EAAsB,OAAOrD,GAAP,EAAYC,GAAZ,KAAoB;AACxCwB,IAAAA,MAAM,CAAC8B,KAAP;AACAtD,IAAAA,GAAG,CAACqD,IAAJ,CAAS,SAAT;AACD,GAHD;AAIA,QAAME,KAAK,GAAG,MAAM,8BAAexgB,WAAf,CAApB;AACA,QAAMJ,cAAc,GAAG4gB,KAAK,CAACC,YAAN,GAAqBD,KAAK,CAACC,YAA3B,GAA0C,MAAMlgB,iBAAiB,CAAC,KAAD,CAAxF;AACA,QAAMV,eAAe,GAACsb,oBAAhB,CAAqCnb,WAArC,EAAkD;AACtDJ,IAAAA;AADsD,GAAlD,CAAN;AAGA,MAAI6e,MAAM,GAAGgB,GAAG,CAACiB,MAAJ,CAAW9gB,cAAX,EAA2B,MAAM;AAC5C,UAAMsI,IAAI,GAAGuW,MAAM,CAACkC,OAAP,EAAb;AACA,UAAMxM,IAAI,GAAGjM,IAAI,CAACyY,OAAlB;AACA,UAAMlgB,IAAI,GAAGyH,IAAI,CAACzH,IAAlB;AACAqC,IAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA4C,oCAAmCmU,IAAK,IAAG1T,IAAK,EAA5F;AACD,GALY,CAAb;AAMA,QAAM6Q,GAAG,GAACsP,sBAAJ,CAA2B5gB,WAA3B,CAAN;AACD;;AAEM,eAAewf,mBAAf,CAAmCxf,WAAnC,EAAuE;AAC5EK,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AACA,QAAMuc,YAAY,GAAG,MAAM1c,eAAe,GAACC,qBAAhB,CAAsCE,WAAtC,CAA3B;;AACA,MAAIuc,YAAY,IAAIA,YAAY,CAAC3c,cAAjC,EAAiD;AAC/C,QAAI;AACF,YAAM0S,iBAAMC,OAAN,CAAc;AAClBsO,QAAAA,MAAM,EAAE,MADU;AAElB5gB,QAAAA,GAAG,EAAG,oBAAmBsc,YAAY,CAAC3c,cAAe;AAFnC,OAAd,CAAN;AAID,KALD,CAKE,OAAOgD,CAAP,EAAU,CAAE;AACf;;AACD,QAAM/C,eAAe,GAACsb,oBAAhB,CAAqCnb,WAArC,EAAkD;AACtDJ,IAAAA,cAAc,EAAE;AADsC,GAAlD,CAAN;AAGD;;AAED,eAAekhB,mBAAf,CAAmC9gB,WAAnC,EAAwD+gB,YAAxD,EAAoF;AAClF1gB,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AAEA,QAAMS,IAAI,GAAG,MAAMF,iBAAiB,CAAC,KAAD,CAApC,CAHkF,CAGrC;;AAC7C,QAAMV,eAAe,GAACsb,oBAAhB,CAAqCnb,WAArC,EAAkD;AACtDJ,IAAAA,cAAc,EAAEa,IADsC;AAEtDd,IAAAA,YAAY,EAAEc;AAFwC,GAAlD,CAAN;AAKA,QAAMkD,OAA8B,GAAG;AACrClD,IAAAA,IADqC;AAErCmG,IAAAA,MAAM,EAAE9D,YAAY,GAACsO,SAAb,CAAuBpR,WAAvB;AAF6B,GAAvC;;AAIA,MAAI+gB,YAAY,CAAChQ,KAAjB,EAAwB;AACtBpN,IAAAA,OAAO,CAACqN,UAAR,GAAqB,IAArB;AACD;;AACD,MAAI+P,YAAY,CAACjQ,UAAb,IAA2B,IAA/B,EAAqC;AACnCnN,IAAAA,OAAO,CAACmN,UAAR,GAAqBiQ,YAAY,CAACjQ,UAAlC;AACD;;AACD,MAAIiQ,YAAY,CAACvY,MAAjB,EAAyB;AACvB;AACA;AACA0R,IAAAA,OAAO,CAACC,GAAR,CAAY6G,WAAZ,GAA0BD,YAAY,CAACvY,MAAvC;AACD;;AAED,QAAM;AAAEyY,IAAAA;AAAF,MAAiB,MAAM,yCAAuBjhB,WAAvB,EAAoC2D,OAApC,CAA7B;AACAsd,EAAAA,UAAU,CAACvB,GAAX,CAAe3C,kBAAkB,CAAC/c,WAAD,CAAjC;AACD;;AAED,eAAekhB,oBAAf,CACElhB,WADF,EAEEsY,IAFF,EAGE6I,aAHF,EAIEC,QAJF,EAKEC,QAAgB,GAAG,CALrB,EAMmB;AACjB,MAAI;AACF,UAAMC,UAAU,GAAGpgB,gBAAKgG,IAAL,CAAU+W,wBAAasD,oBAAb,EAAV,EAA+C,WAA/C,CAAnB;;AACA,UAAMzE,QAAQ,GAAG,MAAMqE,aAAa,EAApC;AACA,UAAMlhB,GAAG,GAAG,MAAMhB,iBAAiB,CAAC;AAClC6d,MAAAA,QADkC;AAElCwE,MAAAA,UAFkC;AAGlC,SAAGhJ;AAH+B,KAAD,CAAnC;AAKA,WAAOrY,GAAP;AACD,GATD,CASE,OAAO2C,CAAP,EAAU;AACV;AACA,QAAIye,QAAQ,IAAI,CAAhB,EAAmB;AACjB,UAAIze,CAAC,CAACK,OAAN,EAAe;AACb,cAAM,KAAI3C,mBAAJ,EAAa,aAAb,EAA4BsC,CAAC,CAACwT,QAAF,EAA5B,CAAN;AACD,OAFD,MAEO;AACL,cAAM,KAAI9V,mBAAJ,EAAa,aAAb,EAA4B6G,IAAI,CAACC,SAAL,CAAexE,CAAf,CAA5B,CAAN;AACD;AACF;;AACD,QAAI,CAACye,QAAL,EAAe;AACbA,MAAAA,QAAQ,GAAG,CAAX;AACD,KAXS,CAWR;;;AACF,QAAIze,CAAC,CAAC4e,UAAF,IAAgB5e,CAAC,CAAC4e,UAAF,KAAiB,GAArC,EAA0C;AACxC,UAAIH,QAAQ,KAAK,CAAjB,EAAoB;AAClB;AACA,YAAID,QAAJ,EAAc;AACZ,cAAI;AACFlH,YAAAA,OAAO,CAAC7a,IAAR,CAAa+hB,QAAb,EAAuB,SAAvB;AACD,WAFD,CAEE,OAAOxe,CAAP,EAAU;AACVE,YAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA4C,gCAA+BohB,QAAS,EAApF;AACD;AACF,SAND,MAMO;AACL,gBAAMhiB,cAAc,EAApB;AACD;AACF,OAXD,MAWO;AACL;AACA,cAAMkS,GAAG,GAACmQ,2BAAJ,CAAgCzhB,WAAhC,CAAN;AACD;AACF,KA5BS,CA4BR;;;AACF,UAAM,2BAAW,GAAX,CAAN;AACA,WAAOkhB,oBAAoB,CAAClhB,WAAD,EAAcsY,IAAd,EAAoB6I,aAApB,EAAmC,IAAnC,EAAyCE,QAAQ,GAAG,CAApD,CAA3B;AACD;AACF;;AAEM,eAAeK,iBAAf,CAAiC1hB,WAAjC,EAAqE;AAC1E,QAAMoL,QAAQ,GAAG,CAAC,MAAMvH,gBAAYwH,uBAAZ,EAAP,KAAiDC,0BAAlE;;AACAjL,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AACA,QAAMuc,YAAY,GAAG,MAAM1c,eAAe,GAACC,qBAAhB,CAAsCE,WAAtC,CAA3B;;AACA,MAAI,CAACuc,YAAY,CAAC5c,YAAlB,EAAgC;AAC9B,UAAM,KAAIW,mBAAJ,EAAa,kBAAb,EAAkC,oCAAmCN,WAAY,GAAjF,CAAN;AACD;;AACD,MAAI,CAACuc,YAAY,CAAC3c,cAAlB,EAAkC;AAChC,UAAM,KAAIU,mBAAJ,EACJ,qBADI,EAEH,uCAAsCN,WAAY,GAF/C,CAAN;AAID;;AACD,QAAMJ,cAAc,GAAG2c,YAAY,CAAC3c,cAApC;AACA,QAAM+hB,gBAAgB,CAAC3hB,WAAD,CAAtB;;AACA,MAAI,MAAM4hB,OAAO,GAACC,oBAAR,CAA6B7hB,WAA7B,CAAV,EAAqD;AACnD8C,IAAAA,YAAY,GAAC2U,OAAb,CACEzX,WADF,EAEE,MAFF,EAGE,6FAHF;AAKD;;AACD,QAAM8hB,gBAAgB,GAAG5gB,gBAAKkR,KAAL,CAAWpS,WAAX,EAAwB+hB,IAAjD;;AACA,QAAMvB,KAAK,GAAG,MAAM,8BAAexgB,WAAf,CAApB;AAEA,MAAIgiB,0BAA0B,GAAG,KAAjC,CAzB0E,CA2B1E;AACA;;AACA,QAAMhgB,OAAO,CAACka,IAAR,CAAa,CACjB,CAAC,YAAY;AACX,UAAM,2BAAWpd,cAAX,CAAN;;AACA,QAAI,CAACkjB,0BAAL,EAAiC;AAC/B,YAAM,IAAIzf,KAAJ,CAAU,4BAAV,CAAN;AACD;AACF,GALD,GADiB,EAOjB,CAAC,YAAY;AACX,UAAM0f,kBAAkB,GAAG,MAAMf,oBAAoB,CACnDlhB,WADmD,EAEnD;AACEkiB,MAAAA,SAAS,EAAEzT,kBAAOvP,KAAP,CAAaijB,SAD1B;AAEE1hB,MAAAA,IAAI,EAAEb,cAFR;AAGEwiB,MAAAA,KAAK,EAAE;AAHT,KAFmD,EAOnD,YAAY;AACV,YAAMC,UAAU,GAAG7B,KAAK,CAAC8B,wBAAN,GACf9B,KAAK,CAAC8B,wBADS,GAEf,MAAMhR,GAAG,GAACiR,yBAAJ,CAA8BviB,WAA9B,CAFV;AAGA,aAAO,CACLqiB,UADK,EAELniB,QAAQ,GAACsiB,SAAT,CAAmBpX,QAAnB,CAFK,EAGLlL,QAAQ,GAACsiB,SAAT,CAAmBV,gBAAnB,CAHK,EAILrT,kBAAOvP,KAAP,CAAaujB,MAJR,EAKLvb,IALK,CAKA,GALA,CAAP;AAMD,KAjBkD,EAkBnDqV,YAAY,CAAC6E,QAlBsC,CAArD;AAoBA,UAAMsB,gBAAgB,GAAG,MAAMxB,oBAAoB,CACjDlhB,WADiD,EAEjD;AACEkiB,MAAAA,SAAS,EAAEzT,kBAAOvP,KAAP,CAAaijB,SAD1B;AAEE1hB,MAAAA,IAAI,EAAE8b,YAAY,CAAC5c,YAFrB;AAGEyiB,MAAAA,KAAK,EAAE;AAHT,KAFiD,EAOjD,YAAY;AACV,YAAMC,UAAU,GAAG7B,KAAK,CAAC8B,wBAAN,GACf9B,KAAK,CAAC8B,wBADS,GAEf,MAAMhR,GAAG,GAACiR,yBAAJ,CAA8BviB,WAA9B,CAFV;AAGA,aAAO,CACL,UADK,EAELqiB,UAFK,EAGLniB,QAAQ,GAACsiB,SAAT,CAAmBpX,QAAnB,CAHK,EAILlL,QAAQ,GAACsiB,SAAT,CAAmBV,gBAAnB,CAJK,EAKLrT,kBAAOvP,KAAP,CAAaujB,MALR,EAMLvb,IANK,CAMA,GANA,CAAP;AAOD,KAlBgD,EAmBjDqV,YAAY,CAAC6E,QAnBoC,CAAnD;AAqBA,UAAMvhB,eAAe,GAACsb,oBAAhB,CAAqCnb,WAArC,EAAkD;AACtDiiB,MAAAA,kBADsD;AAEtDS,MAAAA,gBAFsD;AAGtDtB,MAAAA,QAAQ,EAAEliB,iBAAMgb,OAAN,GAAgBmB;AAH4B,KAAlD,CAAN;AAMA2G,IAAAA,0BAA0B,GAAG,IAA7B;AAEAlf,IAAAA,YAAY,GAAC6f,YAAb,CACE3iB,WADF,EAEE,MAFF,EAGE;AACEyY,MAAAA,GAAG,EAAE,MADP;AAEEmK,MAAAA,cAAc,EAAE;AAFlB,KAHF,EAOE,eAPF;;AAUA1jB,qBAAM2jB,WAAN,CAAkB,cAAlB,EAAmChQ,MAAD,IAAoB;AACpD,UAAIA,MAAM,KAAK,cAAf,EAA+B;AAC7B/P,QAAAA,YAAY,GAACE,QAAb,CACEhD,WADF,EAEE,MAFF,EAGE,8CACE,qEADF,GAEE,0EAFF,GAGE,wBANJ;AAQD,OATD,MASO,IAAI6S,MAAM,KAAK,QAAf,EAAyB;AAC9B/P,QAAAA,YAAY,GAAC2U,OAAb,CAAqBzX,WAArB,EAAkC,MAAlC,EAA0C,mBAA1C;AACD;AACF,KAbD;AAcD,GA1ED,GAPiB,CAAb,CAAN;AAmFD;;AAEM,eAAe2hB,gBAAf,CAAgC3hB,WAAhC,EAAoE;AACzEK,EAAAA,uBAAuB,CAACL,WAAD,CAAvB,CADyE,CAEzE;AACA;AACA;;;AACA,QAAMuc,YAAY,GAAG,MAAM1c,eAAe,GAACC,qBAAhB,CAAsCE,WAAtC,CAA3B;;AACA,QAAM8iB,YAAY,GAAG5jB,iBAAMgb,OAAN,EAArB;;AACA,QAAM6I,eAAe,GAAGD,YAAY,GAAGA,YAAY,CAACzH,GAAhB,GAAsB,IAA1D;;AACAnc,mBAAM8jB,kBAAN,CAAyB,cAAzB;;AACA,MAAIzG,YAAY,CAAC6E,QAAb,IAAyB7E,YAAY,CAAC6E,QAAb,KAA0B2B,eAAvD,EAAwE;AACtE;AACA,QAAI;AACF7I,MAAAA,OAAO,CAAC7a,IAAR,CAAakd,YAAY,CAAC6E,QAA1B;AACD,KAFD,CAEE,OAAOxe,CAAP,EAAU;AACVE,MAAAA,YAAY,GAACiL,QAAb,CACE/N,WADF,EAEE,MAFF,EAGG,gCAA+Buc,YAAY,CAAC6E,QAAS,EAHxD;AAKD;AACF,GAXD,MAWO;AACL;AACA,UAAMhiB,cAAc,EAApB;AACD;;AACD,QAAMS,eAAe,GAACsb,oBAAhB,CAAqCnb,WAArC,EAAkD;AACtDiiB,IAAAA,kBAAkB,EAAE,IADkC;AAEtDS,IAAAA,gBAAgB,EAAE,IAFoC;AAGtDtB,IAAAA,QAAQ,EAAE;AAH4C,GAAlD,CAAN;AAKA,QAAMQ,OAAO,GAACqB,mBAAR,CAA4BjjB,WAA5B,CAAN;AACD;;AAEM,eAAekjB,eAAf,CACLljB,WADK,EAEL2D,OAFK,EAKU;AACftD,EAAAA,uBAAuB,CAACL,WAAD,CAAvB,CADe,CACuB;;;AACtC,MAAI2D,OAAO,CAAChE,YAAR,IAAwB,IAAxB,IAAgC,CAACwjB,MAAM,CAACC,SAAP,CAAiBzf,OAAO,CAAChE,YAAzB,CAArC,EAA6E;AAC3E,UAAM,KAAIW,mBAAJ,EAAa,iBAAb,EAAgC,iCAAhC,CAAN;AACD;;AACD,QAAMT,eAAe,GAACsb,oBAAhB,CAAqCnb,WAArC,EAAkD2D,OAAlD,CAAN;AACD,C,CAED;;;AACO,eAAe0f,WAAf,CAA2BrjB,WAA3B,EAAgD2D,OAAe,GAAG,EAAlE,EAAuF;AAC5FtD,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AACA,SAAO,MAAME,QAAQ,GAACC,yBAAT,CAAmCH,WAAnC,EAAgD2D,OAAhD,CAAb;AACD;;AAEM,eAAe2f,UAAf,CACLtjB,WADK,EAEL2D,OAAqB,GAAG,EAFnB,EAGLkV,OAAgB,GAAG,IAHd,EAIgB;AAAA;;AACrBxY,EAAAA,uBAAuB,CAACL,WAAD,CAAvB;;AACA,QAAM;AAAEoD,IAAAA;AAAF,MAAU,yBAAUpD,WAAV,CAAhB;AACAsO,EAAAA,SAAS,GAACC,QAAV,CAAmB,eAAnB,EAAoC;AAClCvO,IAAAA,WADkC;AAElCwO,IAAAA,aAAa,EAAEC,kBAAOD,aAFY;AAGlC7M,IAAAA,UAAU,qBAAEyB,GAAG,CAACzB,UAAN,6DAAoB;AAHI,GAApC;;AAMA,MAAIgC,OAAO,CAAC4f,OAAZ,EAAqB;AACnB,UAAMC,OAAO,GAACC,YAAR,CAAqBzjB,WAArB,EAAkC2D,OAAlC,CAAN;AACA+f,IAAAA,UAAU,GAACC,YAAX,CAAwB3jB,WAAxB,EAAqCoD,GAArC,EAA0C,KAA1C;AACA,WAAOA,GAAP;AACD,GAJD,MAIO,IAAIsN,kBAAOC,OAAP,CAAe,qBAAf,EAAsC,KAAtC,CAAJ,EAAkD;AACvD,UAAMmQ,mBAAmB,CAAC9gB,WAAD,EAAc2D,OAAd,CAAzB;AACA+f,IAAAA,UAAU,GAACC,YAAX,CAAwB3jB,WAAxB,EAAqCoD,GAArC,EAA0C,QAA1C;AACD,GAHM,MAGA;AACL,UAAMmc,oBAAoB,CAACvf,WAAD,CAA1B;AACA,UAAM4Q,2BAA2B,CAAC5Q,WAAD,EAAc2D,OAAd,EAAuBkV,OAAvB,CAAjC;AACA6K,IAAAA,UAAU,GAACC,YAAX,CAAwB3jB,WAAxB,EAAqCoD,GAArC,EAA0C,QAA1C;AACD;;AAED,QAAM;AAAE6Y,IAAAA;AAAF,MAAe,MAAMpc,eAAe,GAACmG,SAAhB,CAA0BhG,WAA1B,CAA3B;;AAEA,MAAI,CAACyO,kBAAO4P,OAAR,IAAmBpC,QAAQ,KAAK,QAApC,EAA8C;AAC5C,QAAI;AACF,YAAMyF,iBAAiB,CAAC1hB,WAAD,CAAvB;AACD,KAFD,CAEE,OAAO4C,CAAP,EAAU;AACVE,MAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA4C,yBAAwB4C,CAAC,CAACK,OAAQ,EAA9E;AACD;AACF;;AACD,SAAOG,GAAP;AACD;;AAED,eAAewgB,kBAAf,CAAkC5jB,WAAlC,EAAsE;AACpE0jB,EAAAA,UAAU,GAACG,WAAX;AACA,QAAML,OAAO,GAACM,SAAR,CAAkB9jB,WAAlB,CAAN;AACA8C,EAAAA,YAAY,GAAC2U,OAAb,CAAqBzX,WAArB,EAAkC,MAAlC,EAA0C,4BAA1C;AACA,QAAMwf,mBAAmB,CAACxf,WAAD,CAAzB;AACA8C,EAAAA,YAAY,GAAC2U,OAAb,CAAqBzX,WAArB,EAAkC,MAAlC,EAA0C,+BAA1C;AACA,QAAMkR,0BAA0B,CAAClR,WAAD,CAAhC;;AACA,MAAI,CAACyO,kBAAO4P,OAAZ,EAAqB;AACnB,QAAI;AACF,YAAMsD,gBAAgB,CAAC3hB,WAAD,CAAtB;AACD,KAFD,CAEE,OAAO4C,CAAP,EAAU;AACVE,MAAAA,YAAY,GAACiL,QAAb,CAAsB/N,WAAtB,EAAmC,MAAnC,EAA4C,wBAAuB4C,CAAC,CAACK,OAAQ,EAA7E;AACD;AACF;;AAED,QAAM2e,OAAO,GAACmC,uBAAR,EAAN;AACD;;AAEM,eAAeC,gBAAf,CAAgCtkB,UAAhC,EAAmE;AACxE,QAAM8jB,OAAO,GAACM,SAAR,CAAkBpkB,UAAlB,CAAN;AACA,QAAMgkB,UAAU,GAACG,WAAX,EAAN;AACD;;AAEM,eAAeC,SAAf,CAAyBpkB,UAAzB,EAA4D;AACjE,QAAMwE,MAAM,GAAG,MAAMlC,OAAO,CAACka,IAAR,CAAa,CAChC0H,kBAAkB,CAAClkB,UAAD,CADc,EAEhC,IAAIsC,OAAJ,CAAYb,OAAO,IAAI8iB,UAAU,CAAC9iB,OAAD,EAAU,IAAV,EAAgB,YAAhB,CAAjC,CAFgC,CAAb,CAArB;;AAIA,MAAI+C,MAAM,KAAK,YAAf,EAA6B;AAC3B;AACA,UAAM;AAAEkX,MAAAA,WAAF;AAAegG,MAAAA;AAAf,QAA4B,MAAMvhB,eAAe,GAACC,qBAAhB,CAAsCJ,UAAtC,CAAxC;;AACA,QAAI0b,WAAJ,EAAiB;AACf,UAAI;AACFlB,QAAAA,OAAO,CAAC7a,IAAR,CAAa+b,WAAb;AACD,OAFD,CAEE,OAAOxY,CAAP,EAAU,CAAE;AACf;;AACD,QAAIwe,QAAJ,EAAc;AACZ,UAAI;AACFlH,QAAAA,OAAO,CAAC7a,IAAR,CAAa+hB,QAAb;AACD,OAFD,CAEE,OAAOxe,CAAP,EAAU,CAAE;AACf;;AACD,UAAM/C,eAAe,GAACsb,oBAAhB,CAAqCzb,UAArC,EAAiD;AACrDE,MAAAA,cAAc,EAAE,IADqC;AAErDD,MAAAA,YAAY,EAAE,IAFuC;AAGrDyb,MAAAA,WAAW,EAAE,IAHwC;AAIrD6G,MAAAA,kBAAkB,EAAE,IAJiC;AAKrDS,MAAAA,gBAAgB,EAAE,IALmC;AAMrDtB,MAAAA,QAAQ,EAAE,IAN2C;AAOrD8C,MAAAA,iBAAiB,EAAE;AAPkC,KAAjD,CAAN;AASD;AACF","sourcesContent":["import {\n  ExpoConfig,\n  Hook,\n  HookArguments,\n  HookType,\n  PackageJSONConfig,\n  Platform,\n  ProjectTarget,\n  configFilename,\n  getConfig,\n  getDefaultTarget,\n  readExpRcAsync,\n  resolveModule,\n} from '@expo/config';\nimport { getBareExtensions, getManagedExtensions } from '@expo/config/paths';\nimport {\n  BundleAssetWithFileHashes,\n  BundleOutput,\n  MetroDevServerOptions,\n  bundleAsync,\n  runMetroDevServerAsync,\n} from '@expo/dev-server';\nimport JsonFile from '@expo/json-file';\nimport ngrok from '@expo/ngrok';\nimport joi from '@hapi/joi';\nimport axios from 'axios';\nimport child_process from 'child_process';\nimport crypto from 'crypto';\nimport decache from 'decache';\nimport delayAsync from 'delay-async';\nimport express from 'express';\nimport freeportAsync from 'freeport-async';\nimport fs from 'fs-extra';\nimport getenv from 'getenv';\nimport HashIds from 'hashids';\nimport http from 'http';\nimport chunk from 'lodash/chunk';\nimport escapeRegExp from 'lodash/escapeRegExp';\nimport get from 'lodash/get';\nimport set from 'lodash/set';\nimport md5hex from 'md5hex';\nimport minimatch from 'minimatch';\nimport { AddressInfo } from 'net';\nimport os from 'os';\nimport path from 'path';\nimport readLastLines from 'read-last-lines';\nimport semver from 'semver';\nimport slug from 'slugify';\nimport split from 'split';\nimport treekill from 'tree-kill';\nimport { URL } from 'url';\nimport urljoin from 'url-join';\nimport { promisify } from 'util';\nimport uuid from 'uuid';\n\nimport * as Analytics from './Analytics';\nimport * as Android from './Android';\nimport ApiV2 from './ApiV2';\nimport Config from './Config';\nimport * as ConnectionStatus from './ConnectionStatus';\nimport * as DevSession from './DevSession';\nimport * as EmbeddedAssets from './EmbeddedAssets';\nimport { maySkipManifestValidation } from './Env';\nimport { ErrorCode } from './ErrorCode';\nimport * as Exp from './Exp';\nimport logger from './Logger';\nimport * as ProjectSettings from './ProjectSettings';\nimport * as Sentry from './Sentry';\nimport * as ThirdParty from './ThirdParty';\nimport * as UrlUtils from './UrlUtils';\nimport UserManager, { ANONYMOUS_USERNAME, User } from './User';\nimport UserSettings from './UserSettings';\nimport * as Versions from './Versions';\nimport * as Watchman from './Watchman';\nimport * as Webpack from './Webpack';\nimport XDLError from './XDLError';\nimport * as ExponentTools from './detach/ExponentTools';\nimport * as Doctor from './project/Doctor';\nimport * as ExpSchema from './project/ExpSchema';\nimport * as ProjectUtils from './project/ProjectUtils';\nimport { writeArtifactSafelyAsync } from './tools/ArtifactUtils';\nimport FormData from './tools/FormData';\n\nconst EXPO_CDN = 'https://d1wp6m56sqw74a.cloudfront.net';\nconst MINIMUM_BUNDLE_SIZE = 500;\nconst TUNNEL_TIMEOUT = 10 * 1000;\n\nconst treekillAsync = promisify<number, string>(treekill);\nconst ngrokConnectAsync = promisify(ngrok.connect);\nconst ngrokKillAsync = promisify(ngrok.kill);\n\ntype CachedSignedManifest =\n  | {\n      manifestString: null;\n      signedManifest: null;\n    }\n  | {\n      manifestString: string;\n      signedManifest: string;\n    };\n\nconst _cachedSignedManifest: CachedSignedManifest = {\n  manifestString: null,\n  signedManifest: null,\n};\n\ntype ManifestAsset = { fileHashes: string[]; files: string[]; hash: string };\ntype Asset = ManifestAsset | BundleAssetWithFileHashes;\n\ntype ManifestResolutionError = Error & {\n  localAssetPath?: string;\n  manifestField?: string;\n};\n\ntype PublicConfig = ExpoConfig & {\n  sdkVersion: string;\n};\n\ntype SelfHostedIndex = PublicConfig & {\n  dependencies: string[];\n};\n\ntype LoadedHook = Hook & {\n  _fn: (input: HookArguments) => any;\n};\n\nexport type StartOptions = {\n  reset?: boolean;\n  nonInteractive?: boolean;\n  nonPersistent?: boolean;\n  maxWorkers?: number;\n  webOnly?: boolean;\n  target?: ProjectTarget;\n};\n\ntype PublishOptions = {\n  releaseChannel?: string;\n  target?: ProjectTarget;\n  resetCache?: boolean;\n  maxWorkers?: number;\n  quiet?: boolean;\n};\n\ntype PackagerOptions = {\n  dev: boolean;\n  minify: boolean;\n};\n\ntype Release = {\n  fullName: string;\n  channel: string;\n  channelId: string;\n  publicationId: string;\n  appVersion: string;\n  sdkVersion: string;\n  publishedTime: string;\n  platform: string;\n};\n\nexport type ProjectStatus = 'running' | 'ill' | 'exited';\n\ntype BundlesByPlatform = { android: BundleOutput; ios: BundleOutput };\n\nexport async function currentStatus(projectDir: string): Promise<ProjectStatus> {\n  const { packagerPort, expoServerPort } = await ProjectSettings.readPackagerInfoAsync(projectDir);\n  if (packagerPort && expoServerPort) {\n    return 'running';\n  } else if (packagerPort || expoServerPort) {\n    return 'ill';\n  } else {\n    return 'exited';\n  }\n}\n\n// DECPRECATED: use UrlUtils.constructManifestUrlAsync\nexport async function getManifestUrlWithFallbackAsync(\n  projectRoot: string\n): Promise<{ url: string; isUrlFallback: false }> {\n  return {\n    url: await UrlUtils.constructManifestUrlAsync(projectRoot),\n    isUrlFallback: false,\n  };\n}\n\nasync function _assertValidProjectRoot(projectRoot: string) {\n  if (!projectRoot) {\n    throw new XDLError('NO_PROJECT_ROOT', 'No project root specified');\n  }\n}\n\nasync function _getFreePortAsync(rangeStart: number) {\n  const port = await freeportAsync(rangeStart, { hostnames: [null, 'localhost'] });\n  if (!port) {\n    throw new XDLError('NO_PORT_FOUND', 'No available port found');\n  }\n\n  return port;\n}\n\nasync function _resolveGoogleServicesFile(projectRoot: string, manifest: ExpoConfig) {\n  if (manifest.android && manifest.android.googleServicesFile) {\n    const contents = await fs.readFile(\n      path.resolve(projectRoot, manifest.android.googleServicesFile),\n      'utf8'\n    );\n    manifest.android.googleServicesFile = contents;\n  }\n  if (manifest.ios && manifest.ios.googleServicesFile) {\n    const contents = await fs.readFile(\n      path.resolve(projectRoot, manifest.ios.googleServicesFile),\n      'base64'\n    );\n    manifest.ios.googleServicesFile = contents;\n  }\n}\n\nasync function _resolveManifestAssets(\n  projectRoot: string,\n  manifest: PublicConfig,\n  resolver: (assetPath: string) => Promise<string>,\n  strict = false\n) {\n  try {\n    // Asset fields that the user has set\n    const assetSchemas = (\n      await ExpSchema.getAssetSchemasAsync(manifest.sdkVersion)\n    ).filter((assetSchema: ExpSchema.AssetSchema) => get(manifest, assetSchema.fieldPath));\n\n    // Get the URLs\n    const urls = await Promise.all(\n      assetSchemas.map(async (assetSchema: ExpSchema.AssetSchema) => {\n        const pathOrURL = get(manifest, assetSchema.fieldPath);\n        if (pathOrURL.match(/^https?:\\/\\/(.*)$/)) {\n          // It's a remote URL\n          return pathOrURL;\n        } else if (fs.existsSync(path.resolve(projectRoot, pathOrURL))) {\n          return await resolver(pathOrURL);\n        } else {\n          const err: ManifestResolutionError = new Error('Could not resolve local asset.');\n          err.localAssetPath = pathOrURL;\n          err.manifestField = assetSchema.fieldPath;\n          throw err;\n        }\n      })\n    );\n\n    // Set the corresponding URL fields\n    assetSchemas.forEach((assetSchema: ExpSchema.AssetSchema, index: number) =>\n      set(manifest, assetSchema.fieldPath + 'Url', urls[index])\n    );\n  } catch (e) {\n    let logMethod = ProjectUtils.logWarning;\n    if (strict) {\n      logMethod = ProjectUtils.logError;\n    }\n    if (e.localAssetPath) {\n      logMethod(\n        projectRoot,\n        'expo',\n        `Unable to resolve asset \"${e.localAssetPath}\" from \"${e.manifestField}\" in your app.json or app.config.js`\n      );\n    } else {\n      logMethod(\n        projectRoot,\n        'expo',\n        `Warning: Unable to resolve manifest assets. Icons might not work. ${e.message}.`\n      );\n    }\n\n    if (strict) {\n      throw new Error('Resolving assets failed.');\n    }\n  }\n}\n\nfunction _requireFromProject(modulePath: string, projectRoot: string, exp: ExpoConfig) {\n  try {\n    const fullPath = resolveModule(modulePath, projectRoot, exp);\n    // Clear the require cache for this module so get a fresh version of it\n    // without requiring the user to restart Expo CLI\n    decache(fullPath);\n    // $FlowIssue: doesn't work with dynamic requires\n    return require(fullPath);\n  } catch (e) {\n    return null;\n  }\n}\n\n// TODO: Move to @expo/config\nexport async function getSlugAsync(projectRoot: string): Promise<string> {\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n  if (exp.slug) {\n    return exp.slug;\n  }\n  throw new XDLError(\n    'INVALID_MANIFEST',\n    `Your project config in ${projectRoot} must contain a \"slug\" field. Please supply this in your app.config.js or app.json`\n  );\n}\n\nexport async function getLatestReleaseAsync(\n  projectRoot: string,\n  options: {\n    releaseChannel: string;\n    platform: string;\n    owner?: string;\n  }\n): Promise<Release | null> {\n  const user = await UserManager.ensureLoggedInAsync();\n  const api = ApiV2.clientForUser(user);\n  const result = await api.postAsync('publish/history', {\n    owner: options.owner,\n    slug: await getSlugAsync(projectRoot),\n    releaseChannel: options.releaseChannel,\n    count: 1,\n    platform: options.platform,\n  });\n  const { queryResult } = result;\n  if (queryResult && queryResult.length > 0) {\n    return queryResult[0];\n  } else {\n    return null;\n  }\n}\n\n// Takes multiple exported apps in sourceDirs and coalesces them to one app in outputDir\nexport async function mergeAppDistributions(\n  projectRoot: string,\n  sourceDirs: string[],\n  outputDir: string\n): Promise<void> {\n  const assetPathToWrite = path.resolve(projectRoot, outputDir, 'assets');\n  await fs.ensureDir(assetPathToWrite);\n  const bundlesPathToWrite = path.resolve(projectRoot, outputDir, 'bundles');\n  await fs.ensureDir(bundlesPathToWrite);\n\n  // merge files from bundles and assets\n  const androidIndexes: SelfHostedIndex[] = [];\n  const iosIndexes: SelfHostedIndex[] = [];\n\n  for (const sourceDir of sourceDirs) {\n    const promises = [];\n\n    // copy over assets/bundles from other src dirs to the output dir\n    if (sourceDir !== outputDir) {\n      // copy file over to assetPath\n      const sourceAssetDir = path.resolve(projectRoot, sourceDir, 'assets');\n      const outputAssetDir = path.resolve(projectRoot, outputDir, 'assets');\n      const assetPromise = fs.copy(sourceAssetDir, outputAssetDir);\n      promises.push(assetPromise);\n\n      // copy files over to bundlePath\n      const sourceBundleDir = path.resolve(projectRoot, sourceDir, 'bundles');\n      const outputBundleDir = path.resolve(projectRoot, outputDir, 'bundles');\n      const bundlePromise = fs.copy(sourceBundleDir, outputBundleDir);\n      promises.push(bundlePromise);\n\n      await Promise.all(promises);\n    }\n\n    // put index.jsons into memory\n    const putJsonInMemory = async (indexPath: string, accumulator: SelfHostedIndex[]) => {\n      const index = (await JsonFile.readAsync(indexPath)) as SelfHostedIndex;\n      if (!index.sdkVersion) {\n        throw new XDLError(\n          'INVALID_MANIFEST',\n          `Invalid index.json, must specify an sdkVersion at ${indexPath}`\n        );\n      }\n      if (Array.isArray(index)) {\n        // index.json could also be an array\n        accumulator.push(...index);\n      } else {\n        accumulator.push(index);\n      }\n    };\n\n    const androidIndexPath = path.resolve(projectRoot, sourceDir, 'android-index.json');\n    await putJsonInMemory(androidIndexPath, androidIndexes);\n\n    const iosIndexPath = path.resolve(projectRoot, sourceDir, 'ios-index.json');\n    await putJsonInMemory(iosIndexPath, iosIndexes);\n  }\n\n  // sort indexes by descending sdk value\n  const getSortedIndex = (indexes: SelfHostedIndex[]) => {\n    return indexes.sort((index1: SelfHostedIndex, index2: SelfHostedIndex) => {\n      if (semver.eq(index1.sdkVersion, index2.sdkVersion)) {\n        logger.global.error(\n          `Encountered multiple index.json with the same SDK version ${index1.sdkVersion}. This could result in undefined behavior.`\n        );\n      }\n      return semver.gte(index1.sdkVersion, index2.sdkVersion) ? -1 : 1;\n    });\n  };\n\n  const sortedAndroidIndexes = getSortedIndex(androidIndexes);\n  const sortedIosIndexes = getSortedIndex(iosIndexes);\n\n  // Save the json arrays to disk\n  await writeArtifactSafelyAsync(\n    projectRoot,\n    null,\n    path.join(outputDir, 'android-index.json'),\n    JSON.stringify(sortedAndroidIndexes)\n  );\n\n  await writeArtifactSafelyAsync(\n    projectRoot,\n    null,\n    path.join(outputDir, 'ios-index.json'),\n    JSON.stringify(sortedIosIndexes)\n  );\n}\n\nfunction prepareHooks(\n  hooks: ExpoConfig['hooks'],\n  hookType: HookType,\n  projectRoot: string,\n  exp: ExpoConfig\n) {\n  const validHooks: LoadedHook[] = [];\n\n  if (hooks) {\n    if (hooks[hookType]) {\n      hooks[hookType]!.forEach((hook: any) => {\n        const { file } = hook;\n        const fn = _requireFromProject(file, projectRoot, exp);\n        if (typeof fn !== 'function') {\n          logger.global.error(\n            `Unable to load ${hookType} hook: '${file}'. The module does not export a function.`\n          );\n        } else {\n          hook._fn = fn;\n          validHooks.push(hook);\n        }\n      });\n    }\n\n    if (hooks[hookType] !== undefined && validHooks.length !== hooks[hookType]?.length) {\n      throw new XDLError(\n        'HOOK_INITIALIZATION_ERROR',\n        `Please fix your ${hookType} hook configuration`\n      );\n    }\n  }\n\n  return validHooks;\n}\n\nexport async function runHook(hook: LoadedHook, hookOptions: Omit<HookArguments, 'config'>) {\n  let result = hook._fn({\n    config: hook.config,\n    ...hookOptions,\n  });\n\n  // If it's a promise, wait for it to resolve\n  if (result && result.then) {\n    result = await result;\n  }\n\n  if (result) {\n    logger.global.info({ quiet: true }, result);\n  }\n}\n\n/**\n * Apps exporting for self hosting will have the files created in the project directory the following way:\n.\n├── android-index.json\n├── ios-index.json\n├── assets\n│   └── 1eccbc4c41d49fd81840aef3eaabe862\n└── bundles\n      ├── android-01ee6e3ab3e8c16a4d926c91808d5320.js\n      └── ios-ee8206cc754d3f7aa9123b7f909d94ea.js\n */\nexport async function exportForAppHosting(\n  projectRoot: string,\n  publicUrl: string,\n  assetUrl: string,\n  outputDir: string,\n  options: {\n    isDev?: boolean;\n    dumpAssetmap?: boolean;\n    dumpSourcemap?: boolean;\n    publishOptions?: PublishOptions;\n  } = {}\n): Promise<void> {\n  const defaultTarget = getDefaultTarget(projectRoot);\n  const target = options.publishOptions?.target ?? defaultTarget;\n\n  // build the bundles\n  // make output dirs if not exists\n  const assetPathToWrite = path.resolve(projectRoot, path.join(outputDir, 'assets'));\n  await fs.ensureDir(assetPathToWrite);\n  const bundlesPathToWrite = path.resolve(projectRoot, path.join(outputDir, 'bundles'));\n  await fs.ensureDir(bundlesPathToWrite);\n\n  const bundles = await buildPublishBundlesAsync(projectRoot, options.publishOptions, {\n    dev: options.isDev,\n  });\n  const iosBundle = bundles.ios.code;\n  const androidBundle = bundles.android.code;\n\n  const iosBundleHash = crypto.createHash('md5').update(iosBundle).digest('hex');\n  const iosBundleUrl = `ios-${iosBundleHash}.js`;\n  const iosJsPath = path.join(outputDir, 'bundles', iosBundleUrl);\n\n  const androidBundleHash = crypto.createHash('md5').update(androidBundle).digest('hex');\n  const androidBundleUrl = `android-${androidBundleHash}.js`;\n  const androidJsPath = path.join(outputDir, 'bundles', androidBundleUrl);\n\n  await writeArtifactSafelyAsync(projectRoot, null, iosJsPath, iosBundle);\n  await writeArtifactSafelyAsync(projectRoot, null, androidJsPath, androidBundle);\n\n  logger.global.info('Finished saving JS Bundles.');\n\n  // save the assets\n  // Get project config\n  const publishOptions = options.publishOptions || {};\n  const { exp, pkg } = await _getPublishExpConfigAsync(projectRoot, publishOptions);\n  const { assets } = await exportAssetsAsync(projectRoot, exp, publicUrl, outputDir, bundles);\n\n  if (options.dumpAssetmap) {\n    logger.global.info('Dumping asset map.');\n\n    const assetmap: { [hash: string]: Asset } = {};\n\n    assets.forEach((asset: Asset) => {\n      assetmap[asset.hash] = asset;\n    });\n\n    await writeArtifactSafelyAsync(\n      projectRoot,\n      null,\n      path.join(outputDir, 'assetmap.json'),\n      JSON.stringify(assetmap)\n    );\n  }\n\n  // Delete keys that are normally deleted in the publish process\n  const { hooks } = exp;\n  delete exp.hooks;\n  const validPostExportHooks: LoadedHook[] = prepareHooks(hooks, 'postExport', projectRoot, exp);\n\n  // Add assetUrl to manifest\n  exp.assetUrlOverride = assetUrl;\n\n  exp.publishedTime = new Date().toISOString();\n  exp.commitTime = new Date().toISOString();\n  exp.releaseId = uuid.v4();\n\n  // generate revisionId and id the same way www does\n  const hashIds = new HashIds(uuid.v1(), 10);\n  exp.revisionId = hashIds.encode(Date.now());\n\n  if (options.isDev) {\n    exp.developer = {\n      tool: 'exp',\n    };\n  }\n\n  if (!exp.slug) {\n    throw new XDLError('INVALID_MANIFEST', 'Must provide a slug field in the app.json manifest.');\n  }\n\n  let username = await UserManager.getCurrentUsernameAsync();\n\n  if (!username) {\n    username = ANONYMOUS_USERNAME;\n  }\n\n  exp.id = `@${username}/${exp.slug}`;\n\n  // save the android manifest\n  const androidManifest = {\n    ...exp,\n    bundleUrl: urljoin(publicUrl, 'bundles', androidBundleUrl),\n    platform: 'android',\n    dependencies: Object.keys(pkg.dependencies),\n  };\n\n  await writeArtifactSafelyAsync(\n    projectRoot,\n    null,\n    path.join(outputDir, 'android-index.json'),\n    JSON.stringify(androidManifest)\n  );\n\n  // save the ios manifest\n  const iosManifest = {\n    ...exp,\n    bundleUrl: urljoin(publicUrl, 'bundles', iosBundleUrl),\n    platform: 'ios',\n    dependencies: Object.keys(pkg.dependencies),\n  };\n\n  await writeArtifactSafelyAsync(\n    projectRoot,\n    null,\n    path.join(outputDir, 'ios-index.json'),\n    JSON.stringify(iosManifest)\n  );\n\n  const iosSourceMap = bundles.ios.map;\n  const androidSourceMap = bundles.android.map;\n\n  // build source maps\n  if (options.dumpSourcemap) {\n    // write the sourcemap files\n    const iosMapName = `ios-${iosBundleHash}.map`;\n    const iosMapPath = path.join(outputDir, 'bundles', iosMapName);\n    await writeArtifactSafelyAsync(projectRoot, null, iosMapPath, iosSourceMap);\n\n    const androidMapName = `android-${androidBundleHash}.map`;\n    const androidMapPath = path.join(outputDir, 'bundles', androidMapName);\n    await writeArtifactSafelyAsync(projectRoot, null, androidMapPath, androidSourceMap);\n\n    // Remove original mapping to incorrect sourcemap paths\n    logger.global.info('Configuring sourcemaps');\n    await truncateLastNLines(iosJsPath, 1);\n    await truncateLastNLines(androidJsPath, 1);\n\n    // Add correct mapping to sourcemap paths\n    await fs.appendFile(iosJsPath, `\\n//# sourceMappingURL=${iosMapName}`);\n    await fs.appendFile(androidJsPath, `\\n//# sourceMappingURL=${androidMapName}`);\n\n    // Make a debug html so user can debug their bundles\n    logger.global.info('Preparing additional debugging files');\n    const debugHtml = `\n    <script src=\"${urljoin('bundles', iosBundleUrl)}\"></script>\n    <script src=\"${urljoin('bundles', androidBundleUrl)}\"></script>\n    Open up this file in Chrome. In the Javascript developer console, navigate to the Source tab.\n    You can see a red coloured folder containing the original source code from your bundle.\n    `;\n\n    await writeArtifactSafelyAsync(\n      projectRoot,\n      null,\n      path.join(outputDir, 'debug.html'),\n      debugHtml\n    );\n  }\n\n  const hookOptions = {\n    url: null,\n    exp,\n    iosBundle,\n    iosSourceMap,\n    iosManifest,\n    androidBundle,\n    androidSourceMap,\n    androidManifest,\n    projectRoot,\n    log: (msg: any) => {\n      logger.global.info({ quiet: true }, msg);\n    },\n  };\n\n  for (const hook of validPostExportHooks) {\n    logger.global.info(`Running postExport hook: ${hook.file}`);\n\n    try {\n      runHook(hook, hookOptions);\n    } catch (e) {\n      logger.global.warn(`Warning: postExport hook '${hook.file}' failed: ${e.stack}`);\n    }\n  }\n\n  // configure embedded assets for expo-updates or ExpoKit\n  await EmbeddedAssets.configureAsync({\n    projectRoot,\n    pkg,\n    exp,\n    iosManifestUrl: urljoin(publicUrl, 'ios-index.json'),\n    iosManifest,\n    iosBundle,\n    iosSourceMap,\n    androidManifestUrl: urljoin(publicUrl, 'android-index.json'),\n    androidManifest,\n    androidBundle,\n    androidSourceMap,\n    target,\n  });\n}\n\n// truncate the last n lines in a file\nasync function truncateLastNLines(filePath: string, n: number) {\n  const lines = await readLastLines.read(filePath, n);\n  const to_vanquish = lines.length;\n  const { size } = await fs.stat(filePath);\n  await fs.truncate(filePath, size - to_vanquish);\n}\n\nasync function _saveAssetsAsync(projectRoot: string, assets: Asset[], outputDir: string) {\n  // Collect paths by key, also effectively handles duplicates in the array\n  const paths: { [fileHash: string]: string } = {};\n  assets.forEach(asset => {\n    asset.files.forEach((path: string, index: number) => {\n      paths[asset.fileHashes[index]] = path;\n    });\n  });\n\n  // save files one chunk at a time\n  const keyChunks = chunk(Object.keys(paths), 5);\n  for (const keys of keyChunks) {\n    const promises = [];\n    for (const key of keys) {\n      ProjectUtils.logDebug(projectRoot, 'expo', `uploading ${paths[key]}`);\n\n      logger.global.info({ quiet: true }, `Saving ${paths[key]}`);\n\n      const assetPath = path.resolve(outputDir, 'assets', key);\n\n      // copy file over to assetPath\n      const p = fs.copy(paths[key], assetPath);\n      promises.push(p);\n    }\n    await Promise.all(promises);\n  }\n  logger.global.info('Files successfully saved.');\n}\n\nexport async function findReusableBuildAsync(\n  releaseChannel: string,\n  platform: string,\n  sdkVersion: string,\n  slug: string\n): Promise<{ downloadUrl?: string; canReuse: boolean }> {\n  const user = await UserManager.getCurrentUserAsync();\n\n  const buildReuseStatus = await ApiV2.clientForUser(user).postAsync('standalone-build/reuse', {\n    releaseChannel,\n    platform,\n    sdkVersion,\n    slug,\n  });\n\n  return buildReuseStatus;\n}\n\nexport async function publishAsync(\n  projectRoot: string,\n  options: PublishOptions = {}\n): Promise<{ url: string; ids: string[]; err?: string }> {\n  options.target = options.target ?? getDefaultTarget(projectRoot);\n  const target = options.target;\n  const user = await UserManager.ensureLoggedInAsync();\n\n  Analytics.logEvent('Publish', {\n    projectRoot,\n    developerTool: Config.developerTool,\n  });\n\n  const validationStatus = await Doctor.validateWithNetworkAsync(projectRoot);\n  if (validationStatus === Doctor.ERROR || validationStatus === Doctor.FATAL) {\n    throw new XDLError(\n      'PUBLISH_VALIDATION_ERROR',\n      \"Couldn't publish because errors were found. (See logs above.) Please fix the errors and try again.\"\n    );\n  }\n\n  // Get project config\n  const { exp, pkg } = await _getPublishExpConfigAsync(projectRoot, options);\n\n  // TODO: refactor this out to a function, throw error if length doesn't match\n  const { hooks } = exp;\n  delete exp.hooks;\n  const validPostPublishHooks: LoadedHook[] = prepareHooks(hooks, 'postPublish', projectRoot, exp);\n\n  const bundles = await buildPublishBundlesAsync(projectRoot, options);\n  const androidBundle = bundles.android.code;\n  const iosBundle = bundles.ios.code;\n\n  await publishAssetsAsync(projectRoot, exp, bundles);\n\n  const hasHooks = validPostPublishHooks.length > 0;\n\n  const shouldPublishAndroidMaps = !!exp.android && !!exp.android.publishSourceMapPath;\n  const shouldPublishIosMaps = !!exp.ios && !!exp.ios.publishSourceMapPath;\n  const androidSourceMap = hasHooks || shouldPublishAndroidMaps ? bundles.android.map : null;\n  const iosSourceMap = hasHooks || shouldPublishIosMaps ? bundles.ios.map : null;\n\n  let response;\n  try {\n    response = await _uploadArtifactsAsync({\n      pkg,\n      exp,\n      iosBundle,\n      androidBundle,\n      options,\n    });\n  } catch (e) {\n    if (e.serverError === 'SCHEMA_VALIDATION_ERROR') {\n      throw new Error(\n        `There was an error validating your project schema. Check for any warnings about the contents of your app.json or app.config.js.`\n      );\n    }\n    Sentry.captureException(e);\n    throw e;\n  }\n\n  let androidManifest = {};\n  let iosManifest = {};\n\n  if (\n    validPostPublishHooks.length ||\n    (exp.ios && exp.ios.publishManifestPath) ||\n    (exp.android && exp.android.publishManifestPath) ||\n    EmbeddedAssets.shouldEmbedAssetsForExpoUpdates(projectRoot, exp, pkg, target)\n  ) {\n    [androidManifest, iosManifest] = await Promise.all([\n      ExponentTools.getManifestAsync(response.url, {\n        'Exponent-SDK-Version': exp.sdkVersion,\n        'Exponent-Platform': 'android',\n        'Expo-Release-Channel': options.releaseChannel,\n        Accept: 'application/expo+json,application/json',\n      }),\n      ExponentTools.getManifestAsync(response.url, {\n        'Exponent-SDK-Version': exp.sdkVersion,\n        'Exponent-Platform': 'ios',\n        'Expo-Release-Channel': options.releaseChannel,\n        Accept: 'application/expo+json,application/json',\n      }),\n    ]);\n\n    const hookOptions = {\n      url: response.url,\n      exp,\n      iosBundle,\n      iosSourceMap,\n      iosManifest,\n      androidBundle,\n      androidSourceMap,\n      androidManifest,\n      projectRoot,\n      log: (msg: any) => {\n        logger.global.info({ quiet: true }, msg);\n      },\n    };\n\n    for (const hook of validPostPublishHooks) {\n      logger.global.info(`Running postPublish hook: ${hook.file}`);\n      try {\n        runHook(hook, hookOptions);\n      } catch (e) {\n        logger.global.warn(`Warning: postPublish hook '${hook.file}' failed: ${e.stack}`);\n      }\n    }\n  }\n\n  const fullManifestUrl = response.url.replace('exp://', 'https://');\n  await EmbeddedAssets.configureAsync({\n    projectRoot,\n    pkg,\n    exp,\n    releaseChannel: options.releaseChannel ?? 'default',\n    iosManifestUrl: fullManifestUrl,\n    iosManifest,\n    iosBundle,\n    iosSourceMap,\n    androidManifestUrl: fullManifestUrl,\n    androidManifest,\n    androidBundle,\n    androidSourceMap,\n    target,\n  });\n\n  // TODO: move to postPublish hook\n  if (exp.isKernel) {\n    await _handleKernelPublishedAsync({\n      user,\n      exp,\n      projectRoot,\n      url: response.url,\n    });\n  }\n\n  return {\n    ...response,\n    url:\n      options.releaseChannel && options.releaseChannel !== 'default'\n        ? `${response.url}?release-channel=${options.releaseChannel}`\n        : response.url,\n  };\n}\n\nasync function _uploadArtifactsAsync({\n  exp,\n  iosBundle,\n  androidBundle,\n  options,\n  pkg,\n}: {\n  exp: ExpoConfig;\n  iosBundle: string;\n  androidBundle: string;\n  options: PublishOptions;\n  pkg: PackageJSONConfig;\n}) {\n  logger.global.info('Uploading JavaScript bundles');\n  const formData = new FormData();\n\n  formData.append('expJson', JSON.stringify(exp));\n  formData.append('packageJson', JSON.stringify(pkg));\n  formData.append('iosBundle', iosBundle, 'iosBundle');\n  formData.append('androidBundle', androidBundle, 'androidBundle');\n  formData.append('options', JSON.stringify(options));\n\n  const user = await UserManager.ensureLoggedInAsync();\n  const api = ApiV2.clientForUser(user);\n  return await api.uploadFormDataAsync('publish/new', formData);\n}\n\nasync function _getPublishExpConfigAsync(\n  projectRoot: string,\n  options: PublishOptions\n): Promise<{\n  exp: PublicConfig;\n  pkg: PackageJSONConfig;\n}> {\n  if (options.releaseChannel != null && typeof options.releaseChannel !== 'string') {\n    throw new XDLError('INVALID_OPTIONS', 'releaseChannel must be a string');\n  }\n  options.releaseChannel = options.releaseChannel || 'default';\n\n  // Verify that exp/app.json and package.json exist\n  const { exp, pkg } = getConfig(projectRoot);\n\n  if (exp.android && exp.android.config) {\n    delete exp.android.config;\n  }\n\n  if (exp.ios && exp.ios.config) {\n    delete exp.ios.config;\n  }\n\n  const { sdkVersion } = exp;\n\n  // Only allow projects to be published with UNVERSIONED if a correct token is set in env\n  if (sdkVersion === 'UNVERSIONED' && !maySkipManifestValidation()) {\n    throw new XDLError('INVALID_OPTIONS', 'Cannot publish with sdkVersion UNVERSIONED.');\n  }\n  exp.locales = await ExponentTools.getResolvedLocalesAsync(exp);\n  return { exp: { ...exp, sdkVersion: sdkVersion! }, pkg };\n}\n\nasync function buildPublishBundlesAsync(\n  projectRoot: string,\n  publishOptions: PublishOptions = {},\n  bundleOptions: { dev?: boolean } = {}\n) {\n  if (!getenv.boolish('EXPO_USE_DEV_SERVER', false)) {\n    try {\n      await startReactNativeServerAsync(\n        projectRoot,\n        {\n          nonPersistent: true,\n          maxWorkers: publishOptions.maxWorkers,\n          target: publishOptions.target,\n          reset: publishOptions.resetCache,\n        },\n        !publishOptions.quiet\n      );\n      return await fetchPublishBundlesAsync(projectRoot);\n    } finally {\n      await stopReactNativeServerAsync(projectRoot);\n    }\n  }\n  const platforms: Platform[] = ['android', 'ios'];\n  const [android, ios] = await bundleAsync(\n    projectRoot,\n    {\n      target: publishOptions.target,\n      resetCache: publishOptions.resetCache,\n      logger: ProjectUtils.getLogger(projectRoot),\n      quiet: publishOptions.quiet,\n    },\n    platforms.map((platform: Platform) => ({\n      platform,\n      entryPoint: Exp.determineEntryPoint(projectRoot, platform),\n      dev: bundleOptions.dev,\n    }))\n  );\n\n  return {\n    android,\n    ios,\n  };\n}\n\n// Fetch iOS and Android bundles for publishing\nasync function fetchPublishBundlesAsync(projectRoot: string, opts?: PackagerOptions) {\n  const entryPoint = Exp.determineEntryPoint(projectRoot);\n  const publishUrl = await UrlUtils.constructPublishUrlAsync(\n    projectRoot,\n    entryPoint,\n    undefined,\n    opts\n  );\n  const sourceMapUrl = await UrlUtils.constructSourceMapUrlAsync(projectRoot, entryPoint);\n  const assetsUrl = await UrlUtils.constructAssetsUrlAsync(projectRoot, entryPoint);\n\n  logger.global.info('Building iOS bundle');\n  const iosBundle = await _getForPlatformAsync(projectRoot, publishUrl, 'ios', {\n    errorCode: 'INVALID_BUNDLE',\n    minLength: MINIMUM_BUNDLE_SIZE,\n  });\n\n  logger.global.info('Building Android bundle');\n  const androidBundle = await _getForPlatformAsync(projectRoot, publishUrl, 'android', {\n    errorCode: 'INVALID_BUNDLE',\n    minLength: MINIMUM_BUNDLE_SIZE,\n  });\n\n  logger.global.info('Building source maps');\n  const iosSourceMap = await _getForPlatformAsync(projectRoot, sourceMapUrl, 'ios', {\n    errorCode: 'INVALID_BUNDLE',\n    minLength: MINIMUM_BUNDLE_SIZE,\n  });\n  const androidSourceMap = await _getForPlatformAsync(projectRoot, sourceMapUrl, 'android', {\n    errorCode: 'INVALID_BUNDLE',\n    minLength: MINIMUM_BUNDLE_SIZE,\n  });\n\n  logger.global.info('Building asset maps');\n  const iosAssetsJson = await _getForPlatformAsync(projectRoot, assetsUrl, 'ios', {\n    errorCode: 'INVALID_ASSETS',\n  });\n  const androidAssetsJson = await _getForPlatformAsync(projectRoot, assetsUrl, 'android', {\n    errorCode: 'INVALID_ASSETS',\n  });\n\n  return {\n    android: { code: androidBundle, map: androidSourceMap, assets: JSON.parse(androidAssetsJson) },\n    ios: { code: iosBundle, map: iosSourceMap, assets: JSON.parse(iosAssetsJson) },\n  };\n}\n\nasync function _getForPlatformAsync(\n  projectRoot: string,\n  url: string,\n  platform: Platform,\n  { errorCode, minLength }: { errorCode: ErrorCode; minLength?: number }\n): Promise<string> {\n  const fullUrl = `${url}&platform=${platform}`;\n  let response;\n\n  try {\n    response = await axios.request({\n      url: fullUrl,\n      responseType: 'text',\n      // Workaround for https://github.com/axios/axios/issues/907.\n      // Without transformResponse, axios will parse the body as JSON regardless of the responseType/\n      transformResponse: [data => data],\n      proxy: false,\n      validateStatus: status => status === 200,\n      headers: {\n        'Exponent-Platform': platform,\n      },\n    });\n  } catch (error) {\n    if (error.response) {\n      if (error.response.data) {\n        let body;\n        try {\n          body = JSON.parse(error.response.data);\n        } catch (e) {\n          ProjectUtils.logError(projectRoot, 'expo', error.response.data);\n        }\n\n        if (body) {\n          if (body.message) {\n            ProjectUtils.logError(projectRoot, 'expo', body.message);\n          } else {\n            ProjectUtils.logError(projectRoot, 'expo', error.response.data);\n          }\n        }\n      }\n      throw new XDLError(\n        errorCode,\n        `Packager URL ${fullUrl} returned unexpected code ${error.response.status}. ` +\n          'Please open your project in the Expo app and see if there are any errors. ' +\n          'Also scroll up and make sure there were no errors or warnings when opening your project.'\n      );\n    } else {\n      throw error;\n    }\n  }\n\n  if (!response.data || (minLength && response.data.length < minLength)) {\n    throw new XDLError(errorCode, `Body is: ${response.data}`);\n  }\n\n  return response.data;\n}\n\n/**\n * Collects all the assets declared in the android app, ios app and manifest\n *\n * @param {string} hostedAssetPrefix\n *    The path where assets are hosted (ie) http://xxx.cloudfront.com/assets/\n *\n * @modifies {exp} Replaces relative asset paths in the manifest with hosted URLS\n *\n */\nasync function _collectAssets(\n  projectRoot: string,\n  exp: PublicConfig,\n  hostedAssetPrefix: string,\n  bundles: BundlesByPlatform\n): Promise<Asset[]> {\n  // Resolve manifest assets to their hosted URL and add them to the list of assets to\n  // be uploaded. Modifies exp.\n  const manifestAssets: Asset[] = [];\n  await _resolveManifestAssets(\n    projectRoot,\n    exp,\n    async (assetPath: string) => {\n      const absolutePath = path.resolve(projectRoot, assetPath);\n      const contents = await fs.readFile(absolutePath);\n      const hash = md5hex(contents);\n      manifestAssets.push({ files: [absolutePath], fileHashes: [hash], hash });\n      return urljoin(hostedAssetPrefix, hash);\n    },\n    true\n  );\n\n  return [...bundles.ios.assets, ...bundles.android.assets, ...manifestAssets];\n}\n\n/**\n * Configures exp, preparing it for asset export\n *\n * @modifies {exp}\n *\n */\nasync function _configureExpForAssets(projectRoot: string, exp: ExpoConfig, assets: Asset[]) {\n  // Add google services file if it exists\n  await _resolveGoogleServicesFile(projectRoot, exp);\n\n  // Convert asset patterns to a list of asset strings that match them.\n  // Assets strings are formatted as `asset_<hash>.<type>` and represent\n  // the name that the file will have in the app bundle. The `asset_` prefix is\n  // needed because android doesn't support assets that start with numbers.\n  if (exp.assetBundlePatterns) {\n    const fullPatterns: string[] = exp.assetBundlePatterns.map((p: string) =>\n      path.join(projectRoot, p)\n    );\n    logger.global.info('Processing asset bundle patterns:');\n    fullPatterns.forEach(p => logger.global.info('- ' + p));\n    // The assets returned by the RN packager has duplicates so make sure we\n    // only bundle each once.\n    const bundledAssets = new Set();\n    for (const asset of assets) {\n      const file = asset.files && asset.files[0];\n      const shouldBundle =\n        '__packager_asset' in asset &&\n        asset.__packager_asset &&\n        file &&\n        fullPatterns.some((p: string) => minimatch(file, p));\n      ProjectUtils.logDebug(\n        projectRoot,\n        'expo',\n        `${shouldBundle ? 'Include' : 'Exclude'} asset ${file}`\n      );\n      if (shouldBundle) {\n        asset.fileHashes.forEach(hash =>\n          bundledAssets.add(\n            'asset_' + hash + ('type' in asset && asset.type ? '.' + asset.type : '')\n          )\n        );\n      }\n    }\n    exp.bundledAssets = [...bundledAssets];\n    delete exp.assetBundlePatterns;\n  }\n\n  return exp;\n}\n\nasync function publishAssetsAsync(\n  projectRoot: string,\n  exp: PublicConfig,\n  bundles: BundlesByPlatform\n) {\n  logger.global.info('Analyzing assets');\n\n  const assetCdnPath = urljoin(EXPO_CDN, '~assets');\n  const assets = await _collectAssets(projectRoot, exp, assetCdnPath, bundles);\n\n  logger.global.info('Uploading assets');\n\n  if (assets.length > 0 && assets[0].fileHashes) {\n    await uploadAssetsAsync(projectRoot, assets);\n  } else {\n    logger.global.info({ quiet: true }, 'No assets to upload, skipped.');\n  }\n\n  // Updates the manifest to reflect additional asset bundling + configs\n  await _configureExpForAssets(projectRoot, exp, assets);\n\n  return exp;\n}\n\nasync function exportAssetsAsync(\n  projectRoot: string,\n  exp: PublicConfig,\n  hostedUrl: string,\n  outputDir: string,\n  bundles: BundlesByPlatform\n) {\n  logger.global.info('Analyzing assets');\n\n  const assetCdnPath = urljoin(hostedUrl, 'assets');\n  const assets = await _collectAssets(projectRoot, exp, assetCdnPath, bundles);\n\n  logger.global.info('Saving assets');\n\n  if (assets.length > 0 && assets[0].fileHashes) {\n    await _saveAssetsAsync(projectRoot, assets, outputDir);\n  } else {\n    logger.global.info({ quiet: true }, 'No assets to upload, skipped.');\n  }\n\n  // Updates the manifest to reflect additional asset bundling + configs\n  await _configureExpForAssets(projectRoot, exp, assets);\n\n  return { exp, assets };\n}\n\nasync function _handleKernelPublishedAsync({\n  projectRoot,\n  user,\n  exp,\n  url,\n}: {\n  projectRoot: string;\n  user: User;\n  exp: ExpoConfig;\n  url: string;\n}) {\n  let kernelBundleUrl = `${Config.api.scheme}://${Config.api.host}`;\n  if (Config.api.port) {\n    kernelBundleUrl = `${kernelBundleUrl}:${Config.api.port}`;\n  }\n  kernelBundleUrl = `${kernelBundleUrl}/@${user.username}/${exp.slug}/bundle`;\n\n  if (exp.kernel.androidManifestPath) {\n    const manifest = await ExponentTools.getManifestAsync(url, {\n      'Exponent-SDK-Version': exp.sdkVersion,\n      'Exponent-Platform': 'android',\n      Accept: 'application/expo+json,application/json',\n    });\n    manifest.bundleUrl = kernelBundleUrl;\n    manifest.sdkVersion = 'UNVERSIONED';\n    await fs.writeFile(\n      path.resolve(projectRoot, exp.kernel.androidManifestPath),\n      JSON.stringify(manifest)\n    );\n  }\n\n  if (exp.kernel.iosManifestPath) {\n    const manifest = await ExponentTools.getManifestAsync(url, {\n      'Exponent-SDK-Version': exp.sdkVersion,\n      'Exponent-Platform': 'ios',\n      Accept: 'application/expo+json,application/json',\n    });\n    manifest.bundleUrl = kernelBundleUrl;\n    manifest.sdkVersion = 'UNVERSIONED';\n    await fs.writeFile(\n      path.resolve(projectRoot, exp.kernel.iosManifestPath),\n      JSON.stringify(manifest)\n    );\n  }\n}\n\n// TODO(jesse): Add analytics for upload\nasync function uploadAssetsAsync(projectRoot: string, assets: Asset[]) {\n  // Collect paths by key, also effectively handles duplicates in the array\n  const paths: { [fileHash: string]: string } = {};\n  assets.forEach(asset => {\n    asset.files.forEach((path: string, index: number) => {\n      paths[asset.fileHashes[index]] = path;\n    });\n  });\n\n  // Collect list of assets missing on host\n  const user = await UserManager.ensureLoggedInAsync();\n  const api = ApiV2.clientForUser(user);\n  const result = await api.postAsync('assets/metadata', { keys: Object.keys(paths) });\n\n  const metas = result.metadata;\n  const missing = Object.keys(paths).filter(key => !metas[key].exists);\n\n  if (missing.length === 0) {\n    logger.global.info({ quiet: true }, `No assets changed, skipped.`);\n  }\n\n  // Upload them!\n  await Promise.all(\n    chunk(missing, 5).map(async keys => {\n      const formData = new FormData();\n      for (const key of keys) {\n        ProjectUtils.logDebug(projectRoot, 'expo', `uploading ${paths[key]}`);\n\n        const relativePath = paths[key].replace(projectRoot, '');\n        logger.global.info({ quiet: true }, `Uploading ${relativePath}`);\n\n        formData.append(key, fs.createReadStream(paths[key]), paths[key]);\n      }\n\n      const user = await UserManager.ensureLoggedInAsync();\n      const api = ApiV2.clientForUser(user);\n      await api.uploadFormDataAsync('assets/upload', formData);\n    })\n  );\n}\n\ntype GetExpConfigOptions = {\n  current?: boolean;\n  mode?: string;\n  platform?: 'android' | 'ios' | 'all';\n  expIds?: string[];\n  type?: string;\n  releaseChannel?: string;\n  bundleIdentifier?: string;\n  publicUrl?: string;\n  sdkVersion?: string;\n};\n\nasync function getConfigAsync(\n  projectRoot: string,\n  options: Pick<GetExpConfigOptions, 'publicUrl' | 'platform'> = {}\n) {\n  if (!options.publicUrl) {\n    // get the manifest from the project directory\n    const { exp, pkg } = getConfig(projectRoot);\n    const configName = configFilename(projectRoot);\n    return {\n      exp,\n      pkg,\n      configName: configFilename(projectRoot),\n      configPrefix: configName === 'app.json' ? 'expo.' : '',\n    };\n  } else {\n    // get the externally hosted manifest\n    return {\n      exp: await ThirdParty.getManifest(options.publicUrl, options),\n      configName: options.publicUrl,\n      configPrefix: '',\n      pkg: {},\n    };\n  }\n}\n\ntype JobState = 'pending' | 'started' | 'in-progress' | 'finished' | 'errored' | 'sent-to-queue';\n\nexport type TurtleMode = 'normal' | 'high' | 'high_only';\n\n// https://github.com/expo/universe/blob/283efaba3acfdefdc7db12f649516b6d6a94bec4/server/www/src/data/entities/builds/BuildJobEntity.ts#L25-L56\nexport interface BuildJobFields {\n  id: string;\n  experienceName: string;\n  status: JobState;\n  platform: 'ios' | 'android';\n  userId: string | null;\n  experienceId: string;\n  artifactId: string | null;\n  nonce: string | null;\n  artifacts: {\n    url?: string;\n    manifestPlistUrl?: string;\n  } | null;\n  config: {\n    buildType?: string;\n    releaseChannel?: string;\n    bundleIdentifier?: string;\n  };\n  logs: object | null;\n  extraData: {\n    request_id?: string;\n    turtleMode?: TurtleMode;\n  } | null;\n  created: Date;\n  updated: Date;\n  expirationDate: Date;\n  sdkVersion: string | null;\n  turtleVersion: string | null;\n  buildDuration: number | null;\n  priority: string;\n  accountId: string | null;\n}\n\nexport type BuildStatusResult = {\n  jobs: BuildJobFields[];\n  err: null;\n  userHasBuiltAppBefore: boolean;\n  userHasBuiltExperienceBefore: boolean;\n  canPurchasePriorityBuilds: boolean;\n  numberOfRemainingPriorityBuilds: number;\n  hasUnlimitedPriorityBuilds: boolean;\n};\n\nexport type BuildCreatedResult = {\n  id: string;\n  ids: string[];\n  priority: 'normal' | 'high';\n  canPurchasePriorityBuilds: boolean;\n  numberOfRemainingPriorityBuilds: number;\n  hasUnlimitedPriorityBuilds: boolean;\n};\n\nfunction _validateManifest(options: any, exp: any, configName: string, configPrefix: string) {\n  if (options.platform === 'ios' || options.platform === 'all') {\n    if (!exp.ios || !exp.ios.bundleIdentifier) {\n      throw new XDLError(\n        'INVALID_MANIFEST',\n        `Must specify a bundle identifier in order to build this experience for iOS. ` +\n          `Please specify one in ${configName} at \"${configPrefix}ios.bundleIdentifier\"`\n      );\n    }\n  }\n\n  if (options.platform === 'android' || options.platform === 'all') {\n    if (!exp.android || !exp.android.package) {\n      throw new XDLError(\n        'INVALID_MANIFEST',\n        `Must specify a java package in order to build this experience for Android. ` +\n          `Please specify one in ${configName} at \"${configPrefix}android.package\"`\n      );\n    }\n  }\n}\nfunction _validateOptions(options: any) {\n  const schema = joi.object().keys({\n    current: joi.boolean(),\n    mode: joi.string(),\n    platform: joi.any().valid('ios', 'android', 'all'),\n    expIds: joi.array(),\n    type: joi.any().valid('archive', 'simulator', 'client', 'app-bundle', 'apk'),\n    releaseChannel: joi.string().regex(/[a-z\\d][a-z\\d._-]*/),\n    bundleIdentifier: joi.string().regex(/^[a-zA-Z][a-zA-Z0-9\\-.]+$/),\n    publicUrl: joi.string(),\n    sdkVersion: joi.string().strict(),\n  });\n\n  const { error } = schema.validate(options);\n  if (error) {\n    throw new XDLError('INVALID_OPTIONS', error.toString());\n  }\n}\n\nasync function _getExpAsync(\n  projectRoot: string,\n  options: Pick<GetExpConfigOptions, 'publicUrl' | 'mode' | 'platform'>\n) {\n  const { exp, pkg, configName, configPrefix } = await getConfigAsync(projectRoot, options);\n\n  if (!exp || !pkg) {\n    throw new XDLError(\n      'NO_PACKAGE_JSON',\n      `Couldn't read ${configName} file in project at ${projectRoot}`\n    );\n  }\n\n  // Support version and name being specified in package.json for legacy\n  // support pre: exp.json\n  if (!exp.version && 'version' in pkg && pkg.version) {\n    exp.version = pkg.version;\n  }\n  if (!exp.name && 'name' in pkg && typeof pkg.name === 'string') {\n    exp.name = pkg.name;\n  }\n  if (!exp.slug && typeof exp.name === 'string') {\n    exp.slug = slug(exp.name.toLowerCase());\n  }\n  return { exp, configName, configPrefix };\n}\n\nexport async function getBuildStatusAsync(\n  projectRoot: string,\n  options: GetExpConfigOptions = {}\n): Promise<BuildStatusResult> {\n  const user = await UserManager.ensureLoggedInAsync();\n\n  _assertValidProjectRoot(projectRoot);\n  _validateOptions(options);\n  const { exp } = await _getExpAsync(projectRoot, options);\n\n  const api = ApiV2.clientForUser(user);\n  return await api.postAsync('build/status', { manifest: exp, options });\n}\n\nexport async function startBuildAsync(\n  projectRoot: string,\n  options: GetExpConfigOptions = {}\n): Promise<BuildCreatedResult> {\n  const user = await UserManager.ensureLoggedInAsync();\n\n  _assertValidProjectRoot(projectRoot);\n  _validateOptions(options);\n  const { exp, configName, configPrefix } = await _getExpAsync(projectRoot, options);\n  _validateManifest(options, exp, configName, configPrefix);\n\n  Analytics.logEvent('Build Shell App', {\n    projectRoot,\n    developerTool: Config.developerTool,\n    platform: options.platform,\n  });\n\n  const api = ApiV2.clientForUser(user);\n  return await api.putAsync('build/start', { manifest: exp, options });\n}\n\nasync function _waitForRunningAsync(\n  projectRoot: string,\n  url: string,\n  retries: number = 300\n): Promise<true> {\n  try {\n    const response = await axios.request({\n      url,\n      responseType: 'text',\n      proxy: false,\n    });\n    if (/packager-status:running/.test(response.data)) {\n      return true;\n    } else if (retries === 0) {\n      ProjectUtils.logError(\n        projectRoot,\n        'expo',\n        `Could not get status from Metro bundler. Server response: ${response.data}`\n      );\n    }\n  } catch (e) {\n    if (retries === 0) {\n      ProjectUtils.logError(\n        projectRoot,\n        'expo',\n        `Could not get status from Metro bundler. ${e.message}`\n      );\n    }\n  }\n\n  if (retries <= 0) {\n    throw new Error('Connecting to Metro bundler failed.');\n  } else {\n    await delayAsync(100);\n    return _waitForRunningAsync(projectRoot, url, retries - 1);\n  }\n}\n\n// The --verbose flag is intended for react-native-cli/metro, not expo-cli\nconst METRO_VERBOSE_WARNING = 'Run CLI with --verbose flag for more details.';\n\n// Remove these constants and related code when SDK35 isn't supported anymore\n// Context: https://github.com/expo/expo-cli/issues/1074\nconst NODE_12_WINDOWS_METRO_ERROR = `Invalid regular expression: /(.*\\\\__fixtures__\\\\.*|node_modules[\\\\]react[\\\\]dist[\\\\].*|website\\\\node_modules\\\\.*|heapCapture\\\\bundle.js|.*\\\\__tests__\\\\.*)$/: Unterminated character class`;\nconst NODE_12_WINDOWS_METRO_SUGGESTION = `\\nUnable to start the project due to a documented incompatibility between Node 12 LTS and Expo SDK 35 on Windows.\nPlease refer to this GitHub comment for a solution:\nhttps://github.com/expo/expo-cli/issues/1074#issuecomment-559220752\\n`;\n\nfunction _logPackagerOutput(projectRoot: string, level: string, data: object) {\n  let output = data.toString();\n  if (!output) {\n    return;\n  }\n  // Temporarily hide warnings about duplicate providesModule declarations\n  // under react-native\n  if (_isIgnorableDuplicateModuleWarning(projectRoot, level, output)) {\n    ProjectUtils.logDebug(\n      projectRoot,\n      'expo',\n      `Suppressing @providesModule warning: ${output}`,\n      'project-suppress-providesmodule-warning'\n    );\n    return;\n  }\n  if (_isIgnorableMetroConsoleOutput(output) || _isIgnorableRnpmWarning(output)) {\n    ProjectUtils.logDebug(projectRoot, 'expo', output);\n    return;\n  }\n\n  if (output.includes(NODE_12_WINDOWS_METRO_ERROR)) {\n    ProjectUtils.logError(projectRoot, 'expo', NODE_12_WINDOWS_METRO_SUGGESTION);\n    return;\n  }\n\n  if (output.includes(METRO_VERBOSE_WARNING)) {\n    output = output.replace(METRO_VERBOSE_WARNING, '');\n  }\n\n  if (/^Scanning folders for symlinks in /.test(output)) {\n    ProjectUtils.logDebug(projectRoot, 'metro', output);\n    return;\n  }\n  if (level === 'info') {\n    ProjectUtils.logInfo(projectRoot, 'metro', output);\n  } else {\n    ProjectUtils.logError(projectRoot, 'metro', output);\n  }\n}\n\nfunction _isIgnorableMetroConsoleOutput(output: string) {\n  // As of react-native 0.61.x, Metro prints console logs from the device to console, without\n  // passing them through the custom log reporter.\n  //\n  // Managed apps have a separate remote logging implementation included in the Expo SDK,\n  // (see: _handleDeviceLogs), so we can just ignore these device logs from Metro.\n  // if (/^ () /)\n  //\n  // These logs originate from:\n  // https://github.com/facebook/metro/blob/e8181fb9db7db31adf7d1ed9ab840f54449ef238/packages/metro/src/lib/logToConsole.js#L50\n  return /^\\s+(INFO|WARN|LOG|GROUP|DEBUG) /.test(output);\n}\n\nfunction _isIgnorableRnpmWarning(output: string) {\n  return output.startsWith(\n    'warn The following packages use deprecated \"rnpm\" config that will stop working from next release'\n  );\n}\n\nfunction _isIgnorableDuplicateModuleWarning(\n  projectRoot: string,\n  level: string,\n  output: string\n): boolean {\n  if (\n    level !== 'error' ||\n    !output.startsWith('jest-haste-map: @providesModule naming collision:')\n  ) {\n    return false;\n  }\n\n  const reactNativeNodeModulesPath = path.join(\n    projectRoot,\n    'node_modules',\n    'react-native',\n    'node_modules'\n  );\n  const reactNativeNodeModulesPattern = escapeRegExp(reactNativeNodeModulesPath);\n  const reactNativeNodeModulesCollisionRegex = new RegExp(\n    `Paths: ${reactNativeNodeModulesPattern}.+ collides with ${reactNativeNodeModulesPattern}.+`\n  );\n  return reactNativeNodeModulesCollisionRegex.test(output);\n}\n\nfunction _isIgnorableBugReportingExtraData(body: any[]) {\n  return body.length === 2 && body[0] === 'BugReporting extraData:';\n}\n\nfunction _isAppRegistryStartupMessage(body: any[]) {\n  return (\n    body.length === 1 &&\n    (/^Running application \"main\" with appParams:/.test(body[0]) ||\n      /^Running \"main\" with \\{/.test(body[0]))\n  );\n}\n\ntype ConsoleLogLevel = 'info' | 'warn' | 'error' | 'debug';\n\nfunction _handleDeviceLogs(projectRoot: string, deviceId: string, deviceName: string, logs: any) {\n  for (let i = 0; i < logs.length; i++) {\n    const log = logs[i];\n    let body = typeof log.body === 'string' ? [log.body] : log.body;\n    let { level } = log;\n\n    if (_isIgnorableBugReportingExtraData(body)) {\n      level = 'debug';\n    }\n    if (_isAppRegistryStartupMessage(body)) {\n      body = [`Running application on ${deviceName}.`];\n    }\n\n    const args = body.map((obj: any) => {\n      if (typeof obj === 'undefined') {\n        return 'undefined';\n      }\n      if (obj === 'null') {\n        return 'null';\n      }\n      if (typeof obj === 'string' || typeof obj === 'number' || typeof obj === 'boolean') {\n        return obj;\n      }\n      try {\n        return JSON.stringify(obj);\n      } catch (e) {\n        return obj.toString();\n      }\n    });\n    const logLevel =\n      level === 'info' || level === 'warn' || level === 'error' || level === 'debug'\n        ? (level as ConsoleLogLevel)\n        : 'info';\n    ProjectUtils.getLogger(projectRoot)[logLevel](\n      {\n        tag: 'device',\n        deviceId,\n        deviceName,\n        groupDepth: log.groupDepth,\n        shouldHide: log.shouldHide,\n        includesStack: log.includesStack,\n      },\n      ...args\n    );\n  }\n}\nexport async function startReactNativeServerAsync(\n  projectRoot: string,\n  options: StartOptions = {},\n  verbose: boolean = true\n): Promise<void> {\n  _assertValidProjectRoot(projectRoot);\n  await stopReactNativeServerAsync(projectRoot);\n  await Watchman.addToPathAsync(); // Attempt to fix watchman if it's hanging\n  await Watchman.unblockAndGetVersionAsync(projectRoot);\n\n  const { exp } = getConfig(projectRoot);\n\n  let packagerPort = await _getFreePortAsync(19001); // Create packager options\n\n  const customLogReporterPath: string = require.resolve(path.join(__dirname, '../build/reporter'));\n\n  // TODO: Bacon: Support .mjs (short-lived JS modules extension that some packages use)\n  const sourceExtsConfig = { isTS: true, isReact: true, isModern: false };\n  const sourceExts =\n    options.target === 'bare'\n      ? getBareExtensions([], sourceExtsConfig)\n      : getManagedExtensions([], sourceExtsConfig);\n\n  let packagerOpts: { [key: string]: any } = {\n    port: packagerPort,\n    customLogReporterPath,\n    sourceExts,\n  };\n\n  if (options.nonPersistent && Versions.lteSdkVersion(exp, '32.0.0')) {\n    packagerOpts.nonPersistent = true;\n  }\n\n  if (Versions.gteSdkVersion(exp, '33.0.0')) {\n    // starting with SDK 37, we bundle this plugin with the expo-asset package instead of expo,\n    // so check there first and fall back to expo if we can't find it in expo-asset\n    try {\n      packagerOpts.assetPlugins = resolveModule(\n        'expo-asset/tools/hashAssetFiles',\n        projectRoot,\n        exp\n      );\n    } catch (e) {\n      packagerOpts.assetPlugins = resolveModule('expo/tools/hashAssetFiles', projectRoot, exp);\n    }\n  }\n\n  if (options.maxWorkers) {\n    packagerOpts['max-workers'] = options.maxWorkers;\n  }\n\n  if (!Versions.gteSdkVersion(exp, '16.0.0')) {\n    delete packagerOpts.customLogReporterPath;\n  }\n  const userPackagerOpts = exp.packagerOpts;\n\n  if (userPackagerOpts) {\n    // The RN CLI expects rn-cli.config.js's path to be absolute. We use the\n    // project root to resolve relative paths since that was the original\n    // behavior of the RN CLI.\n    if (userPackagerOpts.config) {\n      userPackagerOpts.config = path.resolve(projectRoot, userPackagerOpts.config);\n    }\n\n    // Provide a fallback if the value isn't given\n    const userSourceExts = userPackagerOpts.sourceExts ?? [];\n\n    packagerOpts = {\n      ...packagerOpts,\n      ...userPackagerOpts,\n      // In order to prevent people from forgetting to include the .expo extension or other things\n      // NOTE(brentvatne): we should probably do away with packagerOpts soon in favor of @expo/metro-config!\n      sourceExts: [...new Set([...packagerOpts.sourceExts, ...userSourceExts])],\n    };\n\n    if (userPackagerOpts.port !== undefined && userPackagerOpts.port !== null) {\n      packagerPort = userPackagerOpts.port;\n    }\n  }\n  const cliOpts = ['start'];\n  for (const [key, val] of Object.entries(packagerOpts)) {\n    // If the packager opt value is boolean, don't set\n    // --[opt] [value], just set '--opt'\n    if (val && typeof val === 'boolean') {\n      cliOpts.push(`--${key}`);\n    } else if (val) {\n      cliOpts.push(`--${key}`, val);\n    }\n  }\n\n  if (process.env.EXPO_DEBUG) {\n    cliOpts.push('--verbose');\n  }\n\n  if (options.reset) {\n    cliOpts.push('--reset-cache');\n  } // Get custom CLI path from project package.json, but fall back to node_module path\n  const defaultCliPath = resolveModule('react-native/local-cli/cli.js', projectRoot, exp);\n  const cliPath = exp.rnCliPath || defaultCliPath;\n  let nodePath;\n  // When using a custom path for the RN CLI, we want it to use the project\n  // root to look up config files and Node modules\n  if (exp.rnCliPath) {\n    nodePath = _nodePathForProjectRoot(projectRoot);\n  } else {\n    nodePath = null;\n  }\n  // Run the copy of Node that's embedded in Electron by setting the\n  // ELECTRON_RUN_AS_NODE environment variable\n  // Note: the CLI script sets up graceful-fs and sets ulimit to 4096 in the\n  // child process\n  const nodePathEnv = nodePath ? { NODE_PATH: nodePath } : {};\n  const packagerProcess = child_process.fork(cliPath, cliOpts, {\n    cwd: projectRoot,\n    env: {\n      ...process.env,\n      REACT_NATIVE_APP_ROOT: projectRoot,\n      ELECTRON_RUN_AS_NODE: '1',\n      ...nodePathEnv,\n    },\n    silent: true,\n  });\n  await ProjectSettings.setPackagerInfoAsync(projectRoot, {\n    packagerPort,\n    packagerPid: packagerProcess.pid,\n  }); // TODO: do we need this? don't know if it's ever called\n  process.on('exit', () => {\n    treekill(packagerProcess.pid);\n  });\n  if (!packagerProcess.stdout) {\n    throw new Error('Expected spawned process to have a stdout stream, but none was found.');\n  }\n  if (!packagerProcess.stderr) {\n    throw new Error('Expected spawned process to have a stderr stream, but none was found.');\n  }\n  packagerProcess.stdout.setEncoding('utf8');\n  packagerProcess.stderr.setEncoding('utf8');\n  packagerProcess.stdout.pipe(split()).on('data', data => {\n    if (verbose) {\n      _logPackagerOutput(projectRoot, 'info', data);\n    }\n  });\n  packagerProcess.stderr.on('data', data => {\n    if (verbose) {\n      _logPackagerOutput(projectRoot, 'error', data);\n    }\n  });\n  const exitPromise = new Promise((resolve, reject) => {\n    packagerProcess.once('exit', async code => {\n      ProjectUtils.logDebug(projectRoot, 'expo', `Metro Bundler process exited with code ${code}`);\n      if (code) {\n        reject(new Error(`Metro Bundler process exited with code ${code}`));\n      } else {\n        resolve();\n      }\n      try {\n        await ProjectSettings.setPackagerInfoAsync(projectRoot, {\n          packagerPort: null,\n          packagerPid: null,\n        });\n      } catch (e) {}\n    });\n  });\n  const packagerUrl = await UrlUtils.constructBundleUrlAsync(projectRoot, {\n    urlType: 'http',\n    hostType: 'localhost',\n  });\n  await Promise.race([_waitForRunningAsync(projectRoot, `${packagerUrl}/status`), exitPromise]);\n}\n\n// Simulate the node_modules resolution\n// If you project dir is /Jesse/Expo/Universe/BubbleBounce, returns\n// \"/Jesse/node_modules:/Jesse/Expo/node_modules:/Jesse/Expo/Universe/node_modules:/Jesse/Expo/Universe/BubbleBounce/node_modules\"\nfunction _nodePathForProjectRoot(projectRoot: string): string {\n  const paths = [];\n  let directory = path.resolve(projectRoot);\n  while (true) {\n    paths.push(path.join(directory, 'node_modules'));\n    const parentDirectory = path.dirname(directory);\n    if (directory === parentDirectory) {\n      break;\n    }\n    directory = parentDirectory;\n  }\n  return paths.join(path.delimiter);\n}\nexport async function stopReactNativeServerAsync(projectRoot: string): Promise<void> {\n  _assertValidProjectRoot(projectRoot);\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  if (!packagerInfo.packagerPort || !packagerInfo.packagerPid) {\n    ProjectUtils.logDebug(projectRoot, 'expo', `No packager found for project at ${projectRoot}.`);\n    return;\n  }\n  ProjectUtils.logDebug(\n    projectRoot,\n    'expo',\n    `Killing packager process tree: ${packagerInfo.packagerPid}`\n  );\n  try {\n    await treekillAsync(packagerInfo.packagerPid, 'SIGKILL');\n  } catch (e) {\n    ProjectUtils.logDebug(projectRoot, 'expo', `Error stopping packager process: ${e.toString()}`);\n  }\n  await ProjectSettings.setPackagerInfoAsync(projectRoot, {\n    packagerPort: null,\n    packagerPid: null,\n  });\n}\n\nconst blacklistedEnvironmentVariables = new Set([\n  'EXPO_APPLE_PASSWORD',\n  'EXPO_ANDROID_KEY_PASSWORD',\n  'EXPO_ANDROID_KEYSTORE_PASSWORD',\n  'EXPO_IOS_DIST_P12_PASSWORD',\n  'EXPO_IOS_PUSH_P12_PASSWORD',\n  'EXPO_CLI_PASSWORD',\n]);\n\nfunction shouldExposeEnvironmentVariableInManifest(key: string) {\n  if (blacklistedEnvironmentVariables.has(key.toUpperCase())) {\n    return false;\n  }\n  return key.startsWith('REACT_NATIVE_') || key.startsWith('EXPO_');\n}\n\nfunction stripPort(host: string | undefined): string | undefined {\n  if (!host) {\n    return host;\n  }\n  return new URL('/', `http://${host}`).hostname;\n}\n\nfunction getManifestHandler(projectRoot: string) {\n  return async (\n    req: express.Request | http.IncomingMessage,\n    res: express.Response | http.ServerResponse\n  ) => {\n    try {\n      // We intentionally don't `await`. We want to continue trying even\n      // if there is a potential error in the package.json and don't want to slow\n      // down the request\n      Doctor.validateWithNetworkAsync(projectRoot);\n      // Get packager opts and then copy into bundleUrlPackagerOpts\n      const packagerOpts = await ProjectSettings.readAsync(projectRoot);\n      const { exp: manifest } = getConfig(projectRoot);\n      const bundleUrlPackagerOpts = JSON.parse(JSON.stringify(packagerOpts));\n      bundleUrlPackagerOpts.urlType = 'http';\n      if (bundleUrlPackagerOpts.hostType === 'redirect') {\n        bundleUrlPackagerOpts.hostType = 'tunnel';\n      }\n      manifest.xde = true; // deprecated\n      manifest.developer = {\n        tool: Config.developerTool,\n        projectRoot,\n      };\n      manifest.packagerOpts = packagerOpts;\n      manifest.env = {};\n      for (const key of Object.keys(process.env)) {\n        if (shouldExposeEnvironmentVariableInManifest(key)) {\n          manifest.env[key] = process.env[key];\n        }\n      }\n      const platform = (req.headers['exponent-platform'] || 'ios').toString();\n      const entryPoint = Exp.determineEntryPoint(projectRoot, platform);\n      const mainModuleName = UrlUtils.guessMainModulePath(entryPoint);\n      const queryParams = await UrlUtils.constructBundleQueryParamsAsync(projectRoot, packagerOpts);\n      const path = `/${encodeURI(mainModuleName)}.bundle?platform=${encodeURIComponent(\n        platform\n      )}&${queryParams}`;\n      const hostname = stripPort(req.headers.host);\n      manifest.bundleUrl =\n        (await UrlUtils.constructBundleUrlAsync(projectRoot, bundleUrlPackagerOpts, hostname)) +\n        path;\n      manifest.debuggerHost = await UrlUtils.constructDebuggerHostAsync(projectRoot, hostname);\n      manifest.mainModuleName = mainModuleName;\n      manifest.logUrl = await UrlUtils.constructLogUrlAsync(projectRoot, hostname);\n      manifest.hostUri = await UrlUtils.constructHostUriAsync(projectRoot, hostname);\n      await _resolveManifestAssets(\n        projectRoot,\n        manifest as PublicConfig,\n        async path => manifest.bundleUrl.match(/^https?:\\/\\/.*?\\//)[0] + 'assets/' + path\n      ); // the server normally inserts this but if we're offline we'll do it here\n      await _resolveGoogleServicesFile(projectRoot, manifest);\n      const hostUUID = await UserSettings.anonymousIdentifier();\n      const currentSession = await UserManager.getSessionAsync();\n      if (!currentSession || Config.offline) {\n        manifest.id = `@${ANONYMOUS_USERNAME}/${manifest.slug}-${hostUUID}`;\n      }\n      let manifestString;\n      if (req.headers['exponent-accept-signature']) {\n        manifestString =\n          !currentSession || Config.offline\n            ? getUnsignedManifestString(manifest)\n            : await getSignedManifestStringAsync(manifest, currentSession);\n      } else {\n        manifestString = JSON.stringify(manifest);\n      }\n      const hostInfo = {\n        host: hostUUID,\n        server: 'xdl',\n        serverVersion: require('@expo/xdl/package.json').version,\n        serverDriver: Config.developerTool,\n        serverOS: os.platform(),\n        serverOSVersion: os.release(),\n      };\n      res.setHeader('Exponent-Server', JSON.stringify(hostInfo));\n      res.end(manifestString);\n      Analytics.logEvent('Serve Manifest', {\n        projectRoot,\n        developerTool: Config.developerTool,\n        sdkVersion: manifest.sdkVersion ?? null,\n      });\n    } catch (e) {\n      ProjectUtils.logError(projectRoot, 'expo', e.stack);\n      // 5xx = Server Error HTTP code\n      res.statusCode = 520;\n      res.end(\n        JSON.stringify({\n          error: e.toString(),\n        })\n      );\n    }\n  };\n}\n\nexport async function getSignedManifestStringAsync(\n  manifest: ExpoConfig,\n  // NOTE: we currently ignore the currentSession that is passed in, see the note below about analytics.\n  currentSession: { sessionSecret: string }\n) {\n  const manifestString = JSON.stringify(manifest);\n  if (_cachedSignedManifest.manifestString === manifestString) {\n    return _cachedSignedManifest.signedManifest;\n  }\n  // WARNING: Removing the following line will regress analytics, see: https://github.com/expo/expo-cli/pull/2357\n  // TODO: make this more obvious from code\n  const user = await UserManager.ensureLoggedInAsync();\n  const { response } = await ApiV2.clientForUser(user).postAsync('manifest/sign', {\n    args: {\n      remoteUsername: manifest.owner ?? (await UserManager.getCurrentUsernameAsync()),\n      remotePackageName: manifest.slug,\n    },\n    manifest,\n  });\n  _cachedSignedManifest.manifestString = manifestString;\n  _cachedSignedManifest.signedManifest = response;\n  return response;\n}\n\nexport function getUnsignedManifestString(manifest: ExpoConfig) {\n  const unsignedManifest = {\n    manifestString: JSON.stringify(manifest),\n    signature: 'UNSIGNED',\n  };\n  return JSON.stringify(unsignedManifest);\n}\n\nexport async function startExpoServerAsync(projectRoot: string): Promise<void> {\n  _assertValidProjectRoot(projectRoot);\n  await stopExpoServerAsync(projectRoot);\n  const app = express();\n  app.use(\n    express.json({\n      limit: '10mb',\n    })\n  );\n  app.use(\n    express.urlencoded({\n      limit: '10mb',\n      extended: true,\n    })\n  );\n  if (\n    (ConnectionStatus.isOffline()\n      ? await Doctor.validateWithoutNetworkAsync(projectRoot)\n      : await Doctor.validateWithNetworkAsync(projectRoot)) === Doctor.FATAL\n  ) {\n    throw new Error(`Couldn't start project. Please fix the errors and restart the project.`);\n  }\n  // Serve the manifest.\n  const manifestHandler = getManifestHandler(projectRoot);\n  app.get('/', manifestHandler);\n  app.get('/manifest', manifestHandler);\n  app.get('/index.exp', manifestHandler);\n  app.post('/logs', async (req, res) => {\n    try {\n      const deviceId = req.get('Device-Id');\n      const deviceName = req.get('Device-Name');\n      if (deviceId && deviceName && req.body) {\n        _handleDeviceLogs(projectRoot, deviceId, deviceName, req.body);\n      }\n    } catch (e) {\n      ProjectUtils.logError(projectRoot, 'expo', `Error getting device logs: ${e} ${e.stack}`);\n    }\n    res.send('Success');\n  });\n  app.post('/shutdown', async (req, res) => {\n    server.close();\n    res.send('Success');\n  });\n  const expRc = await readExpRcAsync(projectRoot);\n  const expoServerPort = expRc.manifestPort ? expRc.manifestPort : await _getFreePortAsync(19000);\n  await ProjectSettings.setPackagerInfoAsync(projectRoot, {\n    expoServerPort,\n  });\n  let server = app.listen(expoServerPort, () => {\n    const info = server.address() as AddressInfo;\n    const host = info.address;\n    const port = info.port;\n    ProjectUtils.logDebug(projectRoot, 'expo', `Local server listening at http://${host}:${port}`);\n  });\n  await Exp.saveRecentExpRootAsync(projectRoot);\n}\n\nexport async function stopExpoServerAsync(projectRoot: string): Promise<void> {\n  _assertValidProjectRoot(projectRoot);\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  if (packagerInfo && packagerInfo.expoServerPort) {\n    try {\n      await axios.request({\n        method: 'post',\n        url: `http://127.0.0.1:${packagerInfo.expoServerPort}/shutdown`,\n      });\n    } catch (e) {}\n  }\n  await ProjectSettings.setPackagerInfoAsync(projectRoot, {\n    expoServerPort: null,\n  });\n}\n\nasync function startDevServerAsync(projectRoot: string, startOptions: StartOptions) {\n  _assertValidProjectRoot(projectRoot);\n\n  const port = await _getFreePortAsync(19000); // Create packager options\n  await ProjectSettings.setPackagerInfoAsync(projectRoot, {\n    expoServerPort: port,\n    packagerPort: port,\n  });\n\n  const options: MetroDevServerOptions = {\n    port,\n    logger: ProjectUtils.getLogger(projectRoot),\n  };\n  if (startOptions.reset) {\n    options.resetCache = true;\n  }\n  if (startOptions.maxWorkers != null) {\n    options.maxWorkers = startOptions.maxWorkers;\n  }\n  if (startOptions.target) {\n    // EXPO_TARGET is used by @expo/metro-config to determine the target when getDefaultConfig is\n    // called from metro.config.js and the --target option is used to override the default target.\n    process.env.EXPO_TARGET = startOptions.target;\n  }\n\n  const { middleware } = await runMetroDevServerAsync(projectRoot, options);\n  middleware.use(getManifestHandler(projectRoot));\n}\n\nasync function _connectToNgrokAsync(\n  projectRoot: string,\n  args: ngrok.NgrokOptions,\n  hostnameAsync: () => Promise<string>,\n  ngrokPid: number | null | undefined,\n  attempts: number = 0\n): Promise<string> {\n  try {\n    const configPath = path.join(UserSettings.dotExpoHomeDirectory(), 'ngrok.yml');\n    const hostname = await hostnameAsync();\n    const url = await ngrokConnectAsync({\n      hostname,\n      configPath,\n      ...args,\n    });\n    return url;\n  } catch (e) {\n    // Attempt to connect 3 times\n    if (attempts >= 2) {\n      if (e.message) {\n        throw new XDLError('NGROK_ERROR', e.toString());\n      } else {\n        throw new XDLError('NGROK_ERROR', JSON.stringify(e));\n      }\n    }\n    if (!attempts) {\n      attempts = 0;\n    } // Attempt to fix the issue\n    if (e.error_code && e.error_code === 103) {\n      if (attempts === 0) {\n        // Failed to start tunnel. Might be because url already bound to another session.\n        if (ngrokPid) {\n          try {\n            process.kill(ngrokPid, 'SIGKILL');\n          } catch (e) {\n            ProjectUtils.logDebug(projectRoot, 'expo', `Couldn't kill ngrok with PID ${ngrokPid}`);\n          }\n        } else {\n          await ngrokKillAsync();\n        }\n      } else {\n        // Change randomness to avoid conflict if killing ngrok didn't help\n        await Exp.resetProjectRandomnessAsync(projectRoot);\n      }\n    } // Wait 100ms and then try again\n    await delayAsync(100);\n    return _connectToNgrokAsync(projectRoot, args, hostnameAsync, null, attempts + 1);\n  }\n}\n\nexport async function startTunnelsAsync(projectRoot: string): Promise<void> {\n  const username = (await UserManager.getCurrentUsernameAsync()) || ANONYMOUS_USERNAME;\n  _assertValidProjectRoot(projectRoot);\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  if (!packagerInfo.packagerPort) {\n    throw new XDLError('NO_PACKAGER_PORT', `No packager found for project at ${projectRoot}.`);\n  }\n  if (!packagerInfo.expoServerPort) {\n    throw new XDLError(\n      'NO_EXPO_SERVER_PORT',\n      `No Expo server found for project at ${projectRoot}.`\n    );\n  }\n  const expoServerPort = packagerInfo.expoServerPort;\n  await stopTunnelsAsync(projectRoot);\n  if (await Android.startAdbReverseAsync(projectRoot)) {\n    ProjectUtils.logInfo(\n      projectRoot,\n      'expo',\n      'Successfully ran `adb reverse`. Localhost URLs should work on the connected Android device.'\n    );\n  }\n  const packageShortName = path.parse(projectRoot).base;\n  const expRc = await readExpRcAsync(projectRoot);\n\n  let startedTunnelsSuccessfully = false;\n\n  // Some issues with ngrok cause it to hang indefinitely. After\n  // TUNNEL_TIMEOUTms we just throw an error.\n  await Promise.race([\n    (async () => {\n      await delayAsync(TUNNEL_TIMEOUT);\n      if (!startedTunnelsSuccessfully) {\n        throw new Error('Starting tunnels timed out');\n      }\n    })(),\n    (async () => {\n      const expoServerNgrokUrl = await _connectToNgrokAsync(\n        projectRoot,\n        {\n          authtoken: Config.ngrok.authToken,\n          port: expoServerPort,\n          proto: 'http',\n        },\n        async () => {\n          const randomness = expRc.manifestTunnelRandomness\n            ? expRc.manifestTunnelRandomness\n            : await Exp.getProjectRandomnessAsync(projectRoot);\n          return [\n            randomness,\n            UrlUtils.domainify(username),\n            UrlUtils.domainify(packageShortName),\n            Config.ngrok.domain,\n          ].join('.');\n        },\n        packagerInfo.ngrokPid\n      );\n      const packagerNgrokUrl = await _connectToNgrokAsync(\n        projectRoot,\n        {\n          authtoken: Config.ngrok.authToken,\n          port: packagerInfo.packagerPort,\n          proto: 'http',\n        },\n        async () => {\n          const randomness = expRc.manifestTunnelRandomness\n            ? expRc.manifestTunnelRandomness\n            : await Exp.getProjectRandomnessAsync(projectRoot);\n          return [\n            'packager',\n            randomness,\n            UrlUtils.domainify(username),\n            UrlUtils.domainify(packageShortName),\n            Config.ngrok.domain,\n          ].join('.');\n        },\n        packagerInfo.ngrokPid\n      );\n      await ProjectSettings.setPackagerInfoAsync(projectRoot, {\n        expoServerNgrokUrl,\n        packagerNgrokUrl,\n        ngrokPid: ngrok.process().pid,\n      });\n\n      startedTunnelsSuccessfully = true;\n\n      ProjectUtils.logWithLevel(\n        projectRoot,\n        'info',\n        {\n          tag: 'expo',\n          _expoEventType: 'TUNNEL_READY',\n        },\n        'Tunnel ready.'\n      );\n\n      ngrok.addListener('statuschange', (status: string) => {\n        if (status === 'reconnecting') {\n          ProjectUtils.logError(\n            projectRoot,\n            'expo',\n            'We noticed your tunnel is having issues. ' +\n              'This may be due to intermittent problems with our tunnel provider. ' +\n              'If you have trouble connecting to your app, try to Restart the project, ' +\n              'or switch Host to LAN.'\n          );\n        } else if (status === 'online') {\n          ProjectUtils.logInfo(projectRoot, 'expo', 'Tunnel connected.');\n        }\n      });\n    })(),\n  ]);\n}\n\nexport async function stopTunnelsAsync(projectRoot: string): Promise<void> {\n  _assertValidProjectRoot(projectRoot);\n  // This will kill all ngrok tunnels in the process.\n  // We'll need to change this if we ever support more than one project\n  // open at a time in XDE.\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  const ngrokProcess = ngrok.process();\n  const ngrokProcessPid = ngrokProcess ? ngrokProcess.pid : null;\n  ngrok.removeAllListeners('statuschange');\n  if (packagerInfo.ngrokPid && packagerInfo.ngrokPid !== ngrokProcessPid) {\n    // Ngrok is running in some other process. Kill at the os level.\n    try {\n      process.kill(packagerInfo.ngrokPid);\n    } catch (e) {\n      ProjectUtils.logDebug(\n        projectRoot,\n        'expo',\n        `Couldn't kill ngrok with PID ${packagerInfo.ngrokPid}`\n      );\n    }\n  } else {\n    // Ngrok is running from the current process. Kill using ngrok api.\n    await ngrokKillAsync();\n  }\n  await ProjectSettings.setPackagerInfoAsync(projectRoot, {\n    expoServerNgrokUrl: null,\n    packagerNgrokUrl: null,\n    ngrokPid: null,\n  });\n  await Android.stopAdbReverseAsync(projectRoot);\n}\n\nexport async function setOptionsAsync(\n  projectRoot: string,\n  options: {\n    packagerPort?: number;\n  }\n): Promise<void> {\n  _assertValidProjectRoot(projectRoot); // Check to make sure all options are valid\n  if (options.packagerPort != null && !Number.isInteger(options.packagerPort)) {\n    throw new XDLError('INVALID_OPTIONS', 'packagerPort must be an integer');\n  }\n  await ProjectSettings.setPackagerInfoAsync(projectRoot, options);\n}\n\n// DEPRECATED(2019-08-21): use UrlUtils.constructManifestUrlAsync\nexport async function getUrlAsync(projectRoot: string, options: object = {}): Promise<string> {\n  _assertValidProjectRoot(projectRoot);\n  return await UrlUtils.constructManifestUrlAsync(projectRoot, options);\n}\n\nexport async function startAsync(\n  projectRoot: string,\n  options: StartOptions = {},\n  verbose: boolean = true\n): Promise<ExpoConfig> {\n  _assertValidProjectRoot(projectRoot);\n  const { exp } = getConfig(projectRoot);\n  Analytics.logEvent('Start Project', {\n    projectRoot,\n    developerTool: Config.developerTool,\n    sdkVersion: exp.sdkVersion ?? null,\n  });\n\n  if (options.webOnly) {\n    await Webpack.restartAsync(projectRoot, options);\n    DevSession.startSession(projectRoot, exp, 'web');\n    return exp;\n  } else if (getenv.boolish('EXPO_USE_DEV_SERVER', false)) {\n    await startDevServerAsync(projectRoot, options);\n    DevSession.startSession(projectRoot, exp, 'native');\n  } else {\n    await startExpoServerAsync(projectRoot);\n    await startReactNativeServerAsync(projectRoot, options, verbose);\n    DevSession.startSession(projectRoot, exp, 'native');\n  }\n\n  const { hostType } = await ProjectSettings.readAsync(projectRoot);\n\n  if (!Config.offline && hostType === 'tunnel') {\n    try {\n      await startTunnelsAsync(projectRoot);\n    } catch (e) {\n      ProjectUtils.logDebug(projectRoot, 'expo', `Error starting tunnel ${e.message}`);\n    }\n  }\n  return exp;\n}\n\nasync function _stopInternalAsync(projectRoot: string): Promise<void> {\n  DevSession.stopSession();\n  await Webpack.stopAsync(projectRoot);\n  ProjectUtils.logInfo(projectRoot, 'expo', '\\u203A Closing Expo server');\n  await stopExpoServerAsync(projectRoot);\n  ProjectUtils.logInfo(projectRoot, 'expo', '\\u203A Stopping Metro bundler');\n  await stopReactNativeServerAsync(projectRoot);\n  if (!Config.offline) {\n    try {\n      await stopTunnelsAsync(projectRoot);\n    } catch (e) {\n      ProjectUtils.logDebug(projectRoot, 'expo', `Error stopping ngrok ${e.message}`);\n    }\n  }\n\n  await Android.maybeStopAdbDaemonAsync();\n}\n\nexport async function stopWebOnlyAsync(projectDir: string): Promise<void> {\n  await Webpack.stopAsync(projectDir);\n  await DevSession.stopSession();\n}\n\nexport async function stopAsync(projectDir: string): Promise<void> {\n  const result = await Promise.race([\n    _stopInternalAsync(projectDir),\n    new Promise(resolve => setTimeout(resolve, 2000, 'stopFailed')),\n  ]);\n  if (result === 'stopFailed') {\n    // find RN packager and ngrok pids, attempt to kill them manually\n    const { packagerPid, ngrokPid } = await ProjectSettings.readPackagerInfoAsync(projectDir);\n    if (packagerPid) {\n      try {\n        process.kill(packagerPid);\n      } catch (e) {}\n    }\n    if (ngrokPid) {\n      try {\n        process.kill(ngrokPid);\n      } catch (e) {}\n    }\n    await ProjectSettings.setPackagerInfoAsync(projectDir, {\n      expoServerPort: null,\n      packagerPort: null,\n      packagerPid: null,\n      expoServerNgrokUrl: null,\n      packagerNgrokUrl: null,\n      ngrokPid: null,\n      webpackServerPort: null,\n    });\n  }\n}\n"],"file":"../Project.js","sourceRoot":"/@expo/xdl@57.9.28/src"}