{"version":3,"sources":["../../../src/commands/apply/configureAndroidProjectAsync.ts"],"names":["modifyBuildGradleAsync","projectRoot","callback","buildGradlePath","path","join","buildGradleString","fs","readFileSync","toString","result","writeFileSync","modifyAppBuildGradleAsync","modifyAndroidManifestAsync","androidManifestPath","AndroidConfig","Manifest","getProjectAndroidManifestPathAsync","Error","androidManifestJSON","readAndroidManifestAsync","writeAndroidManifestAsync","modifyMainActivityJavaAsync","mainActivityJavaPath","mainActivityString","configureAndroidProjectAsync","exp","skipSDKVersionRequirement","username","UserManager","getCurrentUsernameAsync","buildGradle","GoogleServices","setClassPath","applyPlugin","Package","setPackageInBuildGradle","Version","setVersionCode","setVersionName","androidManifest","setPackageInAndroidManifest","Scheme","setScheme","Orientation","setAndroidOrientation","Permissions","setAndroidPermissions","Branch","setBranchApiKey","Facebook","setFacebookConfig","UserInterfaceStyle","setUiModeAndroidManifest","GoogleMobileAds","setGoogleMobileAdsConfig","GoogleMapsApiKey","setGoogleMapsApiKey","IntentFilters","setAndroidIntentFilters","Updates","setUpdatesConfig","mainActivity","addOnConfigurationChangedMainActivity","renamePackageOnDisk","RootViewBackgroundColor","setRootViewBackgroundColor","NavigationBar","setNavigationBarConfig","StatusBar","setStatusBarConfig","PrimaryColor","setPrimaryColor","setFacebookAppIdString","setGoogleServicesFile","SplashScreen","setSplashScreenAsync","Icon","setIconAsync","AdaptiveIcon","setAdaptiveIconAsync"],"mappings":"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","sourcesContent":["import { AndroidConfig, getConfig } from '@expo/config';\nimport { UserManager } from '@expo/xdl';\nimport fs from 'fs-extra';\nimport { sync as globSync } from 'glob';\nimport path from 'path';\n\nasync function modifyBuildGradleAsync(\n  projectRoot: string,\n  callback: (buildGradle: string) => string\n) {\n  const buildGradlePath = path.join(projectRoot, 'android', 'build.gradle');\n  const buildGradleString = fs.readFileSync(buildGradlePath).toString();\n  const result = callback(buildGradleString);\n  fs.writeFileSync(buildGradlePath, result);\n}\n\nasync function modifyAppBuildGradleAsync(\n  projectRoot: string,\n  callback: (buildGradle: string) => string\n) {\n  const buildGradlePath = path.join(projectRoot, 'android', 'app', 'build.gradle');\n  const buildGradleString = fs.readFileSync(buildGradlePath).toString();\n  const result = callback(buildGradleString);\n  fs.writeFileSync(buildGradlePath, result);\n}\n\nasync function modifyAndroidManifestAsync(\n  projectRoot: string,\n  callback: (androidManifest: AndroidConfig.Manifest.Document) => AndroidConfig.Manifest.Document\n) {\n  const androidManifestPath = await AndroidConfig.Manifest.getProjectAndroidManifestPathAsync(\n    projectRoot\n  );\n  if (!androidManifestPath) {\n    throw new Error(`Could not find AndroidManifest.xml in project directory: \"${projectRoot}\"`);\n  }\n  const androidManifestJSON = await AndroidConfig.Manifest.readAndroidManifestAsync(\n    androidManifestPath\n  );\n  const result = await callback(androidManifestJSON);\n  await AndroidConfig.Manifest.writeAndroidManifestAsync(androidManifestPath, result);\n}\n\nasync function modifyMainActivityJavaAsync(\n  projectRoot: string,\n  callback: (mainActivityJava: string) => string\n) {\n  const mainActivityJavaPath = globSync(\n    path.join(projectRoot, 'android/app/src/main/java/**/MainActivity.java')\n  )[0];\n  const mainActivityString = fs.readFileSync(mainActivityJavaPath).toString();\n  const result = callback(mainActivityString);\n  fs.writeFileSync(mainActivityJavaPath, result);\n}\n\nexport default async function configureAndroidProjectAsync(projectRoot: string) {\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n  const username = await UserManager.getCurrentUsernameAsync();\n\n  await modifyBuildGradleAsync(projectRoot, (buildGradle: string) => {\n    buildGradle = AndroidConfig.GoogleServices.setClassPath(exp, buildGradle);\n    return buildGradle;\n  });\n\n  await modifyAppBuildGradleAsync(projectRoot, (buildGradle: string) => {\n    buildGradle = AndroidConfig.GoogleServices.applyPlugin(exp, buildGradle);\n    buildGradle = AndroidConfig.Package.setPackageInBuildGradle(exp, buildGradle);\n    buildGradle = AndroidConfig.Version.setVersionCode(exp, buildGradle);\n    buildGradle = AndroidConfig.Version.setVersionName(exp, buildGradle);\n    return buildGradle;\n  });\n\n  await modifyAndroidManifestAsync(projectRoot, async androidManifest => {\n    androidManifest = await AndroidConfig.Package.setPackageInAndroidManifest(exp, androidManifest);\n    androidManifest = await AndroidConfig.Scheme.setScheme(exp, androidManifest);\n    androidManifest = await AndroidConfig.Orientation.setAndroidOrientation(exp, androidManifest);\n    androidManifest = await AndroidConfig.Permissions.setAndroidPermissions(exp, androidManifest);\n    androidManifest = await AndroidConfig.Branch.setBranchApiKey(exp, androidManifest);\n    androidManifest = await AndroidConfig.Facebook.setFacebookConfig(exp, androidManifest);\n    androidManifest = await AndroidConfig.UserInterfaceStyle.setUiModeAndroidManifest(\n      exp,\n      androidManifest\n    );\n\n    androidManifest = await AndroidConfig.GoogleMobileAds.setGoogleMobileAdsConfig(\n      exp,\n      androidManifest\n    );\n    androidManifest = await AndroidConfig.GoogleMapsApiKey.setGoogleMapsApiKey(\n      exp,\n      androidManifest\n    );\n\n    androidManifest = await AndroidConfig.IntentFilters.setAndroidIntentFilters(\n      exp,\n      androidManifest\n    );\n\n    androidManifest = await AndroidConfig.Updates.setUpdatesConfig(exp, androidManifest, username);\n\n    return androidManifest;\n  });\n\n  await modifyMainActivityJavaAsync(projectRoot, mainActivity => {\n    mainActivity = AndroidConfig.UserInterfaceStyle.addOnConfigurationChangedMainActivity(\n      exp,\n      mainActivity\n    );\n    return mainActivity;\n  });\n\n  // If we renamed the package, we should also move it around and rename it in source files\n  await AndroidConfig.Package.renamePackageOnDisk(exp, projectRoot);\n\n  // Modify colors.xml and styles.xml\n  await AndroidConfig.RootViewBackgroundColor.setRootViewBackgroundColor(exp, projectRoot);\n  await AndroidConfig.NavigationBar.setNavigationBarConfig(exp, projectRoot);\n  await AndroidConfig.StatusBar.setStatusBarConfig(exp, projectRoot);\n  await AndroidConfig.PrimaryColor.setPrimaryColor(exp, projectRoot);\n\n  // Modify strings.xml\n  await AndroidConfig.Facebook.setFacebookAppIdString(exp, projectRoot);\n\n  // add google-services.json to project\n  await AndroidConfig.GoogleServices.setGoogleServicesFile(exp, projectRoot);\n\n  // TODOs\n  await AndroidConfig.SplashScreen.setSplashScreenAsync(exp, projectRoot);\n  await AndroidConfig.Icon.setIconAsync(exp, projectRoot);\n  await AndroidConfig.AdaptiveIcon.setAdaptiveIconAsync(exp, projectRoot);\n}\n"],"file":"configureAndroidProjectAsync.js"}