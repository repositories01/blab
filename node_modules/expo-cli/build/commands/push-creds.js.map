{"version":3,"sources":["../../src/commands/push-creds.ts"],"names":["program","command","description","option","asyncActionProjectDir","projectDir","options","apiKey","length","Error","user","UserManager","getCurrentUserAsync","apiClient","ApiV2","clientForUser","exp","ConfigUtils","getConfig","skipSDKVersionRequirement","username","owner","isProxyUser","slug","putAsync","fcmApiKey","getAsync","process","exit","deleteAsync","vapidSubjectDescription","vapidPubkey","vapidPvtkey","vapidSubject","_uploadWebPushCredientials","results","chalk","green","vapidPublicKey","vapidPrivateKey","args","remotePackageName","Exp","getPublishInfoAsync","result","status","JSON","stringify","error","isGeneration","oldVapidData","yellow","yellowBright","configPath","findConfigFile","appJson","parse","fse","readFile","then","value","toString","changedProperties","expo","push","notification","cyan","writeFile","join"],"mappings":"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","sourcesContent":["import * as ConfigUtils from '@expo/config';\nimport { ApiV2, Exp, UserManager } from '@expo/xdl';\nimport chalk from 'chalk';\nimport { Command } from 'commander';\nimport fse from 'fs-extra';\n\nimport log from '../log';\n\ntype VapidData = {\n  vapidSubject: string;\n  vapidPubkey?: string;\n  vapidPvtkey?: string;\n};\n\nexport default function (program: Command) {\n  program\n    .command('push:android:upload [project-dir]')\n    .description('Uploads a Firebase Cloud Messaging key for Android push notifications.')\n    .option('--api-key [api-key]', 'Server API key for FCM.')\n    .asyncActionProjectDir(async (projectDir: string, options: { apiKey?: string }) => {\n      if (!options.apiKey || options.apiKey.length === 0) {\n        throw new Error('Must specify an API key to upload with --api-key.');\n      }\n      log('Logging in...');\n\n      const user = await UserManager.getCurrentUserAsync();\n      if (!user) {\n        throw new Error('You must be logged in to proceed.');\n      }\n      const apiClient = ApiV2.clientForUser(user);\n\n      log('Reading project configuration...');\n      const { exp } = ConfigUtils.getConfig(projectDir, { skipSDKVersionRequirement: true });\n      let { username } = user;\n      if (exp.owner) {\n        username = exp.owner;\n      }\n\n      const isProxyUser = username !== user.username;\n      log(\n        `Setting API key on Expo's servers for project ${exp.slug}${\n          isProxyUser ? ` on behalf of ${username}` : ''\n        }...`\n      );\n\n      await apiClient.putAsync(`credentials/android/push/@${username}/${exp.slug}`, {\n        fcmApiKey: options.apiKey,\n      });\n\n      log('All done!');\n    });\n\n  program\n    .command('push:android:show [project-dir]')\n    .description('Print the value currently in use for FCM notifications for this project.')\n    .asyncActionProjectDir(async (projectDir: string) => {\n      log('Logging in...');\n\n      const user = await UserManager.getCurrentUserAsync();\n      if (!user) {\n        throw new Error('You must be logged in to proceed.');\n      }\n\n      log('Reading project configuration...');\n      const { exp } = ConfigUtils.getConfig(projectDir, { skipSDKVersionRequirement: true });\n      let { username } = user;\n      if (exp.owner) {\n        username = exp.owner;\n      }\n\n      const isProxyUser = username !== user.username;\n      log(\n        `Getting API key on Expo's servers for project ${exp.slug}${\n          isProxyUser ? ` on behalf of ${username}` : ''\n        }...`\n      );\n      const apiClient = ApiV2.clientForUser(user);\n      const { fcmApiKey } = await apiClient.getAsync(\n        `credentials/android/push/@${username}/${exp.slug}`\n      );\n      if (fcmApiKey) {\n        log(`FCM Api Key: ${fcmApiKey}`);\n      } else {\n        log(`There is no FCM Api Key configured for this project`);\n        process.exit(1);\n      }\n    });\n\n  program\n    .command('push:android:clear [project-dir]')\n    .description('Deletes a previously uploaded FCM credential.')\n    .asyncActionProjectDir(async (projectDir: string) => {\n      log('Logging in...');\n      const user = await UserManager.getCurrentUserAsync();\n      if (!user) {\n        throw new Error('You must be logged in to proceed.');\n      }\n\n      log('Reading project configuration...');\n      const { exp } = ConfigUtils.getConfig(projectDir, { skipSDKVersionRequirement: true });\n      let { username } = user;\n      if (exp.owner) {\n        username = exp.owner;\n      }\n      const apiClient = ApiV2.clientForUser(user);\n\n      const isProxyUser = username !== user.username;\n      log(\n        `Deleting API key on Expo's servers for project ${exp.slug}${\n          isProxyUser ? ` on behalf of ${username}` : ''\n        }...`\n      );\n\n      await apiClient.deleteAsync(`credentials/android/push/@${username}/${exp.slug}`);\n\n      log('All done!');\n    });\n\n  const vapidSubjectDescription =\n    'URL or `mailto:` URL which provides a point of contact in case the push service needs to contact the message sender.';\n\n  program\n    .command('push:web:upload [project-dir]')\n    .description('Uploads VAPID key pair and VAPID subject for web push notifications.')\n    .option('--vapid-pubkey [vapid-public-key]', 'URL-safe base64-encoded VAPID public key.')\n    .option('--vapid-pvtkey [vapid-private-key]', 'URL-safe base64-encoded VAPID private key.')\n    .option('--vapid-subject [vapid-subject]', vapidSubjectDescription)\n    .asyncActionProjectDir(async (projectDir: string, options: VapidData) => {\n      if (!options.vapidPubkey || !options.vapidPvtkey || !options.vapidSubject) {\n        throw new Error(\n          'Must specify all three fields (--vapid-pubkey, --vapid-pvtkey, and --vapid-subject) to upload.'\n        );\n      }\n\n      await _uploadWebPushCredientials(projectDir, options);\n    });\n\n  program\n    .command('push:web:generate [project-dir]')\n    .description('Generates VAPID key pair for web push notifications.')\n    .option('--vapid-subject [vapid-subject]', vapidSubjectDescription)\n    .asyncActionProjectDir(async (projectDir: string, options: VapidData) => {\n      if (!options.vapidSubject) {\n        throw new Error('Must specify --vapid-subject.');\n      }\n\n      const results = await _uploadWebPushCredientials(projectDir, options);\n      log(chalk.green(`Your VAPID public key is: ${results.vapidPublicKey}`));\n      log(chalk.green(`Your VAPID private key is: ${results.vapidPrivateKey}`));\n    });\n\n  program\n    .command('push:web:show [project-dir]')\n    .description(\n      'Prints the VAPID public key, the VAPID private key, and the VAPID subject currently in use for web notifications for this project.'\n    )\n    .asyncActionProjectDir(async (projectDir: string) => {\n      const {\n        args: { remotePackageName },\n      } = await Exp.getPublishInfoAsync(projectDir);\n      const user = await UserManager.getCurrentUserAsync();\n      const apiClient = ApiV2.clientForUser(user);\n\n      const result = await apiClient.getAsync(`credentials/push/web/${remotePackageName}`);\n\n      if (\n        result.status === 'ok' &&\n        result.vapidPublicKey &&\n        result.vapidPrivateKey &&\n        result.vapidSubject\n      ) {\n        log(JSON.stringify(result));\n      } else if (result.status === 'error') {\n        throw new Error(`Server returned an error: ${result.error}`);\n      } else {\n        throw new Error('Server returned an invalid result!');\n      }\n    });\n\n  program\n    .command('push:web:clear [project-dir]')\n    .description(\n      'Deletes previously uploaded VAPID public key, VAPID private key, and VAPID subject.'\n    )\n    .asyncActionProjectDir(async (projectDir: string) => {\n      log('Reading project configuration...');\n      const {\n        args: { remotePackageName },\n      } = await Exp.getPublishInfoAsync(projectDir);\n\n      log('Logging in...');\n      const user = await UserManager.getCurrentUserAsync();\n      const apiClient = ApiV2.clientForUser(user);\n\n      log(\"Deleting API key from Expo's servers...\");\n\n      await apiClient.deleteAsync(`credentials/push/web/${remotePackageName}`);\n    });\n}\n\nasync function _uploadWebPushCredientials(projectDir: string, options: VapidData) {\n  const isGeneration = !(options.vapidPubkey && options.vapidPvtkey);\n\n  log('Reading project configuration...');\n\n  const {\n    args: { remotePackageName },\n  } = await Exp.getPublishInfoAsync(projectDir);\n\n  log('Logging in...');\n\n  const user = await UserManager.getCurrentUserAsync();\n  const apiClient = ApiV2.clientForUser(user);\n\n  if (isGeneration) {\n    log(\"Generating and setting VAPID keys on Expo's servers...\");\n  } else {\n    log(\"Uploading VAPID keys to Expo's servers...\");\n  }\n\n  const results = await apiClient.putAsync(`credentials/push/web/${remotePackageName}`, {\n    vapidPublicKey: options.vapidPubkey,\n    vapidPrivateKey: options.vapidPvtkey,\n    vapidSubject: options.vapidSubject,\n  });\n\n  if (results.oldVapidData && results.oldVapidData.vapidPublicKey !== results.vapidPublicKey) {\n    log(\n      chalk.yellow(\n        `Warning: You have previously stored another VAPID key pair on Expo's servers. Your current action has overridden the old key pair. This means that all your web clients will not receive any new notifications from you until you have deployed the app containing the new VAPID public key, and that the user has visited the site again since then.`\n      )\n    );\n    log(chalk.yellow(`For your records:`));\n    log(chalk.yellow(`- Your old VAPID public key: ${results.oldVapidData.vapidPublicKey}`));\n    log(chalk.yellow(`- Your old VAPID private key: ${results.oldVapidData.vapidPrivateKey}`));\n    log(chalk.yellow(`- Your old VAPID subject: ${results.oldVapidData.vapidSubject}`));\n    log(\n      chalk.yellow(\n        `If you wish to undo the current action, you can use the following command to upload your old credentials back to Expo's servers:`\n      )\n    );\n    log(\n      chalk.yellowBright(\n        `expo push:web:upload --vapid-pubkey ${results.oldVapidData.vapidPublicKey} --vapid-pvtkey ${results.oldVapidData.vapidPrivateKey} --vapid-subject ${results.oldVapidData.vapidSubject}`\n      )\n    );\n  }\n  log(chalk.green(`VAPID data uploaded!`));\n\n  /**\n   * Customize app.json\n   */\n  log(`Reading app.json...`);\n  const { configPath } = ConfigUtils.findConfigFile(projectDir);\n  const appJson = JSON.parse(await fse.readFile(configPath).then(value => value.toString()));\n  const changedProperties = [];\n\n  if (user) {\n    if (appJson.expo.owner && appJson.expo.owner !== user.username) {\n      log(\n        chalk.yellow(\n          `Warning: expo.owner is already configured to be \"${appJson.expo.owner}\" in app.json, but your current username is \"${user.username}\". You will not receive any push notification if you do not change expo.owner to \"${user.username}\" in app.json. Alternatively, you could choose to login to \"${appJson.expo.owner}\" and then execute this command again.`\n        )\n      );\n    } else {\n      appJson.expo.owner = user.username;\n      changedProperties.push('expo.owner');\n    }\n  }\n\n  if (\n    appJson.expo.notification &&\n    appJson.expo.notification.vapidPublicKey &&\n    appJson.expo.notification.vapidPublicKey !== results.vapidPublicKey\n  ) {\n    log(\n      chalk.cyan(\n        `Notice: expo.notification.vapidPublicKey is already configured in app.json (${\n          appJson.expo.notification.vapidPublicKey\n        }), but it is different from the VAPID public key you just ${\n          isGeneration ? `generated` : `uploaded`\n        }. We will replace it with the new VAPID public key.`\n      )\n    );\n  }\n  if (!appJson.expo.notification) {\n    appJson.expo.notification = {};\n  }\n  appJson.expo.notification.vapidPublicKey = results.vapidPublicKey;\n  changedProperties.push('expo.notification.vapidPublicKey');\n\n  if (changedProperties.length) {\n    log(`Writing to app.json...`);\n    await fse.writeFile(configPath, JSON.stringify(appJson, null, 2));\n    log(chalk.green(`Wrote ${changedProperties.join(', ')} to app.json.`));\n  }\n\n  log(chalk.green('All done!'));\n\n  return results;\n}\n"],"file":"push-creds.js"}